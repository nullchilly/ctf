import socket
import string
 
def read_while(sock_fd, marker):
    while True:
        buffer = sock_fd.recv(1024)
        if marker in buffer:
            return buffer
            break
 
sock = socket.socket()
sock.connect(('192.168.1.64', 1337))
read_while(sock, "Output is in format <IV>:<Encrypted Data>")
alphabet = string.letters + string.digits
secret = "4c4335997a34d67a1d880444668cb1c4a8ea47604e20"
 
known = ""
count = 0
while True:
    found_letter = False
    for letter in alphabet: # Test every possible letter
        while True: # Until we get the encoded value with the wanted IV
            sock.send("E," + known + letter + "\n")
            count += 1
            result = sock.recv(2048).strip()
            if ':' not in result:
                print repr(result)
                exit()
            iv, encoded = result.split(':')
            if iv == "1dcf":
                if secret == encoded:
                    print "Final result:", known
                    print "Number of requests:", count
                    exit()
                elif secret.startswith(encoded):
                    known += letter
                    # print known
                    found_letter = True
                    break
                else:
                    # This letter is not valid
                    break
        if found_letter:
            break
 
sock.close()
