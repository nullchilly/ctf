<!DOCTYPE html>
<html lang="en" class="RFC">
<head>
<meta charset="utf-8">
<meta content="Common,Latin" name="scripts">
<meta content="initial-scale=1.0" name="viewport">
<title>RFC 8970: IMAP4 Extension: Message Preview Generation</title>
<meta content="Michael M. Slusarz" name="author">
<meta content="
       This document specifies an Internet Message Access Protocol (IMAP)
      protocol extension that allows a client to request a server-generated
      abbreviated text representation of message data that is useful as a contextual
      preview of the entire message. 
    " name="description">
<meta content="xml2rfc 3.5.0" name="generator">
<meta content="IMAP4" name="keyword">
<meta content="FETCH" name="keyword">
<meta content="PREVIEW" name="keyword">
<meta content="8970" name="rfc.number">
<!-- Generator version information:
  xml2rfc 3.5.0
    Python 3.6.10
    appdirs 1.4.4
    ConfigArgParse 1.2.3
    google-i18n-address 2.3.5
    html5lib 1.0.1
    intervaltree 3.0.2
    Jinja2 2.11.2
    kitchen 1.2.6
    lxml 4.4.2
    pycairo 1.19.0
    pycountry 19.8.18
    pyflakes 2.1.1
    PyYAML 5.3.1
    requests 2.22.0
    setuptools 40.6.2
    six 1.14.0
    WeasyPrint 51
-->
<link href="rfc8970.xml" rel="alternate" type="application/rfc+xml">
<link href="#copyright" rel="license">
<style type="text/css">/*

  NOTE: Changes at the bottom of this file overrides some earlier settings.

  Once the style has stabilized and has been adopted as an official RFC style,
  this can be consolidated so that style settings occur only in one place, but
  for now the contents of this file consists first of the initial CSS work as
  provided to the RFC Formatter (xml2rfc) work, followed by itemized and
  commented changes found necssary during the development of the v3
  formatters.

*/

/* fonts */
@import url('https://fonts.googleapis.com/css?family=Noto+Sans'); /* Sans-serif */
@import url('https://fonts.googleapis.com/css?family=Noto+Serif'); /* Serif (print) */
@import url('https://fonts.googleapis.com/css?family=Roboto+Mono'); /* Monospace */

@viewport {
  zoom: 1.0;
  width: extend-to-zoom;
}
@-ms-viewport {
  width: extend-to-zoom;
  zoom: 1.0;
}
/* general and mobile first */
html {
}
body {
  max-width: 90%;
  margin: 1.5em auto;
  color: #222;
  background-color: #fff;
  font-size: 14px;
  font-family: 'Noto Sans', Arial, Helvetica, sans-serif;
  line-height: 1.6;
  scroll-behavior: smooth;
}
.ears {
  display: none;
}

/* headings */
#title, h1, h2, h3, h4, h5, h6 {
  margin: 1em 0 0.5em;
  font-weight: bold;
  line-height: 1.3;
}
#title {
  clear: both;
  border-bottom: 1px solid #ddd;
  margin: 0 0 0.5em 0;
  padding: 1em 0 0.5em;
}
.author {
  padding-bottom: 4px;
}
h1 {
  font-size: 26px;
  margin: 1em 0;
}
h2 {
  font-size: 22px;
  margin-top: -20px;  /* provide offset for in-page anchors */
  padding-top: 33px;
}
h3 {
  font-size: 18px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h4 {
  font-size: 16px;
  margin-top: -36px;  /* provide offset for in-page anchors */
  padding-top: 42px;
}
h5, h6 {
  font-size: 14px;
}
#n-copyright-notice {
  border-bottom: 1px solid #ddd;
  padding-bottom: 1em;
  margin-bottom: 1em;
}
/* general structure */
p {
  padding: 0;
  margin: 0 0 1em 0;
  text-align: left;
}
div, span {
  position: relative;
}
div {
  margin: 0;
}
.alignRight.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignRight.art-text pre {
  padding: 0;
}
.alignRight {
  margin: 1em 0;
}
.alignRight > *:first-child {
  border: none;
  margin: 0;
  float: right;
  clear: both;
}
.alignRight > *:nth-child(2) {
  clear: both;
  display: block;
  border: none;
}
svg {
  display: block;
}
.alignCenter.art-text {
  background-color: #f9f9f9;
  border: 1px solid #eee;
  border-radius: 3px;
  padding: 1em 1em 0;
  margin-bottom: 1.5em;
}
.alignCenter.art-text pre {
  padding: 0;
}
.alignCenter {
  margin: 1em 0;
}
.alignCenter > *:first-child {
  border: none;
  /* this isn't optimal, but it's an existence proof.  PrinceXML doesn't
     support flexbox yet.
  */
  display: table;
  margin: 0 auto;
}

/* lists */
ol, ul {
  padding: 0;
  margin: 0 0 1em 2em;
}
ol ol, ul ul, ol ul, ul ol {
  margin-left: 1em;
}
li {
  margin: 0 0 0.25em 0;
}
.ulCompact li {
  margin: 0;
}
ul.empty, .ulEmpty {
  list-style-type: none;
}
ul.empty li, .ulEmpty li {
  margin-top: 0.5em;
}
ul.compact, .ulCompact,
ol.compact, .olCompact {
  line-height: 100%;
  margin: 0 0 0 2em;
}

/* definition lists */
dl {
}
dl > dt {
  float: left;
  margin-right: 1em;
}
/* 
dl.nohang > dt {
  float: none;
}
*/
dl > dd {
  margin-bottom: .8em;
  min-height: 1.3em;
}
dl.compact > dd, .dlCompact > dd {
  margin-bottom: 0em;
}
dl > dd > dl {
  margin-top: 0.5em;
  margin-bottom: 0em;
}

/* links */
a {
  text-decoration: none;
}
a[href] {
  color: #22e; /* Arlen: WCAG 2019 */
}
a[href]:hover {
  background-color: #f2f2f2;
}
figcaption a[href],
a[href].selfRef {
  color: #222;
}
/* XXX probably not this:
a.selfRef:hover {
  background-color: transparent;
  cursor: default;
} */

/* Figures */
tt, code, pre, code {
  background-color: #f9f9f9;
  font-family: 'Roboto Mono', monospace;
}
pre {
  border: 1px solid #eee;
  margin: 0;
  padding: 1em;
}
img {
  max-width: 100%;
}
figure {
  margin: 0;
}
figure blockquote {
  margin: 0.8em 0.4em 0.4em;
}
figcaption {
  font-style: italic;
  margin: 0 0 1em 0;
}
@media screen {
  pre {
    overflow-x: auto;
    max-width: 100%;
    max-width: calc(100% - 22px);
  }
}

/* aside, blockquote */
aside, blockquote {
  margin-left: 0;
  padding: 1.2em 2em;
}
blockquote {
  background-color: #f9f9f9;
  color: #111; /* Arlen: WCAG 2019 */
  border: 1px solid #ddd;
  border-radius: 3px;
  margin: 1em 0;
}
cite {
  display: block;
  text-align: right;
  font-style: italic;
}

/* tables */
table {
  width: 100%;
  margin: 0 0 1em;
  border-collapse: collapse;
  border: 1px solid #eee;
}
th, td {
  text-align: left;
  vertical-align: top;
  padding: 0.5em 0.75em;
}
th {
  text-align: left;
  background-color: #e9e9e9;
}
tr:nth-child(2n+1) > td {
  background-color: #f5f5f5;
}
table caption {
  font-style: italic;
  margin: 0;
  padding: 0;
  text-align: left;
}
table p {
  /* XXX to avoid bottom margin on table row signifiers. If paragraphs should
     be allowed within tables more generally, it would be far better to select on a class. */
  margin: 0;
}

/* pilcrow */
a.pilcrow {
  color: #666; /* Arlen: AHDJ 2019 */
  text-decoration: none;
  visibility: hidden;
  user-select: none;
  -ms-user-select: none;
  -o-user-select:none;
  -moz-user-select: none;
  -khtml-user-select: none;
  -webkit-user-select: none;
  -webkit-touch-callout: none;
}
@media screen {
  aside:hover > a.pilcrow,
  p:hover > a.pilcrow,
  blockquote:hover > a.pilcrow,
  div:hover > a.pilcrow,
  li:hover > a.pilcrow,
  pre:hover > a.pilcrow {
    visibility: visible;
  }
  a.pilcrow:hover {
    background-color: transparent;
  }
}

/* misc */
hr {
  border: 0;
  border-top: 1px solid #eee;
}
.bcp14 {
  font-variant: small-caps;
}

.role {
  font-variant: all-small-caps;
}

/* info block */
#identifiers {
  margin: 0;
  font-size: 0.9em;
}
#identifiers dt {
  width: 3em;
  clear: left;
}
#identifiers dd {
  float: left;
  margin-bottom: 0;
}
#identifiers .authors .author {
  display: inline-block;
  margin-right: 1.5em;
}
#identifiers .authors .org {
  font-style: italic;
}

/* The prepared/rendered info at the very bottom of the page */
.docInfo {
  color: #666; /* Arlen: WCAG 2019 */
  font-size: 0.9em;
  font-style: italic;
  margin-top: 2em;
}
.docInfo .prepared {
  float: left;
}
.docInfo .prepared {
  float: right;
}

/* table of contents */
#toc  {
  padding: 0.75em 0 2em 0;
  margin-bottom: 1em;
}
nav.toc ul {
  margin: 0 0.5em 0 0;
  padding: 0;
  list-style: none;
}
nav.toc li {
  line-height: 1.3em;
  margin: 0.75em 0;
  padding-left: 1.2em;
  text-indent: -1.2em;
}
/* references */
.references dt {
  text-align: right;
  font-weight: bold;
  min-width: 7em;
}
.references dd {
  margin-left: 8em;
  overflow: auto;
}

.refInstance {
  margin-bottom: 1.25em;
}

.references .ascii {
  margin-bottom: 0.25em;
}

/* index */
.index ul {
  margin: 0 0 0 1em;
  padding: 0;
  list-style: none;
}
.index ul ul {
  margin: 0;
}
.index li {
  margin: 0;
  text-indent: -2em;
  padding-left: 2em;
  padding-bottom: 5px;
}
.indexIndex {
  margin: 0.5em 0 1em;
}
.index a {
  font-weight: 700;
}
/* make the index two-column on all but the smallest screens */
@media (min-width: 600px) {
  .index ul {
    -moz-column-count: 2;
    -moz-column-gap: 20px;
  }
  .index ul ul {
    -moz-column-count: 1;
    -moz-column-gap: 0;
  }
}

/* authors */
address.vcard {
  font-style: normal;
  margin: 1em 0;
}

address.vcard .nameRole {
  font-weight: 700;
  margin-left: 0;
}
address.vcard .label {
  font-family: "Noto Sans",Arial,Helvetica,sans-serif;
  margin: 0.5em 0;
}
address.vcard .type {
  display: none;
}
.alternative-contact {
  margin: 1.5em 0 1em;
}
hr.addr {
  border-top: 1px dashed;
  margin: 0;
  color: #ddd;
  max-width: calc(100% - 16px);
}

/* temporary notes */
.rfcEditorRemove::before {
  position: absolute;
  top: 0.2em;
  right: 0.2em;
  padding: 0.2em;
  content: "The RFC Editor will remove this note";
  color: #9e2a00; /* Arlen: WCAG 2019 */
  background-color: #ffd; /* Arlen: WCAG 2019 */
}
.rfcEditorRemove {
  position: relative;
  padding-top: 1.8em;
  background-color: #ffd; /* Arlen: WCAG 2019 */
  border-radius: 3px;
}
.cref {
  background-color: #ffd; /* Arlen: WCAG 2019 */
  padding: 2px 4px;
}
.crefSource {
  font-style: italic;
}
/* alternative layout for smaller screens */
@media screen and (max-width: 1023px) {
  body {
    padding-top: 2em;
  }
  #title {
    padding: 1em 0;
  }
  h1 {
    font-size: 24px;
  }
  h2 {
    font-size: 20px;
    margin-top: -18px;  /* provide offset for in-page anchors */
    padding-top: 38px;
  }
  #identifiers dd {
    max-width: 60%;
  }
  #toc {
    position: fixed;
    z-index: 2;
    top: 0;
    right: 0;
    padding: 0;
    margin: 0;
    background-color: inherit;
    border-bottom: 1px solid #ccc;
  }
  #toc h2 {
    margin: -1px 0 0 0;
    padding: 4px 0 4px 6px;
    padding-right: 1em;
    min-width: 190px;
    font-size: 1.1em;
    text-align: right;
    background-color: #444;
    color: white;
    cursor: pointer;
  }
  #toc h2::before { /* css hamburger */
    float: right;
    position: relative;
    width: 1em;
    height: 1px;
    left: -164px;
    margin: 6px 0 0 0;
    background: white none repeat scroll 0 0;
    box-shadow: 0 4px 0 0 white, 0 8px 0 0 white;
    content: "";
  }
  #toc nav {
    display: none;
    padding: 0.5em 1em 1em;
    overflow: auto;
    height: calc(100vh - 48px);
    border-left: 1px solid #ddd;
  }
}

/* alternative layout for wide screens */
@media screen and (min-width: 1024px) {
  body {
    max-width: 724px;
    margin: 42px auto;
    padding-left: 1.5em;
    padding-right: 29em;
  }
  #toc {
    position: fixed;
    top: 42px;
    right: 42px;
    width: 25%;
    margin: 0;
    padding: 0 1em;
    z-index: 1;
  }
  #toc h2 {
    border-top: none;
    border-bottom: 1px solid #ddd;
    font-size: 1em;
    font-weight: normal;
    margin: 0;
    padding: 0.25em 1em 1em 0;
  }
  #toc nav {
    display: block;
    height: calc(90vh - 84px);
    bottom: 0;
    padding: 0.5em 0 0;
    overflow: auto;
  }
  img { /* future proofing */
    max-width: 100%;
    height: auto;
  }
}

/* pagination */
@media print {
  body {

    width: 100%;
  }
  p {
    orphans: 3;
    widows: 3;
  }
  #n-copyright-notice {
    border-bottom: none;
  }
  #toc, #n-introduction {
    page-break-before: always;
  }
  #toc {
    border-top: none;
    padding-top: 0;
  }
  figure, pre {
    page-break-inside: avoid;
  }
  figure {
    overflow: scroll;
  }
  h1, h2, h3, h4, h5, h6 {
    page-break-after: avoid;
  }
  h2+*, h3+*, h4+*, h5+*, h6+* {
    page-break-before: avoid;
  }
  pre {
    white-space: pre-wrap;
    word-wrap: break-word;
    font-size: 10pt;
  }
  table {
    border: 1px solid #ddd;
  }
  td {
    border-top: 1px solid #ddd;
  }
}

/* This is commented out here, as the string-set: doesn't
   pass W3C validation currently */
/*
.ears thead .left {
  string-set: ears-top-left content();
}

.ears thead .center {
  string-set: ears-top-center content();
}

.ears thead .right {
  string-set: ears-top-right content();
}

.ears tfoot .left {
  string-set: ears-bottom-left content();
}

.ears tfoot .center {
  string-set: ears-bottom-center content();
}

.ears tfoot .right {
  string-set: ears-bottom-right content();
}
*/

@page :first {
  padding-top: 0;
  @top-left {
    content: normal;
    border: none;
  }
  @top-center {
    content: normal;
    border: none;
  }
  @top-right {
    content: normal;
    border: none;
  }
}

@page {
  size: A4;
  margin-bottom: 45mm;
  padding-top: 20px;
  /* The follwing is commented out here, but set appropriately by in code, as
     the content depends on the document */
  /*
  @top-left {
    content: 'Internet-Draft';
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-left {
    content: string(ears-top-left);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-center {
    content: string(ears-top-center);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @top-right {
    content: string(ears-top-right);
    vertical-align: bottom;
    border-bottom: solid 1px #ccc;
  }
  @bottom-left {
    content: string(ears-bottom-left);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-center {
    content: string(ears-bottom-center);
    vertical-align: top;
    border-top: solid 1px #ccc;
  }
  @bottom-right {
      content: '[Page ' counter(page) ']';
      vertical-align: top;
      border-top: solid 1px #ccc;
  }
  */

}

/* Changes introduced to fix issues found during implementation */
/* Make sure links are clickable even if overlapped by following H* */
a {
  z-index: 2;
}
/* Separate body from document info even without intervening H1 */
section {
  clear: both;
}


/* Top align author divs, to avoid names without organization dropping level with org names */
.author {
  vertical-align: top;
}

/* Leave room in document info to show Internet-Draft on one line */
#identifiers dt {
  width: 8em;
}

/* Don't waste quite as much whitespace between label and value in doc info */
#identifiers dd {
  margin-left: 1em;
}

/* Give floating toc a background color (needed when it's a div inside section */
#toc {
  background-color: white;
}

/* Make the collapsed ToC header render white on gray also when it's a link */
@media screen and (max-width: 1023px) {
  #toc h2 a,
  #toc h2 a:link,
  #toc h2 a:focus,
  #toc h2 a:hover,
  #toc a.toplink,
  #toc a.toplink:hover {
    color: white;
    background-color: #444;
    text-decoration: none;
  }
}

/* Give the bottom of the ToC some whitespace */
@media screen and (min-width: 1024px) {
  #toc {
    padding: 0 0 1em 1em;
  }
}

/* Style section numbers with more space between number and title */
.section-number {
  padding-right: 0.5em;
}

/* prevent monospace from becoming overly large */
tt, code, pre, code {
  font-size: 95%;
}

/* Fix the height/width aspect for ascii art*/
pre.sourcecode,
.art-text pre {
  line-height: 1.12;
}


/* Add styling for a link in the ToC that points to the top of the document */
a.toplink {
  float: right;
  margin-right: 0.5em;
}

/* Fix the dl styling to match the RFC 7992 attributes */
dl > dt,
dl.dlParallel > dt {
  float: left;
  margin-right: 1em;
}
dl.dlNewline > dt {
  float: none;
}

/* Provide styling for table cell text alignment */
table td.text-left,
table th.text-left {
  text-align: left;
}
table td.text-center,
table th.text-center {
  text-align: center;
}
table td.text-right,
table th.text-right {
  text-align: right;
}

/* Make the alternative author contact informatio look less like just another
   author, and group it closer with the primary author contact information */
.alternative-contact {
  margin: 0.5em 0 0.25em 0;
}
address .non-ascii {
  margin: 0 0 0 2em;
}

/* With it being possible to set tables with alignment
  left, center, and right, { width: 100%; } does not make sense */
table {
  width: auto;
}

/* Avoid reference text that sits in a block with very wide left margin,
   because of a long floating dt label.*/
.references dd {
  overflow: visible;
}

/* Control caption placement */
caption {
  caption-side: bottom;
}

/* Limit the width of the author address vcard, so names in right-to-left
   script don't end up on the other side of the page. */

address.vcard {
  max-width: 30em;
  margin-right: auto;
}

/* For address alignment dependent on LTR or RTL scripts */
address div.left {
  text-align: left;
}
address div.right {
  text-align: right;
}

/* Provide table alignment support.  We can't use the alignX classes above
   since they do unwanted things with caption and other styling. */
table.right {
 margin-left: auto;
 margin-right: 0;
}
table.center {
 margin-left: auto;
 margin-right: auto;
}
table.left {
 margin-left: 0;
 margin-right: auto;
}

/* Give the table caption label the same styling as the figcaption */
caption a[href] {
  color: #222;
}

@media print {
  .toplink {
    display: none;
  }

  /* avoid overwriting the top border line with the ToC header */
  #toc {
    padding-top: 1px;
  }

  /* Avoid page breaks inside dl and author address entries */
  .vcard {
    page-break-inside: avoid;
  }

}
/* Tweak the bcp14 keyword presentation */
.bcp14 {
  font-variant: small-caps;
  font-weight: bold;
  font-size: 0.9em;
}
/* Tweak the invisible space above H* in order not to overlay links in text above */
 h2 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 31px;
 }
 h3 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
 h4 {
  margin-top: -18px;  /* provide offset for in-page anchors */
  padding-top: 24px;
 }
/* Float artwork pilcrow to the right */
@media screen {
  .artwork a.pilcrow {
    display: block;
    line-height: 0.7;
    margin-top: 0.15em;
  }
}
/* Make pilcrows on dd visible */
@media screen {
  dd:hover > a.pilcrow {
    visibility: visible;
  }
}
/* Make the placement of figcaption match that of a table's caption
   by removing the figure's added bottom margin */
.alignLeft.art-text,
.alignCenter.art-text,
.alignRight.art-text {
   margin-bottom: 0;
}
.alignLeft,
.alignCenter,
.alignRight {
  margin: 1em 0 0 0;
}
/* In print, the pilcrow won't show on hover, so prevent it from taking up space,
   possibly even requiring a new line */
@media print {
  a.pilcrow {
    display: none;
  }
}
/* Styling for the external metadata */
div#external-metadata {
  background-color: #eee;
  padding: 0.5em;
  margin-bottom: 0.5em;
  display: none;
}
div#internal-metadata {
  padding: 0.5em;                       /* to match the external-metadata padding */
}
/* Styling for title RFC Number */
h1#rfcnum {
  clear: both;
  margin: 0 0 -1em;
  padding: 1em 0 0 0;
}
/* Make .olPercent look the same as <ol><li> */
dl.olPercent > dd {
  margin-bottom: 0.25em;
  min-height: initial;
}
/* Give aside some styling to set it apart */
aside {
  border-left: 1px solid #ddd;
  margin: 1em 0 1em 2em;
  padding: 0.2em 2em;
}
aside > dl,
aside > ol,
aside > ul,
aside > table,
aside > p {
  margin-bottom: 0.5em;
}
/* Additional page break settings */
@media print {
  figcaption, table caption {
    page-break-before: avoid;
  }
}
/* Font size adjustments for print */
@media print {
  body  { font-size: 10pt;      line-height: normal; max-width: 96%; }
  h1    { font-size: 1.72em;    padding-top: 1.5em; } /* 1*1.2*1.2*1.2 */
  h2    { font-size: 1.44em;    padding-top: 1.5em; } /* 1*1.2*1.2 */
  h3    { font-size: 1.2em;     padding-top: 1.5em; } /* 1*1.2 */
  h4    { font-size: 1em;       padding-top: 1.5em; }
  h5, h6 { font-size: 1em;      margin: initial; padding: 0.5em 0 0.3em; }
}
/* Sourcecode margin in print, when there's no pilcrow */
@media print {
  .artwork,
  .sourcecode {
    margin-bottom: 1em;
  }
}
/* Avoid narrow tables forcing too narrow table captions, which may render badly */
table {
  min-width: 20em;
}
/* ol type a */
ol.type-a { list-style-type: lower-alpha; }
ol.type-A { list-style-type: upper-alpha; }
ol.type-i { list-style-type: lower-roman; }
ol.type-I { list-style-type: lower-roman; }
/* Apply the print table and row borders in general, on request from the RPC,
and increase the contrast between border and odd row background sligthtly */
table {
  border: 1px solid #ddd;
}
td {
  border-top: 1px solid #ddd;
}
tr:nth-child(2n+1) > td {
  background-color: #f8f8f8;
}
/* Use style rules to govern display of the TOC. */
@media screen and (max-width: 1023px) {
  #toc nav { display: none; }
  #toc.active nav { display: block; }
}
/* Add support for keepWithNext */
.keepWithNext {
  break-after: avoid-page;
  break-after: avoid-page;
}
/* Add support for keepWithPrevious */
.keepWithPrevious {
  break-before: avoid-page;
}
/* Change the approach to avoiding breaks inside artwork etc. */
figure, pre, table, .artwork, .sourcecode  {
  break-before: avoid-page;
  break-after: auto;
}
/* Avoid breaks between <dt> and <dd> */
dl {
  break-before: auto;
  break-inside: auto;
}
dt {
  break-before: auto;
  break-after: avoid-page;
}
dd {
  break-before: avoid-page;
  break-after: auto;
  orphans: 3;
  widows: 3
}
span.break, dd.break {
  margin-bottom: 0;
  min-height: 0;
  break-before: auto;
  break-inside: auto;
  break-after: auto;
}
/* Undo break-before ToC */
@media print {
  #toc {
    break-before: auto;
  }
}
/* Text in compact lists should not get extra bottim margin space,
   since that would makes the list not compact */
ul.compact p, .ulCompact p,
ol.compact p, .olCompact p {
 margin: 0;
}
/* But the list as a whole needs the extra space at the end */
section ul.compact,
section .ulCompact,
section ol.compact,
section .olCompact {
  margin-bottom: 1em;                    /* same as p not within ul.compact etc. */
}
/* The tt and code background above interferes with for instance table cell
   backgrounds.  Changed to something a bit more selective. */
tt, code {
  background-color: transparent;
}
p tt, p code, li tt, li code {
  background-color: #f8f8f8;
}
/* Tweak the pre margin -- 0px doesn't come out well */
pre {
   margin-top: 0.5px;
}
/* Tweak the comact list text */
ul.compact, .ulCompact,
ol.compact, .olCompact,
dl.compact, .dlCompact {
  line-height: normal;
}
/* Don't add top margin for nested lists */
li > ul, li > ol, li > dl,
dd > ul, dd > ol, dd > dl,
dl > dd > dl {
  margin-top: initial;
}
/* Elements that should not be rendered on the same line as a <dt> */
/* This should match the element list in writer.text.TextWriter.render_dl() */
dd > div.artwork:first-child,
dd > aside:first-child,
dd > figure:first-child,
dd > ol:first-child,
dd > div:first-child > pre.sourcecode,
dd > table:first-child,
dd > ul:first-child {
  clear: left;
}
/* fix for weird browser behaviour when <dd/> is empty */
dt+dd:empty::before{
  content: "\00a0";
}
</style>
<link href="rfc-local.css" rel="stylesheet" type="text/css">
<link href="https://dx.doi.org/10.17487/rfc8970" rel="alternate">
  <link href="urn:issn:2070-1721" rel="alternate">
  <link href="https://datatracker.ietf.org/doc/draft-ietf-extra-imap-fetch-preview-10" rel="prev">
  </head>
<body>
<script src="https://www.rfc-editor.org/js/metadata.min.js"></script>
<table class="ears">
<thead><tr>
<td class="left">RFC 8970</td>
<td class="center">IMAP: PREVIEW Extension</td>
<td class="right">December 2020</td>
</tr></thead>
<tfoot><tr>
<td class="left">Slusarz</td>
<td class="center">Standards Track</td>
<td class="right">[Page]</td>
</tr></tfoot>
</table>
<div id="external-metadata" class="document-information"></div>
<div id="internal-metadata" class="document-information">
<dl id="identifiers">
<dt class="label-stream">Stream:</dt>
<dd class="stream">Internet Engineering Task Force (IETF)</dd>
<dt class="label-rfc">RFC:</dt>
<dd class="rfc"><a href="https://www.rfc-editor.org/rfc/rfc8970" class="eref">8970</a></dd>
<dt class="label-category">Category:</dt>
<dd class="category">Standards Track</dd>
<dt class="label-published">Published:</dt>
<dd class="published">
<time datetime="2020-12" class="published">December 2020</time>
    </dd>
<dt class="label-issn">ISSN:</dt>
<dd class="issn">2070-1721</dd>
<dt class="label-authors">Author:</dt>
<dd class="authors">
<div class="author">
      <div class="author-name">M. Slusarz</div>
<div class="org">Open-Xchange Inc.</div>
</div>
</dd>
</dl>
</div>
<h1 id="rfcnum">RFC 8970</h1>
<h1 id="title">IMAP4 Extension: Message Preview Generation</h1>
<section id="section-abstract">
      <h2 id="abstract"><a href="#abstract" class="selfRef">Abstract</a></h2>
<p id="section-abstract-1">This document specifies an Internet Message Access Protocol (IMAP)
      protocol extension that allows a client to request a server-generated
      abbreviated text representation of message data that is useful as a contextual
      preview of the entire message.<a href="#section-abstract-1" class="pilcrow">¶</a></p>
</section>
<div id="status-of-memo">
<section id="section-boilerplate.1">
        <h2 id="name-status-of-this-memo">
<a href="#name-status-of-this-memo" class="section-name selfRef">Status of This Memo</a>
        </h2>
<p id="section-boilerplate.1-1">
            This is an Internet Standards Track document.<a href="#section-boilerplate.1-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.<a href="#section-boilerplate.1-2" class="pilcrow">¶</a></p>
<p id="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <span><a href="https://www.rfc-editor.org/info/rfc8970">https://www.rfc-editor.org/info/rfc8970</a></span>.<a href="#section-boilerplate.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<div id="copyright">
<section id="section-boilerplate.2">
        <h2 id="name-copyright-notice">
<a href="#name-copyright-notice" class="section-name selfRef">Copyright Notice</a>
        </h2>
<p id="section-boilerplate.2-1">
            Copyright (c) 2020 IETF Trust and the persons identified as the
            document authors. All rights reserved.<a href="#section-boilerplate.2-1" class="pilcrow">¶</a></p>
<p id="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<span><a href="https://trustee.ietf.org/license-info">https://trustee.ietf.org/license-info</a></span>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.<a href="#section-boilerplate.2-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="toc">
<section id="section-toc.1">
        <a href="#" onclick="scroll(0,0)" class="toplink">▲</a><h2 id="name-table-of-contents">
<a href="#name-table-of-contents" class="section-name selfRef">Table of Contents</a>
        </h2>
<nav class="toc"><ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.1">
            <p id="section-toc.1-1.1.1" class="keepWithNext"><a href="#section-1" class="xref">1</a>.  <a href="#name-introduction" class="xref">Introduction</a><a href="#section-toc.1-1.1.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.2">
            <p id="section-toc.1-1.2.1" class="keepWithNext"><a href="#section-2" class="xref">2</a>.  <a href="#name-conventions-used-in-this-do" class="xref">Conventions Used in This Document</a><a href="#section-toc.1-1.2.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.3">
            <p id="section-toc.1-1.3.1"><a href="#section-3" class="xref">3</a>.  <a href="#name-fetch-data-item" class="xref">FETCH Data Item</a><a href="#section-toc.1-1.3.1" class="pilcrow">¶</a></p>
<ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.3.2.1">
                <p id="section-toc.1-1.3.2.1.1" class="keepWithNext"><a href="#section-3.1" class="xref">3.1</a>.  <a href="#name-command" class="xref">Command</a><a href="#section-toc.1-1.3.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.3.2.2">
                <p id="section-toc.1-1.3.2.2.1"><a href="#section-3.2" class="xref">3.2</a>.  <a href="#name-response" class="xref">Response</a><a href="#section-toc.1-1.3.2.2.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.3.2.3">
                <p id="section-toc.1-1.3.2.3.1"><a href="#section-3.3" class="xref">3.3</a>.  <a href="#name-preview-text-format" class="xref">Preview Text Format</a><a href="#section-toc.1-1.3.2.3.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.4">
            <p id="section-toc.1-1.4.1"><a href="#section-4" class="xref">4</a>.  <a href="#name-lazy-priority-modifier" class="xref">LAZY Priority Modifier</a><a href="#section-toc.1-1.4.1" class="pilcrow">¶</a></p>
<ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.4.2.1">
                <p id="section-toc.1-1.4.2.1.1"><a href="#section-4.1" class="xref">4.1</a>.  <a href="#name-lazy" class="xref">LAZY</a><a href="#section-toc.1-1.4.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.4.2.2">
                <p id="section-toc.1-1.4.2.2.1"><a href="#section-4.2" class="xref">4.2</a>.  <a href="#name-client-implementation-advic" class="xref">Client Implementation Advice</a><a href="#section-toc.1-1.4.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.5">
            <p id="section-toc.1-1.5.1"><a href="#section-5" class="xref">5</a>.  <a href="#name-examples" class="xref">Examples</a><a href="#section-toc.1-1.5.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.6">
            <p id="section-toc.1-1.6.1"><a href="#section-6" class="xref">6</a>.  <a href="#name-formal-syntax" class="xref">Formal Syntax</a><a href="#section-toc.1-1.6.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.7">
            <p id="section-toc.1-1.7.1"><a href="#section-7" class="xref">7</a>.  <a href="#name-iana-considerations" class="xref">IANA Considerations</a><a href="#section-toc.1-1.7.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.8">
            <p id="section-toc.1-1.8.1"><a href="#section-8" class="xref">8</a>.  <a href="#name-security-considerations" class="xref">Security Considerations</a><a href="#section-toc.1-1.8.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.9">
            <p id="section-toc.1-1.9.1"><a href="#section-9" class="xref">9</a>.  <a href="#name-references" class="xref">References</a><a href="#section-toc.1-1.9.1" class="pilcrow">¶</a></p>
<ul class="toc compact ulEmpty">
<li class="toc compact ulEmpty" id="section-toc.1-1.9.2.1">
                <p id="section-toc.1-1.9.2.1.1"><a href="#section-9.1" class="xref">9.1</a>.  <a href="#name-normative-references" class="xref">Normative References</a><a href="#section-toc.1-1.9.2.1.1" class="pilcrow">¶</a></p>
</li>
              <li class="toc compact ulEmpty" id="section-toc.1-1.9.2.2">
                <p id="section-toc.1-1.9.2.2.1"><a href="#section-9.2" class="xref">9.2</a>.  <a href="#name-informative-references" class="xref">Informative References</a><a href="#section-toc.1-1.9.2.2.1" class="pilcrow">¶</a></p>
</li>
            </ul>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.10">
            <p id="section-toc.1-1.10.1"><a href="#section-appendix.a" class="xref"></a><a href="#name-acknowledgments" class="xref">Acknowledgments</a><a href="#section-toc.1-1.10.1" class="pilcrow">¶</a></p>
</li>
          <li class="toc compact ulEmpty" id="section-toc.1-1.11">
            <p id="section-toc.1-1.11.1"><a href="#section-appendix.b" class="xref"></a><a href="#name-authors-address" class="xref">Author's Address</a><a href="#section-toc.1-1.11.1" class="pilcrow">¶</a></p>
</li>
        </ul>
</nav>
</section>
</div>
<div id="Introduction">
<section id="section-1">
      <h2 id="name-introduction">
<a href="#section-1" class="section-number selfRef">1. </a><a href="#name-introduction" class="section-name selfRef">Introduction</a>
      </h2>
<p id="section-1-1">Many modern mail clients display small extracts of the body text as
      an aid to allow a user to quickly decide whether they are interested
      in viewing the full message contents. Mail clients implementing the
      <span><a href="#RFC3501" class="xref">Internet Message Access Protocol</a> [<a href="#RFC3501" class="xref">RFC3501</a>]</span>
      would benefit from a standardized, consistent way to
      generate these brief textual previews of messages.<a href="#section-1-1" class="pilcrow">¶</a></p>
<p id="section-1-2">
  Generation of a preview on the server has several benefits.  First,
  it allows consistent representation of previews across all clients.
  While different clients might generate quite different preview text,
  having common preview text generated by the server can give a more
  consistent user experience to those who use multiple clients.<a href="#section-1-2" class="pilcrow">¶</a></p>
<p id="section-1-3">Second, server-side preview generation is more efficient. A
      client-based algorithm needs to issue, at a minimum, a FETCH
      BODYSTRUCTURE command in order to determine which <span><a href="#RFC2045" class="xref">MIME</a> [<a href="#RFC2045" class="xref">RFC2045</a>]</span> body part(s) should be represented in
      the preview. Subsequently, at least one FETCH BODY command may be
      needed to retrieve body data used in preview generation. These FETCH
      commands cannot be pipelined since the BODYSTRUCTURE query must be
      parsed on the client before the list of parts to be retrieved via the
      BODY command(s) can be determined.<a href="#section-1-3" class="pilcrow">¶</a></p>
<p id="section-1-4">Additionally, it may be difficult to predict the amount of body
      data that must be retrieved to adequately represent the part via a
      preview, therefore requiring inefficient fetching of excessive data
      in order to account for this uncertainty. For example, a preview
      algorithm to display data contained in a <span><a href="#RFC2854" class="xref">text/html</a> [<a href="#RFC2854" class="xref">RFC2854</a>]</span> part will likely
      strip the markup tags to obtain textual content. However, without
      fetching the entire content of the part, there is no way to guarantee
      that sufficient non-tag content will exist unless either 1) the entire
      part is retrieved or 2) an additional partial FETCH is executed when
      the client determines that it does not possess sufficient data from a
      previous partial FETCH to display an adequate representation of the
      preview.<a href="#section-1-4" class="pilcrow">¶</a></p>
<p id="section-1-5">Finally, server generation allows caching in a centralized
      location. Using server-generated previews allows global generation
      once per message, and that preview can be cached for the retention
      period of the source message. Retrieval of message data may be
      expensive within a server, for example, so a server can be configured
      to reduce its storage retrieval load by pre-generating preview
      data.<a href="#section-1-5" class="pilcrow">¶</a></p>
<p id="section-1-6">A server indicates support for this extension via the "PREVIEW"
      capability name.<a href="#section-1-6" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Conventions">
<section id="section-2">
      <h2 id="name-conventions-used-in-this-do">
<a href="#section-2" class="section-number selfRef">2. </a><a href="#name-conventions-used-in-this-do" class="section-name selfRef">Conventions Used in This Document</a>
      </h2>
<p id="section-2-1">
    The key words "<span class="bcp14">MUST</span>", "<span class="bcp14">MUST NOT</span>",
    "<span class="bcp14">REQUIRED</span>", "<span class="bcp14">SHALL</span>", "<span class="bcp14">SHALL NOT</span>",
    "<span class="bcp14">SHOULD</span>", "<span class="bcp14">SHOULD NOT</span>",
    "<span class="bcp14">RECOMMENDED</span>", "<span class="bcp14">NOT RECOMMENDED</span>",
    "<span class="bcp14">MAY</span>", and "<span class="bcp14">OPTIONAL</span>" in this document are to be
    interpreted as described in BCP 14 <span>[<a href="#RFC2119" class="xref">RFC2119</a>]</span> <span>[<a href="#RFC8174" class="xref">RFC8174</a>]</span> when, and only when, they appear in all capitals, as
    shown here.<a href="#section-2-1" class="pilcrow">¶</a></p>
<p id="section-2-2">"User" is used to refer to a human user, whereas "client" refers to
      the software being run by the user.<a href="#section-2-2" class="pilcrow">¶</a></p>
<p id="section-2-3">In examples, "C:" and "S:" indicate lines sent by the client and
      server, respectively. If a single "C:" or "S:" label applies to
      multiple lines, then the line breaks between those lines are for
      editorial clarity only and are not part of the actual protocol
      exchange.<a href="#section-2-3" class="pilcrow">¶</a></p>
<p id="section-2-4">As with all IMAP extension documents, the case used in writing
      IMAP protocol elements herein is chosen for editorial clarity, and
      implementations must pay attention to the numbered rules at the
      beginning of <span><a href="https://www.rfc-editor.org/rfc/rfc3501#section-9" class="relref">Section 9</a> of [<a href="#RFC3501" class="xref">RFC3501</a>]</span>.<a href="#section-2-4" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Fetch">
<section id="section-3">
      <h2 id="name-fetch-data-item">
<a href="#section-3" class="section-number selfRef">3. </a><a href="#name-fetch-data-item" class="section-name selfRef">FETCH Data Item</a>
      </h2>
<section id="section-3.1">
        <h3 id="name-command">
<a href="#section-3.1" class="section-number selfRef">3.1. </a><a href="#name-command" class="section-name selfRef">Command</a>
        </h3>
<p id="section-3.1-1">To retrieve a preview for a message, the PREVIEW FETCH attribute
        is used when issuing a FETCH command.<a href="#section-3.1-1" class="pilcrow">¶</a></p>
</section>
<section id="section-3.2">
        <h3 id="name-response">
<a href="#section-3.2" class="section-number selfRef">3.2. </a><a href="#name-response" class="section-name selfRef">Response</a>
        </h3>
<p id="section-3.2-1">The server returns a variable-length string that is the generated
        preview for that message. This string is intended to be viewed by the
        user as a contextual preview of the entire message and is not
        intended to be interpreted in any way by the client software.<a href="#section-3.2-1" class="pilcrow">¶</a></p>
<p id="section-3.2-2" class="keepWithNext">Example: Retrieving preview information in a SELECTed
          mailbox.<a href="#section-3.2-2" class="pilcrow">¶</a></p>
<div id="section-3.2-3">
<pre class="sourcecode">
  C: A1 FETCH 1 (PREVIEW)
  S: * 1 FETCH (PREVIEW "Preview text!")
  S: A1 OK FETCH complete.
</pre><a href="#section-3.2-3" class="pilcrow">¶</a>
</div>
<p id="section-3.2-4">A server <span class="bcp14">SHOULD</span> strive to generate the same string for a given
        message for each request. However, since previews are understood to be
        an approximation of the message data and not a canonical view of its
        contents, a client <span class="bcp14">MUST NOT</span> assume that a message preview is
        immutable for a given message. This relaxed requirement permits a
        server to offer previews as an option without requiring potentially
        burdensome storage and/or processing requirements to guarantee
        immutability for a use case that does not require this strictness.
        For example, the underlying IMAP server may change due to a system
        software upgrade; an account's state information may be retained in
        the migration, but the new server may generate different preview
        text than the old server.<a href="#section-3.2-4" class="pilcrow">¶</a></p>
<p id="section-3.2-5">It is possible that the server has determined that no meaningful
        preview text can be generated for a particular message. Examples of
        this involve encrypted messages, content types the server does not
        support previews of, and other situations where the server is not
        able to extract information for a preview. In such cases, the
        server <span class="bcp14">MUST</span> return a zero-length string. Clients <span class="bcp14">SHOULD NOT</span> send
        another FETCH for a preview for such messages. (As discussed
        previously, preview data is not immutable, so there is chance that
        at some point in the future the server would be able to generate
        meaningful text. However, this scenario is expected to be rare, so a
        client should not continually send out requests to try to detect
        this infrequent occurrence.)<a href="#section-3.2-5" class="pilcrow">¶</a></p>
<p id="section-3.2-6">If the <span><a href="#LAZY" class="xref">LAZY modifier</a> (<a href="#LAZY" class="xref">Section 4.1</a>)</span> is
        used, the server <span class="bcp14">MAY</span> return NIL for the preview response, indicating
        that preview generation could not be completed without causing
        undue delay. A server <span class="bcp14">MUST NOT</span> return NIL to a FETCH PREVIEW request
        made without the LAZY modifier.<a href="#section-3.2-6" class="pilcrow">¶</a></p>
</section>
<section id="section-3.3">
        <h3 id="name-preview-text-format">
<a href="#section-3.3" class="section-number selfRef">3.3. </a><a href="#name-preview-text-format" class="section-name selfRef">Preview Text Format</a>
        </h3>
<p id="section-3.3-1">The generated preview text <span class="bcp14">MUST</span> be treated as
        <span><a href="#RFC2046" class="xref">text/plain</a> [<a href="#RFC2046" class="xref">RFC2046</a>]</span> media type data by the
        client.<a href="#section-3.3-1" class="pilcrow">¶</a></p>
<p id="section-3.3-2">The generated string <span class="bcp14">MUST NOT</span> be content transfer encoded and <span class="bcp14">MUST</span>
        be encoded in <span><a href="#RFC3629" class="xref">UTF-8</a> [<a href="#RFC3629" class="xref">RFC3629</a>]</span>. The server <span class="bcp14">SHOULD</span>
        remove any formatting markup and do whatever processing might be
        useful in rendering the preview as plain text.<a href="#section-3.3-2" class="pilcrow">¶</a></p>
<p id="section-3.3-3">For purposes of this section, a "preview character" is defined as a
        single Universal Character Set (UCS) character encoded in UTF-8. Note: a single preview
        character may comprise multiple octets, so any buffers implemented
        to conform to the string limitations identified in this document
        should be sized to prevent possible overflow errors.<a href="#section-3.3-3" class="pilcrow">¶</a></p>
<p id="section-3.3-4">The server <span class="bcp14">SHOULD</span> limit the length of the preview text to 200
        preview characters. This length should provide sufficient data to
        generally support both various languages (and their different average
        word lengths) and diverse client display size requirements.<a href="#section-3.3-4" class="pilcrow">¶</a></p>
<p id="section-3.3-5">The server <span class="bcp14">MUST NOT</span> output preview text longer than 256 preview
        characters.<a href="#section-3.3-5" class="pilcrow">¶</a></p>
<p id="section-3.3-6">If the preview is not generated based on the body content of the
        message, and the <span><a href="#RFC5255" class="xref">LANGUAGE extension</a> [<a href="#RFC5255" class="xref">RFC5255</a>]</span> is
        supported by the server, the preview text <span class="bcp14">SHOULD</span> be generated
        according to the language rules that apply to human-readable text.
        For example, a message that consists of a single image MIME part has
        no human-readable text from which to generate preview information.
        Instead, the server may wish to output a description that the message
        contains an image and describe some attributes of the image, such as
        image format, size, and filename. This descriptive text is not a
        product of the message body itself but is rather auto-generated data
        by the server; it should thus use the rules defined for
        human-readable text described in the LANGUAGE extension (if
        supported on the server).<a href="#section-3.3-6" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="Lazy_Modifier">
<section id="section-4">
      <h2 id="name-lazy-priority-modifier">
<a href="#section-4" class="section-number selfRef">4. </a><a href="#name-lazy-priority-modifier" class="section-name selfRef">LAZY Priority Modifier</a>
      </h2>
<div id="LAZY">
<section id="section-4.1">
        <h3 id="name-lazy">
<a href="#section-4.1" class="section-number selfRef">4.1. </a><a href="#name-lazy" class="section-name selfRef">LAZY</a>
        </h3>
<p id="section-4.1-1">The LAZY modifier directs the server to return the preview
        representation only if that data can be returned without undue
        delay to the client.<a href="#section-4.1-1" class="pilcrow">¶</a></p>
<p id="section-4.1-2">If this modifier is used, and the server is unable to return
        preview data without undue delay, the server <span class="bcp14">MUST</span> return NIL as the
        preview response.<a href="#section-4.1-2" class="pilcrow">¶</a></p>
<p id="section-4.1-3">The LAZY modifier <span class="bcp14">MUST</span> be implemented by any server that supports
        the PREVIEW extension.<a href="#section-4.1-3" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-4.2">
        <h3 id="name-client-implementation-advic">
<a href="#section-4.2" class="section-number selfRef">4.2. </a><a href="#name-client-implementation-advic" class="section-name selfRef">Client Implementation Advice</a>
        </h3>
<p id="section-4.2-1">Upon opening a mailbox, a client generally performs a FETCH of
        message details in order to create a listing to present to the user
        (e.g., ENVELOPE data). Using this extension, a client may want to
        additionally display preview information as part of this listing.
        Quickly providing the base mailbox listing with basic message
        details is the primary goal of this command as this is required
        to allow the user to begin interacting with the mailbox. Preview data
        is likely to be of secondary importance; it provides useful context,
        but it is not necessary to perform message actions. A client can
        load unavailable previews in the background and display them
        asynchronously to the user as the preview data is provided by the
        server.<a href="#section-4.2-1" class="pilcrow">¶</a></p>
<p id="section-4.2-2">In this scenario, the client would add the PREVIEW data item, with
        the LAZY modifier, to the list of FETCH items needed to generate the
        mailbox listing. This allows the server to advantageously return
        preview data without blocking the primary goal of quickly returning
        the basic message details used to generate the mailbox listing.<a href="#section-4.2-2" class="pilcrow">¶</a></p>
<p id="section-4.2-3">Once this initial FETCH is complete, the client can then issue
        FETCH requests, without the LAZY modifier, to load the PREVIEW data
        item for the messages in which preview data was not returned. It is
        <span class="bcp14">RECOMMENDED</span> that these FETCH requests be issued in small batches,
        e.g., 50 messages per FETCH command, since preview generation may be
        expensive and a single large request may exceed server resource
        limits.<a href="#section-4.2-3" class="pilcrow">¶</a></p>
<p id="section-4.2-4">See Example 2 in <a href="#Examples" class="xref">Section 5</a> for an implementation of this strategy.<a href="#section-4.2-4" class="pilcrow">¶</a></p>
<p id="section-4.2-5">A client <span class="bcp14">SHOULD NOT</span> continually issue FETCH PREVIEW
        requests with the LAZY modifier in a selected mailbox as the server is
        under no requirement to return preview information for this command,
        which could lead to an unnecessary waste of system and network
        resources.<a href="#section-4.2-5" class="pilcrow">¶</a></p>
</section>
</section>
</div>
<div id="Examples">
<section id="section-5">
      <h2 id="name-examples">
<a href="#section-5" class="section-number selfRef">5. </a><a href="#name-examples" class="section-name selfRef">Examples</a>
      </h2>
<p id="section-5-1" class="keepWithNext">Example 1: Requesting preview without LAZY
        modifier.<a href="#section-5-1" class="pilcrow">¶</a></p>
<div id="section-5-2">
<pre class="sourcecode">
  C: A1 CAPABILITY
  S: * CAPABILITY IMAP4rev1 PREVIEW
  S: A1 OK Capability command completed.
  [...a mailbox is SELECTed...]
  C: A2 FETCH 1 (RFC822.SIZE PREVIEW)
  S: * 1 FETCH (RFC822.SIZE 5647 PREVIEW {200}
  S: Lorem ipsum dolor sit amet, consectetur adipiscing elit.
  S: Curabitur aliquam turpis et ante dictum, et pulvinar dui congue.
  S: Maecenas hendrerit, lorem non imperdiet pellentesque, nulla
  S: ligula nullam
  S: )
  S: A2 OK FETCH complete.
</pre><a href="#section-5-2" class="pilcrow">¶</a>
</div>
<p id="section-5-3" class="keepWithNext">Example 2: Requesting preview with LAZY modifier, to
        obtain previews during initial mailbox listing if readily
        available; otherwise, load previews in background.<a href="#section-5-3" class="pilcrow">¶</a></p>
<div id="section-5-4">
<pre class="sourcecode">
  C: B1 FETCH 1:4 (ENVELOPE PREVIEW (LAZY))
  S: * 1 FETCH (ENVELOPE ("Wed, 23 Sep 2020 15:03:11 +0000" [...])
     PREVIEW "Preview text for message 1.")
  S: * 2 FETCH (PREVIEW "" ENVELOPE
     ("Thu, 24 Sep 2020 12:17:23 +0000" [...]))
  S: * 3 FETCH (ENVELOPE ("Fri, 25 Sep 2020 09:13:45 +0000" [...])
     PREVIEW NIL)
  S: * 4 FETCH (ENVELOPE ("Sat, 26 Sep 2020 07:11:18 +0000" [...])
     PREVIEW NIL)
  S: B1 OK FETCH completed.
  [...Client has preview for message 1 and knows that message 2 has
      a preview that is empty; only need to request preview of
      messages 3 &amp; 4 (e.g., in background)...]
  C: B2 FETCH 3:4 (PREVIEW)
  S: * 3 FETCH (PREVIEW {30}
  S: Message data from message 3.
  S: )
  S: * 4 FETCH (PREVIEW "Message 4 preview")
  S: B2 OK Fetch completed.
</pre><a href="#section-5-4" class="pilcrow">¶</a>
</div>
<p id="section-5-5" class="keepWithNext">Example 3: Requesting preview for
      search results within a single mailbox. Use the <span><a href="#RFC5182" class="xref">SEARCHRES extension</a> [<a href="#RFC5182" class="xref">RFC5182</a>]</span> to save a round-trip.<a href="#section-5-5" class="pilcrow">¶</a></p>
<div id="section-5-6">
<pre class="sourcecode">
  C: C1 CAPABILITY
  S: * CAPABILITY IMAP4rev1 PREVIEW SEARCHRES
  S: C1 OK Capability command completed.
  [...a mailbox is SELECTed...]
  C: C2 SEARCH RETURN (SAVE) FROM "FOO"
  C: C3 FETCH $ (UID PREVIEW (LAZY))
  S: C2 OK SEARCH completed.
  S: * 5 FETCH (UID 13 PREVIEW "Preview!")
  S: * 9 FETCH (UID 23 PREVIEW NIL)
  S: C3 OK FETCH completed.
  [...Retrieve message 9 preview in background...]
  C: C4 UID FETCH 23 (PREVIEW)
  S: * 9 FETCH (UID 23 PREVIEW "Another preview!")
  S: C4 OK FETCH completed.
</pre><a href="#section-5-6" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="Syntax">
<section id="section-6">
      <h2 id="name-formal-syntax">
<a href="#section-6" class="section-number selfRef">6. </a><a href="#name-formal-syntax" class="section-name selfRef">Formal Syntax</a>
      </h2>
<p id="section-6-1">The following syntax specification uses the Augmented Backus-Naur
      Form (ABNF) as described in <span>[<a href="#RFC5234" class="xref">RFC5234</a>]</span>. It
      includes definitions from <span><a href="#RFC3501" class="xref">IMAP</a> [<a href="#RFC3501" class="xref">RFC3501</a>]</span>.<a href="#section-6-1" class="pilcrow">¶</a></p>
<div id="section-6-2">
<pre class="sourcecode lang-abnf">
  capability        =/ "PREVIEW"

  fetch-att         =/ "PREVIEW" [SP "(" preview-mod *(SP
                       preview-mod) ")"]

  msg-att-dynamic   =/ "PREVIEW" SP nstring

  preview-mod       =  "LAZY"
</pre><a href="#section-6-2" class="pilcrow">¶</a>
</div>
</section>
</div>
<div id="IANA">
<section id="section-7">
      <h2 id="name-iana-considerations">
<a href="#section-7" class="section-number selfRef">7. </a><a href="#name-iana-considerations" class="section-name selfRef">IANA Considerations</a>
      </h2>
<p id="section-7-1"><span><a href="#RFC3501" class="xref">IMAP</a> [<a href="#RFC3501" class="xref">RFC3501</a>]</span> capabilities are
      registered by publishing a Standards Track or IESG-approved Experimental
      RFC in the "IMAP Capabilities" registry located at <span>&lt;<a href="http://www.iana.org/assignments/imap-capabilities">http://www.iana.org/assignments/imap-capabilities</a>&gt;</span>.<a href="#section-7-1" class="pilcrow">¶</a></p>
<p id="section-7-2">IANA has added the "PREVIEW" capability to this registry.<a href="#section-7-2" class="pilcrow">¶</a></p>
</section>
</div>
<div id="Security">
<section id="section-8">
      <h2 id="name-security-considerations">
<a href="#section-8" class="section-number selfRef">8. </a><a href="#name-security-considerations" class="section-name selfRef">Security Considerations</a>
      </h2>
<p id="section-8-1">Implementation of this extension might enable denial-of-service
      attacks against server resources, due to excessive memory or CPU usage
      during preview generation or increased storage usage if preview results
      are stored on the server after generation. In order to mitigate such
      attacks, servers <span class="bcp14">SHOULD</span> log the client authentication identity on FETCH
      PREVIEW operations in order to facilitate tracking of abusive
      clients.<a href="#section-8-1" class="pilcrow">¶</a></p>
<p id="section-8-2">Servers <span class="bcp14">MAY</span> limit the resources that preview generation uses. Such
      resource limitations might, in an extreme example, cause a server to
      return a preview that is the empty string for a message that otherwise
      would have had a non-empty preview. However, it is recommended that at
      least some preview text be provided in this situation, even if the
      quality of the preview is degraded.<a href="#section-8-2" class="pilcrow">¶</a></p>
<p id="section-8-3">Just as the messages they summarize, preview data may contain
      sensitive information. If generated preview data is stored on the
      server, e.g., for caching purposes, these previews <span class="bcp14">MUST</span> be protected with
      equivalent authorization and confidentiality controls as the source
      message.<a href="#section-8-3" class="pilcrow">¶</a></p>
</section>
</div>
<section id="section-9">
      <h2 id="name-references">
<a href="#section-9" class="section-number selfRef">9. </a><a href="#name-references" class="section-name selfRef">References</a>
      </h2>
<section id="section-9.1">
        <h3 id="name-normative-references">
<a href="#section-9.1" class="section-number selfRef">9.1. </a><a href="#name-normative-references" class="section-name selfRef">Normative References</a>
        </h3>
<dl class="references">
<dt id="RFC2046">[RFC2046]</dt>
        <dd>
<span class="refAuthor">Freed, N.</span><span class="refAuthor"> and N. Borenstein</span>, <span class="refTitle">"Multipurpose Internet Mail Extensions (MIME) Part Two: Media Types"</span>, <span class="seriesInfo">RFC 2046</span>, <span class="seriesInfo">DOI 10.17487/RFC2046</span>, <time datetime="1996-11" class="refDate">November 1996</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2046">https://www.rfc-editor.org/info/rfc2046</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2119">[RFC2119]</dt>
        <dd>
<span class="refAuthor">Bradner, S.</span>, <span class="refTitle">"Key words for use in RFCs to Indicate Requirement Levels"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 2119</span>, <span class="seriesInfo">DOI 10.17487/RFC2119</span>, <time datetime="1997-03" class="refDate">March 1997</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2119">https://www.rfc-editor.org/info/rfc2119</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3501">[RFC3501]</dt>
        <dd>
<span class="refAuthor">Crispin, M.</span>, <span class="refTitle">"INTERNET MESSAGE ACCESS PROTOCOL - VERSION 4rev1"</span>, <span class="seriesInfo">RFC 3501</span>, <span class="seriesInfo">DOI 10.17487/RFC3501</span>, <time datetime="2003-03" class="refDate">March 2003</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3501">https://www.rfc-editor.org/info/rfc3501</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC3629">[RFC3629]</dt>
        <dd>
<span class="refAuthor">Yergeau, F.</span>, <span class="refTitle">"UTF-8, a transformation format of ISO 10646"</span>, <span class="seriesInfo">STD 63</span>, <span class="seriesInfo">RFC 3629</span>, <span class="seriesInfo">DOI 10.17487/RFC3629</span>, <time datetime="2003-11" class="refDate">November 2003</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc3629">https://www.rfc-editor.org/info/rfc3629</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5234">[RFC5234]</dt>
        <dd>
<span class="refAuthor">Crocker, D., Ed.</span><span class="refAuthor"> and P. Overell</span>, <span class="refTitle">"Augmented BNF for Syntax Specifications: ABNF"</span>, <span class="seriesInfo">STD 68</span>, <span class="seriesInfo">RFC 5234</span>, <span class="seriesInfo">DOI 10.17487/RFC5234</span>, <time datetime="2008-01" class="refDate">January 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5234">https://www.rfc-editor.org/info/rfc5234</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5255">[RFC5255]</dt>
        <dd>
<span class="refAuthor">Newman, C.</span><span class="refAuthor">, Gulbrandsen, A.</span><span class="refAuthor">, and A. Melnikov</span>, <span class="refTitle">"Internet Message Access Protocol Internationalization"</span>, <span class="seriesInfo">RFC 5255</span>, <span class="seriesInfo">DOI 10.17487/RFC5255</span>, <time datetime="2008-06" class="refDate">June 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5255">https://www.rfc-editor.org/info/rfc5255</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC8174">[RFC8174]</dt>
      <dd>
<span class="refAuthor">Leiba, B.</span>, <span class="refTitle">"Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words"</span>, <span class="seriesInfo">BCP 14</span>, <span class="seriesInfo">RFC 8174</span>, <span class="seriesInfo">DOI 10.17487/RFC8174</span>, <time datetime="2017-05" class="refDate">May 2017</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc8174">https://www.rfc-editor.org/info/rfc8174</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
<section id="section-9.2">
        <h3 id="name-informative-references">
<a href="#section-9.2" class="section-number selfRef">9.2. </a><a href="#name-informative-references" class="section-name selfRef">Informative References</a>
        </h3>
<dl class="references">
<dt id="RFC2045">[RFC2045]</dt>
        <dd>
<span class="refAuthor">Freed, N.</span><span class="refAuthor"> and N. Borenstein</span>, <span class="refTitle">"Multipurpose Internet Mail Extensions (MIME) Part One: Format of Internet Message Bodies"</span>, <span class="seriesInfo">RFC 2045</span>, <span class="seriesInfo">DOI 10.17487/RFC2045</span>, <time datetime="1996-11" class="refDate">November 1996</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2045">https://www.rfc-editor.org/info/rfc2045</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC2854">[RFC2854]</dt>
        <dd>
<span class="refAuthor">Connolly, D.</span><span class="refAuthor"> and L. Masinter</span>, <span class="refTitle">"The 'text/html' Media Type"</span>, <span class="seriesInfo">RFC 2854</span>, <span class="seriesInfo">DOI 10.17487/RFC2854</span>, <time datetime="2000-06" class="refDate">June 2000</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc2854">https://www.rfc-editor.org/info/rfc2854</a>&gt;</span>. </dd>
<dd class="break"></dd>
<dt id="RFC5182">[RFC5182]</dt>
      <dd>
<span class="refAuthor">Melnikov, A.</span>, <span class="refTitle">"IMAP Extension for Referencing the Last SEARCH Result"</span>, <span class="seriesInfo">RFC 5182</span>, <span class="seriesInfo">DOI 10.17487/RFC5182</span>, <time datetime="2008-03" class="refDate">March 2008</time>, <span>&lt;<a href="https://www.rfc-editor.org/info/rfc5182">https://www.rfc-editor.org/info/rfc5182</a>&gt;</span>. </dd>
<dd class="break"></dd>
</dl>
</section>
</section>
<div id="Acknowledgments">
<section id="section-appendix.a">
      <h2 id="name-acknowledgments">
<a href="#name-acknowledgments" class="section-name selfRef">Acknowledgments</a>
      </h2>
<p id="section-appendix.a-1">The author would like to thank the following people for their
      comments and contributions to this document: <span class="contact-name">Stephan       Bosch</span>, <span class="contact-name">Bron Gondwana</span>, <span class="contact-name">Teemu       Huovila</span>, <span class="contact-name">Neil Jenkins</span>, <span class="contact-name">Steffen Lehmann</span>, <span class="contact-name">Barry Leiba</span>,
      <span class="contact-name">Alexey Melnikov</span>, <span class="contact-name">Chris       Newman</span>, <span class="contact-name">Pete Resnick</span>, <span class="contact-name">Jeff       Sipek</span>, <span class="contact-name">Timo Sirainen</span>, <span class="contact-name">Steffen Templin</span>, and <span class="contact-name">Aki Tuomi</span>.<a href="#section-appendix.a-1" class="pilcrow">¶</a></p>
</section>
</div>
<div id="authors-addresses">
<section id="section-appendix.b">
      <h2 id="name-authors-address">
<a href="#name-authors-address" class="section-name selfRef">Author's Address</a>
      </h2>
<address class="vcard">
        <div dir="auto" class="left"><span class="fn nameRole">Michael M. Slusarz</span></div>
<div dir="auto" class="left"><span class="org">Open-Xchange Inc.</span></div>
<div dir="auto" class="left"><span class="street-address">530 Lytton Avenue</span></div>
<div dir="auto" class="left">
<span class="locality">Palo Alto</span>, <span class="region">California</span> <span class="postal-code">94301</span>
</div>
<div dir="auto" class="left"><span class="country-name">United States of America</span></div>
<div class="email">
<span>Email:</span>
<a href="mailto:michael.slusarz@open-xchange.com" class="email">michael.slusarz@open-xchange.com</a>
</div>
</address>
</section>
</div>
<script>const toc = document.getElementById("toc");
toc.querySelector("h2").addEventListener("click", e => {
  toc.classList.toggle("active");
});
toc.querySelector("nav").addEventListener("click", e => {
  toc.classList.remove("active");
});
</script>
</body>
</html>
