<?xml version='1.0' encoding='utf-8'?>
<rfc xmlns:xi="http://www.w3.org/2001/XInclude" version="3" category="info" consensus="true" docName="draft-irtf-cfrg-randomness-improvements-14" indexInclude="true" ipr="trust200902" number="8937" prepTime="2020-10-17T05:23:53" scripts="Common,Latin" sortRefs="true" submissionType="IRTF" symRefs="true" tocDepth="3" tocInclude="true" xml:lang="en">
  <link href="https://datatracker.ietf.org/doc/draft-irtf-cfrg-randomness-improvements-14" rel="prev"/>
  <link href="https://dx.doi.org/10.17487/rfc8937" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  <front>
    <title abbrev="Randomness Improvements">Randomness Improvements for Security Protocols</title>
    <seriesInfo name="RFC" value="8937" stream="IRTF"/>
    <author initials="C." surname="Cremers" fullname="Cas Cremers">
      <organization showOnFrontPage="true">CISPA</organization>
      <address>
        <postal>
          <street>Saarland Informatics Campus</street>
          <city>Saarbruecken</city>
          <country>Germany</country>
        </postal>
        <email>cremers@cispa.saarland</email>
      </address>
    </author>
    <author initials="L." surname="Garratt" fullname="Luke Garratt">
      <organization showOnFrontPage="true">Cisco Meraki</organization>
      <address>
        <postal>
          <street>500 Terry A Francois Blvd</street>
          <city>San Francisco</city>
          <country>United States of America</country>
        </postal>
        <email>lgarratt@cisco.com</email>
      </address>
    </author>
    <author initials="S." surname="Smyshlyaev" fullname="Stanislav Smyshlyaev">
      <organization showOnFrontPage="true">CryptoPro</organization>
      <address>
        <postal>
          <street>18, Suschevsky val</street>
          <city>Moscow</city>
          <country>Russian Federation</country>
        </postal>
        <email>svs@cryptopro.ru</email>
      </address>
    </author>
    <author initials="N." surname="Sullivan" fullname="Nick Sullivan">
      <organization showOnFrontPage="true">Cloudflare</organization>
      <address>
        <postal>
          <street>101 Townsend St</street>
          <city>San Francisco</city>
          <country>United States of America</country>
        </postal>
        <email>nick@cloudflare.com</email>
      </address>
    </author>
    <author initials="C." surname="Wood" fullname="Christopher A. Wood">
      <organization showOnFrontPage="true">Cloudflare</organization>
      <address>
        <postal>
          <street>101 Townsend St</street>
          <city>San Francisco</city>
          <country>United States of America</country>
        </postal>
        <email>caw@heapingbits.net</email>
      </address>
    </author>
    <date month="10" year="2020"/>
    <workgroup>Crypto Forum</workgroup>
    <keyword>Security</keyword>
    <keyword>Cryptography</keyword>
    <keyword>TLS</keyword>
    <abstract pn="section-abstract">
      <t indent="0" pn="section-abstract-1">Randomness is a crucial ingredient for Transport Layer Security (TLS)
      and related security protocols. 

Weak or predictable
      "cryptographically secure" pseudorandom number generators (CSPRNGs) can
      be abused or exploited for malicious purposes. An initial entropy source
      that seeds a CSPRNG might be weak or broken as well, which can also lead
      to critical and systemic security problems. This document describes a
      way for security protocol implementations to augment their CSPRNGs using
      long-term private keys. This improves randomness from broken or
      otherwise subverted CSPRNGs.</t>
      <t indent="0" pn="section-abstract-2">This document is a product of the Crypto Forum Research Group (CFRG) in the IRTF.</t>
    </abstract>
    <boilerplate>
      <section anchor="status-of-memo" numbered="false" removeInRFC="false" toc="exclude" pn="section-boilerplate.1">
        <name slugifiedName="name-status-of-this-memo">Status of This Memo</name>
        <t indent="0" pn="section-boilerplate.1-1">
            This document is not an Internet Standards Track specification; it is
            published for informational purposes.  
        </t>
        <t indent="0" pn="section-boilerplate.1-2">
            This document is a product of the Internet Research Task Force
            (IRTF).  The IRTF publishes the results of Internet-related
            research and development activities.  These results might not be
            suitable for deployment.  This RFC represents the consensus of the Crypto Forum
            Research Group of the Internet Research Task Force (IRTF).
            Documents approved for publication by the IRSG are not a
            candidate for any level of Internet Standard; see Section 2 of RFC
            7841.   
        </t>
        <t indent="0" pn="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <eref target="https://www.rfc-editor.org/info/rfc8937" brackets="none"/>.
        </t>
      </section>
      <section anchor="copyright" numbered="false" removeInRFC="false" toc="exclude" pn="section-boilerplate.2">
        <name slugifiedName="name-copyright-notice">Copyright Notice</name>
        <t indent="0" pn="section-boilerplate.2-1">
            Copyright (c) 2020 IETF Trust and the persons identified as the
            document authors. All rights reserved.
        </t>
        <t indent="0" pn="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<eref target="https://trustee.ietf.org/license-info" brackets="none"/>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document.
        </t>
      </section>
    </boilerplate>
    <toc>
      <section anchor="toc" numbered="false" removeInRFC="false" toc="exclude" pn="section-toc.1">
        <name slugifiedName="name-table-of-contents">Table of Contents</name>
        <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1">
          <li pn="section-toc.1-1.1">
            <t indent="0" keepWithNext="true" pn="section-toc.1-1.1.1"><xref derivedContent="1" format="counter" sectionFormat="of" target="section-1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-introduction">Introduction</xref></t>
          </li>
          <li pn="section-toc.1-1.2">
            <t indent="0" keepWithNext="true" pn="section-toc.1-1.2.1"><xref derivedContent="2" format="counter" sectionFormat="of" target="section-2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-conventions-used-in-this-do">Conventions Used in This Document</xref></t>
          </li>
          <li pn="section-toc.1-1.3">
            <t indent="0" keepWithNext="true" pn="section-toc.1-1.3.1"><xref derivedContent="3" format="counter" sectionFormat="of" target="section-3"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-randomness-wrapper">Randomness Wrapper</xref></t>
          </li>
          <li pn="section-toc.1-1.4">
            <t indent="0" pn="section-toc.1-1.4.1"><xref derivedContent="4" format="counter" sectionFormat="of" target="section-4"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-tag-generation">Tag Generation</xref></t>
          </li>
          <li pn="section-toc.1-1.5">
            <t indent="0" pn="section-toc.1-1.5.1"><xref derivedContent="5" format="counter" sectionFormat="of" target="section-5"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-application-to-tls">Application to TLS</xref></t>
          </li>
          <li pn="section-toc.1-1.6">
            <t indent="0" pn="section-toc.1-1.6.1"><xref derivedContent="6" format="counter" sectionFormat="of" target="section-6"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-implementation-guidance">Implementation Guidance</xref></t>
          </li>
          <li pn="section-toc.1-1.7">
            <t indent="0" pn="section-toc.1-1.7.1"><xref derivedContent="7" format="counter" sectionFormat="of" target="section-7"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-iana-considerations">IANA Considerations</xref></t>
          </li>
          <li pn="section-toc.1-1.8">
            <t indent="0" pn="section-toc.1-1.8.1"><xref derivedContent="8" format="counter" sectionFormat="of" target="section-8"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-security-considerations">Security Considerations</xref></t>
          </li>
          <li pn="section-toc.1-1.9">
            <t indent="0" pn="section-toc.1-1.9.1"><xref derivedContent="9" format="counter" sectionFormat="of" target="section-9"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-comparison-to-rfc-6979">Comparison to RFC 6979</xref></t>
          </li>
          <li pn="section-toc.1-1.10">
            <t indent="0" pn="section-toc.1-1.10.1"><xref derivedContent="10" format="counter" sectionFormat="of" target="section-10"/>. <xref derivedContent="" format="title" sectionFormat="of" target="name-references">References</xref></t>
            <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.10.2">
              <li pn="section-toc.1-1.10.2.1">
                <t indent="0" pn="section-toc.1-1.10.2.1.1"><xref derivedContent="10.1" format="counter" sectionFormat="of" target="section-10.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-normative-references">Normative References</xref></t>
              </li>
              <li pn="section-toc.1-1.10.2.2">
                <t indent="0" pn="section-toc.1-1.10.2.2.1"><xref derivedContent="10.2" format="counter" sectionFormat="of" target="section-10.2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-informative-references">Informative References</xref></t>
              </li>
            </ul>
          </li>
          <li pn="section-toc.1-1.11">
            <t indent="0" pn="section-toc.1-1.11.1"><xref derivedContent="" format="none" sectionFormat="of" target="section-appendix.a"/><xref derivedContent="" format="title" sectionFormat="of" target="name-acknowledgements">Acknowledgements</xref></t>
          </li>
          <li pn="section-toc.1-1.12">
            <t indent="0" pn="section-toc.1-1.12.1"><xref derivedContent="" format="none" sectionFormat="of" target="section-appendix.b"/><xref derivedContent="" format="title" sectionFormat="of" target="name-authors-addresses">Authors' Addresses</xref></t>
          </li>
        </ul>
      </section>
    </toc>
  </front>
  <middle>
    <section anchor="introduction" numbered="true" toc="include" removeInRFC="false" pn="section-1">
      <name slugifiedName="name-introduction">Introduction</name>
      <t indent="0" pn="section-1-1">Secure and properly implemented random number generators, or
      "cryptographically secure" pseudorandom number generators (CSPRNGs),
      should produce output that is indistinguishable from a random string of
      the same length. CSPRNGs are critical building blocks for TLS and
      related transport security protocols. TLS in particular uses CSPRNGs to
      generate several values, such as ephemeral key shares and ClientHello
      and ServerHello random values. CSPRNG failures, such as the Debian bug
      described in <xref target="DebianBug" format="default" sectionFormat="of" derivedContent="DebianBug"/>, can lead to
      insecure TLS connections. CSPRNGs may also be intentionally weakened to
      cause harm <xref target="DualEC" format="default" sectionFormat="of" derivedContent="DualEC"/>. Initial entropy
      sources can also be weak or broken, and that would lead to insecurity of
      all CSPRNG instances seeded with them. In such cases where CSPRNGs are
      poorly implemented or insecure, an adversary, Adv, may be able to
      distinguish its output from a random string or predict its output and
      recover secret key material used to protect the connection.</t>
      <t indent="0" pn="section-1-2">This document proposes an improvement to randomness generation in
      security protocols inspired by the "NAXOS trick" <xref target="NAXOS" format="default" sectionFormat="of" derivedContent="NAXOS"/>. Specifically, instead of using raw randomness where
      needed, e.g., in generating ephemeral key shares, a function of a
      party's long-term private key is mixed into the entropy pool. In the
      NAXOS key exchange protocol, raw random value x is replaced by H(x, sk),
      where sk is the sender's private key. Unfortunately, as private keys are
      often isolated in Hardware Security Modules (HSMs), direct access to
      compute H(x, sk) is impossible. Moreover, some HSM APIs may only offer
      the option to sign messages using a private key, yet offer no other
      operations involving that key. An alternate, yet functionally equivalent
      construction, is needed.</t>
      <t indent="0" pn="section-1-3">The approach described herein replaces the NAXOS hash with a keyed
      hash, or pseudorandom function (PRF), where the key is derived from a
      raw random value and a private key signature. 


Implementations
      <bcp14>SHOULD</bcp14> apply this technique a) when indirect access to a
      private key is available and CSPRNG randomness guarantees are dubious
      or b) to provide stronger guarantees about possible future issues with the
      randomness. Roughly, the security properties provided by the proposed
      construction are as follows:</t>
      <ol spacing="normal" type="1" indent="adaptive" start="1" pn="section-1-4">
        <li pn="section-1-4.1" derivedCounter="1.">If the CSPRNG works fine (that is, in a certain adversary model,
	the CSPRNG output is indistinguishable from a truly random sequence),
	then the output of the proposed construction is also indistinguishable
	from a truly random sequence in that adversary model.</li>
        <li pn="section-1-4.2" derivedCounter="2.">Adv with full control of a (potentially broken) CSPRNG and ability
	to observe all outputs of the proposed construction does not obtain
	any non-negligible advantage in leaking the private key (in the
	absence of side channel attacks).</li>
        <li pn="section-1-4.3" derivedCounter="3.">If the CSPRNG is broken or controlled by Adv, the output of the
	proposed construction remains indistinguishable from random, provided that
	the private key remains unknown to Adv.</li>
      </ol>
      <t indent="0" pn="section-1-5">This document represents the consensus of the Crypto Forum Research Group (CFRG).</t>
    </section>
    <section anchor="conventions-used-in-this-document" numbered="true" toc="include" removeInRFC="false" pn="section-2">
      <name slugifiedName="name-conventions-used-in-this-do">Conventions Used in This Document</name>
      <t indent="0" pn="section-2-1">
    The key words "<bcp14>MUST</bcp14>", "<bcp14>MUST NOT</bcp14>",
    "<bcp14>REQUIRED</bcp14>", "<bcp14>SHALL</bcp14>", "<bcp14>SHALL NOT</bcp14>", "<bcp14>SHOULD</bcp14>", "<bcp14>SHOULD NOT</bcp14>",
    "<bcp14>RECOMMENDED</bcp14>", "<bcp14>NOT RECOMMENDED</bcp14>", 
    "<bcp14>MAY</bcp14>", and "<bcp14>OPTIONAL</bcp14>" in this document are to be interpreted as
    described in BCP 14 <xref target="RFC2119" format="default" sectionFormat="of" derivedContent="RFC2119"/> <xref target="RFC8174" format="default" sectionFormat="of" derivedContent="RFC8174"/> 
    when, and only when, they appear in all capitals, as shown here.
      </t>
    </section>
    <section anchor="wrapper" numbered="true" toc="include" removeInRFC="false" pn="section-3">
      <name slugifiedName="name-randomness-wrapper">Randomness Wrapper</name>
      <t indent="0" pn="section-3-1">The output of a properly instantiated CSPRNG should be
      indistinguishable from a random string of the same length. However, as
      previously discussed, this is not always true. To mitigate this problem,
      we propose an approach for wrapping the CSPRNG output with a
      construction that mixes secret data into a value that may be lacking
      randomness.</t>
      <t indent="0" pn="section-3-2">Let G(n) be an algorithm that generates n random bytes, i.e., the
      output of a CSPRNG. Define an augmented CSPRNG G' as follows. Let
      Sig(sk, m) be a function that computes a signature of message m given
      private key sk. Let H be a cryptographic hash function that produces
      output of length M. Let Extract(salt, IKM) be a randomness extraction
      function, e.g., HKDF-Extract <xref target="RFC5869" format="default" sectionFormat="of" derivedContent="RFC5869"/>,
      which accepts a salt and input keying material (IKM) parameter and
      produces a pseudorandom key of L bytes suitable for cryptographic
      use. It must be a secure PRF (for salt as a key of length M) and
      preserve uniformness of IKM (for details, see <xref target="SecAnalysis" format="default" sectionFormat="of" derivedContent="SecAnalysis"/>). L <bcp14>SHOULD</bcp14> be a fixed length. Let
      Expand(k, info, n) be a variable-length output PRF, e.g., HKDF-Expand
      <xref target="RFC5869" format="default" sectionFormat="of" derivedContent="RFC5869"/>, that takes as input a
      pseudorandom key k of L bytes, info string, and output length n, and
      produces output of n bytes. Finally, let tag1 be a fixed,
      context-dependent string, and let tag2 be a dynamically changing string
      (e.g., a counter) of L' bytes. We require that L &gt;= n - L' for each
      value of tag2.</t>
      <t indent="0" pn="section-3-3">The construction works as follows. Instead of using G(n) when
      randomness is needed, use G'(n), where</t>
      <artwork name="" type="" align="left" alt="" pn="section-3-4">
       G'(n) = Expand(Extract(H(Sig(sk, tag1)), G(L)), tag2, n)
</artwork>
      <t indent="0" pn="section-3-5">Functionally, this expands n random bytes from a key derived from the
      CSPRNG output and signature over a fixed string (tag1). See <xref target="tag-gen" format="default" sectionFormat="of" derivedContent="Section 4"/> for details about how "tag1" and
      "tag2" should be generated and used per invocation of the randomness
      wrapper. Expand() generates a string that is computationally
      indistinguishable from a truly random string of n bytes. Thus, the
      security of this construction depends upon the secrecy of H(Sig(sk,
      tag1)) and G(L). If the signature is leaked, then security of G'(n)
      reduces to the scenario wherein randomness is expanded directly from
      G(L).</t>
      <t indent="0" pn="section-3-6">If a private key sk is stored and used inside an HSM, then the
      signature calculation is implemented inside it, while all other
      operations (including calculation of a hash function, Extract function, and Expand
      function) can be implemented either inside or outside the HSM.</t>
      <t indent="0" pn="section-3-7">Sig(sk, tag1) need only be computed once for the lifetime of the
      randomness wrapper and <bcp14>MUST NOT</bcp14> be used or exposed
      beyond its role in this computation. Additional recommendations for tag1
      are given in the following section.</t>
      <t indent="0" pn="section-3-8">Sig <bcp14>MUST</bcp14> be a deterministic signature function, e.g.,
      deterministic Elliptic Curve Digital Signature Algorithm (ECDSA) <xref target="RFC6979" format="default" sectionFormat="of" derivedContent="RFC6979"/>, or use an 
      independent (and completely reliable) entropy source, e.g., if Sig is
      implemented in an HSM with its own internal trusted entropy source for
      signature generation.</t>
      <t indent="0" pn="section-3-9">Because Sig(sk, tag1) can be cached, the relative cost of using G'(n)
      instead of G(n) tends to be negligible with respect to cryptographic
      operations in protocols such as TLS (the relatively inexpensive
      computational cost of HKDF-Extract and HKDF-Expand dominates when
      comparing G' to G). A description of the performance experiments and
      their results can be found in <xref target="SecAnalysis" format="default" sectionFormat="of" derivedContent="SecAnalysis"/>.</t>
      <t indent="0" pn="section-3-10">Moreover, the values of G'(n) may be precomputed and pooled. This is
      possible since the construction depends solely upon the CSPRNG output
      and private key.</t>
    </section>
    <section anchor="tag-gen" numbered="true" toc="include" removeInRFC="false" pn="section-4">
      <name slugifiedName="name-tag-generation">Tag Generation</name>
      <t indent="0" pn="section-4-1">Both tags <bcp14>MUST</bcp14> be generated such that they never
      collide with another contender or owner of the private key. This can
      happen if, for example, one HSM with a private key is used from several
      servers or if virtual machines are cloned.</t>
      <t indent="0" pn="section-4-2">The <bcp14>RECOMMENDED</bcp14> tag construction procedure is as follows:</t>
      <dl newline="false" spacing="normal" indent="7" pn="section-4-3">
        <dt pn="section-4-3.1">tag1:</dt>
        <dd pn="section-4-3.2">Constant string bound to a specific device and protocol in
	use. This allows caching of Sig(sk, tag1). Device-specific information
	may include, for example, a Media Access Control (MAC) address. To
	provide security in the 
	cases of usage of CSPRNGs in virtual environments, it is
	<bcp14>RECOMMENDED</bcp14> to incorporate all available information
	specific to the process that would ensure the uniqueness of each tag1
	value among different instances of virtual machines (including ones
	that were cloned or recovered from snapshots). This is needed to
	address the problem of CSPRNG state cloning (see <xref target="RY2010" format="default" sectionFormat="of" derivedContent="RY2010"/>). See <xref target="sec_tls13" format="default" sectionFormat="of" derivedContent="Section 5"/>
	for example protocol information that can be used in the context of
	TLS 1.3. If sk could be used for other purposes, then selecting a
	value for tag1 that is different than the form allowed by those other
	uses ensures that the signature is not exposed.</dd>
        <dt pn="section-4-3.3">tag2:</dt>
        <dd pn="section-4-3.4">A nonce, that is, a value that is unique for each use of the same
	combination of G(L), tag1, and sk values. The tag2 value can be
	implemented using a counter or a timer, provided that the timer is
	guaranteed to be different for each invocation of G'(n).</dd>
      </dl>
    </section>
    <section anchor="sec_tls13" numbered="true" toc="include" removeInRFC="false" pn="section-5">
      <name slugifiedName="name-application-to-tls">Application to TLS</name>
      <t indent="0" pn="section-5-1">The PRF randomness wrapper can be applied to any protocol wherein a
      party has a long-term private key and also generates randomness. This is
      true of most TLS servers. Thus, to apply this construction to TLS, one
      simply replaces the "private" CSPRNG G(n), i.e., the CSPRNG that
      generates private values, such as key shares, with</t>
      <artwork name="" type="" align="left" alt="" pn="section-5-2">
G'(n) = HKDF-Expand(HKDF-Extract(H(Sig(sk, tag1)), G(L)), tag2, n)
</artwork>
    </section>
    <section anchor="implementation-guidance" numbered="true" toc="include" removeInRFC="false" pn="section-6">
      <name slugifiedName="name-implementation-guidance">Implementation Guidance</name>
      <t indent="0" pn="section-6-1">Recall that the wrapper defined in <xref target="wrapper" format="default" sectionFormat="of" derivedContent="Section 3"/> requires L &gt;= n - L', where L is the Extract
      output length and n is the desired amount of randomness. Some
      applications may require n to exceed this bound. Wrapper implementations
      can support this use case by invoking G' multiple times and
      concatenating the results.</t>
    </section>
    <section anchor="iana-considerations" numbered="true" toc="include" removeInRFC="false" pn="section-7">
      <name slugifiedName="name-iana-considerations">IANA Considerations</name>
      <t indent="0" pn="section-7-1">This document has no IANA actions.</t>
    </section>
    <section anchor="security-considerations" numbered="true" toc="include" removeInRFC="false" pn="section-8">
      <name slugifiedName="name-security-considerations">Security Considerations</name>
      <t indent="0" pn="section-8-1">A security analysis was performed in <xref target="SecAnalysis" format="default" sectionFormat="of" derivedContent="SecAnalysis"/>. Generally speaking, the following security theorem
      has been proven: if Adv learns only one of the signature or the usual
      randomness generated on one particular instance, then, under the security
      assumptions on our primitives, the wrapper construction should output
      randomness that is indistinguishable from a random string.</t>
      <t indent="0" pn="section-8-2">The main reason one might expect the signature to be exposed is via a
      side-channel attack. It is therefore prudent when implementing this
      construction to take into consideration the extra long-term key
      operation if equipment is used in a hostile environment when such
      considerations are necessary. Hence, it is recommended to generate a key
      specifically for the purposes of the defined construction and not to use it another way.</t>
      <t indent="0" pn="section-8-3">The signature in the construction, as well as in the protocol itself,
      <bcp14>MUST NOT</bcp14> use randomness from entropy sources with dubious
      security guarantees. Thus, the signature scheme <bcp14>MUST</bcp14>
      either use a reliable entropy source (independent from the CSPRNG that
      is being improved with the proposed construction) or be deterministic;
      if the signatures are probabilistic and use weak entropy, our
      construction does not help, and the signatures are still vulnerable due
      to repeat randomness attacks. In such an attack, Adv might be able to
      recover the long-term key used in the signature.</t>
      <t indent="0" pn="section-8-4">Under these conditions, applying this construction should never yield
      worse security guarantees than not applying it, assuming that applying
      the PRF does not reduce entropy. We believe there is always merit in
      analyzing protocols specifically. However, this construction is generic
      so the analyses of many protocols will still hold even if this proposed
      construction is incorporated.</t>
      <t indent="0" pn="section-8-5">The proposed construction cannot provide any guarantees of security
      if the CSPRNG state is cloned due to the virtual machine snapshots or
      process forking (see <xref target="MAFS2017" format="default" sectionFormat="of" derivedContent="MAFS2017"/>). It is
      <bcp14>RECOMMENDED</bcp14> that tag1 incorporate all available
      information about the environment, such as process attributes, virtual
      machine user information, etc.</t>
    </section>
    <section anchor="comparison-to-rfc-6979" numbered="true" toc="include" removeInRFC="false" pn="section-9">
      <name slugifiedName="name-comparison-to-rfc-6979">Comparison to RFC 6979</name>
      <t indent="0" pn="section-9-1">The construction proposed herein has similarities with that of
      <xref target="RFC6979" format="default" sectionFormat="of" derivedContent="RFC6979"/>; both of them use private
      keys to seed a deterministic random number generator. <xref target="RFC6979" sectionFormat="of" section="3.3" format="default" derivedLink="https://rfc-editor.org/rfc/rfc6979#section-3.3" derivedContent="RFC6979"/> recommends
      deterministically instantiating an instance of the HMAC_DRBG
      pseudorandom number generator, described in <xref target="SP80090A" format="default" sectionFormat="of" derivedContent="SP80090A"/> and Annex D of <xref target="X962" format="default" sectionFormat="of" derivedContent="X962"/>, using the private key sk as the entropy_input
      parameter and H(m) as the nonce. The construction G'(n) provided herein
      is similar, with such difference that a key derived from G(n) and
      H(Sig(sk, tag1)) is used as the entropy input and tag2 is the nonce.</t>
      <t indent="0" pn="section-9-2">However, the semantics and the security properties obtained by using
      these two constructions are different. The proposed construction aims to
      improve CSPRNG usage such that certain trusted randomness would remain
      even if the CSPRNG is completely broken. Using a signature scheme that
      requires entropy sources according to <xref target="RFC6979" format="default" sectionFormat="of" derivedContent="RFC6979"/> is intended for different purposes and does not
      assume possession of any entropy source -- even an unstable one. For
      example, if in a certain system all private key operations are performed
      within an HSM, then the differences will manifest as follows: the
      HMAC_DRBG construction described in <xref target="RFC6979" format="default" sectionFormat="of" derivedContent="RFC6979"/> may
      be implemented inside the HSM for the sake of signature generation,
      while the proposed construction would assume calling the signature
      implemented in the HSM.</t>
    </section>
  </middle>
  <back>
    <references pn="section-10">
      <name slugifiedName="name-references">References</name>
      <references pn="section-10.1">
        <name slugifiedName="name-normative-references">Normative References</name>
        <reference anchor="RFC2119" target="https://www.rfc-editor.org/info/rfc2119" quoteTitle="true" derivedAnchor="RFC2119">
          <front>
            <title>Key words for use in RFCs to Indicate Requirement Levels</title>
            <author initials="S." surname="Bradner" fullname="S. Bradner">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="1997" month="March"/>
            <abstract>
              <t indent="0">In many standards track documents several words are used to signify the requirements in the specification.  These words are often capitalized. This document defines these words as they should be interpreted in IETF documents.  This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="14"/>
          <seriesInfo name="RFC" value="2119"/>
          <seriesInfo name="DOI" value="10.17487/RFC2119"/>
        </reference>
        <reference anchor="RFC5869" target="https://www.rfc-editor.org/info/rfc5869" quoteTitle="true" derivedAnchor="RFC5869">
          <front>
            <title>HMAC-based Extract-and-Expand Key Derivation Function (HKDF)</title>
            <author initials="H." surname="Krawczyk" fullname="H. Krawczyk">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="P." surname="Eronen" fullname="P. Eronen">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2010" month="May"/>
            <abstract>
              <t indent="0">This document specifies a simple Hashed Message Authentication Code (HMAC)-based key derivation function (HKDF), which can be used as a building block in various protocols and applications.  The key derivation function (KDF) is intended to support a wide range of applications and requirements, and is conservative in its use of cryptographic hash functions.  This document is not an Internet  Standards Track specification; it is published for informational  purposes.</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="5869"/>
          <seriesInfo name="DOI" value="10.17487/RFC5869"/>
        </reference>
        <reference anchor="RFC6979" target="https://www.rfc-editor.org/info/rfc6979" quoteTitle="true" derivedAnchor="RFC6979">
          <front>
            <title>Deterministic Usage of the Digital Signature Algorithm (DSA) and Elliptic Curve Digital Signature Algorithm (ECDSA)</title>
            <author initials="T." surname="Pornin" fullname="T. Pornin">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2013" month="August"/>
            <abstract>
              <t indent="0">This document defines a deterministic digital signature generation procedure.  Such signatures are compatible with standard Digital Signature Algorithm (DSA) and Elliptic Curve Digital Signature Algorithm (ECDSA) digital signatures and can be processed with unmodified verifiers, which need not be aware of the procedure described therein.  Deterministic signatures retain the cryptographic security features associated with digital signatures but can be more easily implemented in various environments, since they do not need access to a source of high-quality randomness.</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="6979"/>
          <seriesInfo name="DOI" value="10.17487/RFC6979"/>
        </reference>
        <reference anchor="RFC8174" target="https://www.rfc-editor.org/info/rfc8174" quoteTitle="true" derivedAnchor="RFC8174">
          <front>
            <title>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</title>
            <author initials="B." surname="Leiba" fullname="B. Leiba">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2017" month="May"/>
            <abstract>
              <t indent="0">RFC 2119 specifies common key words that may be used in protocol  specifications.  This document aims to reduce the ambiguity by clarifying that only UPPERCASE usage of the key words have the  defined special meanings.</t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="14"/>
          <seriesInfo name="RFC" value="8174"/>
          <seriesInfo name="DOI" value="10.17487/RFC8174"/>
        </reference>
      </references>
      <references pn="section-10.2">
        <name slugifiedName="name-informative-references">Informative References</name>
        <reference anchor="DebianBug" target="https://pdfs.semanticscholar.org/fcf9/fe0946c20e936b507c023bbf89160cc995b9.pdf" quoteTitle="true" derivedAnchor="DebianBug">
          <front>
            <title>When private keys are public: results from the 2008 Debian OpenSSL vulnerability</title>
            <author initials="S" surname="Yilek" fullname="Scott Yilek">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="E" surname="Rescorla" fullname="Eric Rescorla">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="H" surname="Shacham" fullname="Hovav Shacham">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="B" surname="Enright" fullname="Brandon Enright">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="S" surname="Savage" fullname="Stefan Savage">
              <organization showOnFrontPage="true"/>
            </author>
            <date month="November" year="2009"/>
          </front>
          <seriesInfo name="DOI" value="10.1145/1644893.1644896"/>
          <refcontent>ICM '09</refcontent>
        </reference>
        <reference anchor="DualEC" target="https://projectbullrun.org/dual-ec/documents/dual-ec-20150731.pdf" quoteTitle="true" derivedAnchor="DualEC">
          <front>
            <title>Dual EC: A Standardized Back Door</title>
            <author initials="D" surname="Bernstein" fullname="Daniel J. Bernstein">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="T" surname="Lange" fullname="Tanja Lange">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="R" surname="Niederhagen" fullname="Ruben Niederhagen">
              <organization showOnFrontPage="true"/>
            </author>
            <date month="March" year="2016"/>
          </front>
          <seriesInfo name="DOI" value="10.1007/978-3-662-49301-4_17"/>
        </reference>
        <reference anchor="MAFS2017" target="https://rwc.iacr.org/2017/Slides/david.mcgrew.pptx" quoteTitle="true" derivedAnchor="MAFS2017">
          <front>
            <title>PRNG Failures and TLS Vulnerabilities in the Wild</title>
            <author initials="D" surname="McGrew" fullname="David McGrew">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="B" surname="Anderson" fullname="Blake Anderson">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="S" surname="Fluhrer" fullname="Scott Fluhrer">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="C" surname="Schenefiel" fullname="Chris Schenefiel">
              <organization showOnFrontPage="true"/>
            </author>
            <date month="January" year="2017"/>
          </front>
        </reference>
        <reference anchor="NAXOS" target="https://www.microsoft.com/en-us/research/wp-content/uploads/2016/02/strongake-submitted.pdf" quoteTitle="true" derivedAnchor="NAXOS">
          <front>
            <title>Stronger Security of Authenticated Key Exchange</title>
            <author initials="B" surname="LaMacchia" fullname="Brian LaMacchia">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="K" surname="Lauter" fullname="Kristin Lauter">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="A" surname="Mityagin" fullname="Anton Mityagin">
              <organization showOnFrontPage="true"/>
            </author>
            <date month="November" year="2007"/>
          </front>
          <seriesInfo name="DOI" value="10.1007/978-3-540-75670-5_1"/>
        </reference>
        <reference anchor="RY2010" target="https://rist.tech.cornell.edu/papers/sslhedge.pdf" quoteTitle="true" derivedAnchor="RY2010">
          <front>
            <title>When Good Randomness Goes Bad: Virtual Machine Reset Vulnerabilities and Hedging Deployed Cryptography</title>
            <author initials="T" surname="Ristenpart" fullname="Thomas Ristenpart">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="S" surname="Yilek" fullname="Scott Yilek">
              <organization showOnFrontPage="true"/>
            </author>
            <date month="January" year="2010"/>
          </front>
        </reference>
        <reference anchor="SecAnalysis" quoteTitle="true" target="https://doi.org/10.1109/CSF49147.2020.00027" derivedAnchor="SecAnalysis">
          <front>
            <title>Limiting the impact of unreliable randomness in deployed security protocols</title>
            <seriesInfo name="DOI" value="10.1109/CSF49147.2020.00027"/>
            <seriesInfo name="IEEE 33rd Computer Security Foundations Symposium (CSF), Boston, MA, USA," value="pp. 385-393"/>
            <author initials="L" surname="Akhmetzyanova" fullname="Liliya Akhmetzyanova">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="C" surname="Cremers" fullname="Cas Cremers">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="L" surname="Garratt" fullname="Luke Garratt">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="S" surname="Smyshlyaev" fullname="Stanislav V. Smyshlyaev">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="N" surname="Sullivan" fullname="Nick Sullivan">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2020"/>
          </front>
        </reference>
        <reference anchor="SP80090A" target="https://doi.org/10.6028/NIST.SP.800-90Ar1" quoteTitle="true" derivedAnchor="SP80090A">
          <front>
            <title>Recommendation for Random Number Generation Using Deterministic Random Bit Generators, Special Publication 800-90A Revision 1</title>
            <author>
              <organization showOnFrontPage="true">National Institute of Standards and Technology</organization>
            </author>
            <date year="2015" month="June"/>
          </front>
          <seriesInfo name="DOI" value="10.6028/NIST.SP.800-90Ar1"/>
        </reference>
        <reference anchor="X962" target="https://www.techstreet.com/standards/x9-x9-62-2005?product_id=1327225" quoteTitle="true" derivedAnchor="X962">
          <front>
            <title>Public Key Cryptography for the Financial Services Industry, The Elliptic Curve Digital Signature Algorithm (ECDSA)</title>
            <author>
              <organization showOnFrontPage="true">American National Standard for Financial Services (ANSI)</organization>
            </author>
            <date year="2005" month="November"/>
          </front>
          <refcontent>ANSI X9.62</refcontent>
        </reference>
      </references>
    </references>
    <section anchor="acknowledgements" numbered="false" toc="include" removeInRFC="false" pn="section-appendix.a">
      <name slugifiedName="name-acknowledgements">Acknowledgements</name>
      <t indent="0" pn="section-appendix.a-1">We thank <contact fullname="Liliya Akhmetzyanova"/> for her deep
      involvement in the security assessment in <xref target="SecAnalysis" format="default" sectionFormat="of" derivedContent="SecAnalysis"/>. We thank <contact fullname="John Mattsson"/>,
      <contact fullname="Martin Thomson"/>, and <contact fullname="Rich Salz"/>
      for their careful readings and useful comments.</t>
    </section>
    <section anchor="authors-addresses" numbered="false" removeInRFC="false" toc="include" pn="section-appendix.b">
      <name slugifiedName="name-authors-addresses">Authors' Addresses</name>
      <author initials="C." surname="Cremers" fullname="Cas Cremers">
        <organization showOnFrontPage="true">CISPA</organization>
        <address>
          <postal>
            <street>Saarland Informatics Campus</street>
            <city>Saarbruecken</city>
            <country>Germany</country>
          </postal>
          <email>cremers@cispa.saarland</email>
        </address>
      </author>
      <author initials="L." surname="Garratt" fullname="Luke Garratt">
        <organization showOnFrontPage="true">Cisco Meraki</organization>
        <address>
          <postal>
            <street>500 Terry A Francois Blvd</street>
            <city>San Francisco</city>
            <country>United States of America</country>
          </postal>
          <email>lgarratt@cisco.com</email>
        </address>
      </author>
      <author initials="S." surname="Smyshlyaev" fullname="Stanislav Smyshlyaev">
        <organization showOnFrontPage="true">CryptoPro</organization>
        <address>
          <postal>
            <street>18, Suschevsky val</street>
            <city>Moscow</city>
            <country>Russian Federation</country>
          </postal>
          <email>svs@cryptopro.ru</email>
        </address>
      </author>
      <author initials="N." surname="Sullivan" fullname="Nick Sullivan">
        <organization showOnFrontPage="true">Cloudflare</organization>
        <address>
          <postal>
            <street>101 Townsend St</street>
            <city>San Francisco</city>
            <country>United States of America</country>
          </postal>
          <email>nick@cloudflare.com</email>
        </address>
      </author>
      <author initials="C." surname="Wood" fullname="Christopher A. Wood">
        <organization showOnFrontPage="true">Cloudflare</organization>
        <address>
          <postal>
            <street>101 Townsend St</street>
            <city>San Francisco</city>
            <country>United States of America</country>
          </postal>
          <email>caw@heapingbits.net</email>
        </address>
      </author>
    </section>
  </back>
</rfc>
