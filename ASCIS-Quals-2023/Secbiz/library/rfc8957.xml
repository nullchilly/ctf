<?xml version='1.0' encoding='utf-8'?>
<rfc xmlns:xi="http://www.w3.org/2001/XInclude" version="3" category="std" consensus="true" docName="draft-ietf-mpls-sfl-framework-11" indexInclude="true" ipr="trust200902" number="8957" prepTime="2021-01-22T09:13:08" scripts="Common,Latin" sortRefs="true" submissionType="IETF" symRefs="true" tocDepth="3" tocInclude="true" xml:lang="en">
  <link href="https://datatracker.ietf.org/doc/draft-ietf-mpls-sfl-framework-11" rel="prev"/>
  <link href="https://dx.doi.org/10.17487/rfc8957" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  <front>
    <title abbrev="MPLS FL">Synonymous Flow Label Framework</title>
    <seriesInfo name="RFC" value="8957" stream="IETF"/>
    <author initials="S." surname="Bryant" fullname="Stewart Bryant">
      <organization showOnFrontPage="true">Futurewei Technologies Inc.</organization>
      <address>
        <email>sb@stewartbryant.com</email>
      </address>
    </author>
    <author initials="M." surname="Chen" fullname="Mach(Guoyi) Chen">
      <organization showOnFrontPage="true">Huawei</organization>
      <address>
        <email>mach.chen@huawei.com</email>
      </address>
    </author>
    <author initials="G." surname="Swallow" fullname="George Swallow">
      <organization showOnFrontPage="true">Southend Technical Center</organization>
      <address>
        <email>swallow.ietf@gmail.com</email>
      </address>
    </author>
    <author initials="S." surname="Sivabalan" fullname="Siva Sivabalan">
      <organization showOnFrontPage="true">Ciena Corporation</organization>
      <address>
        <email>ssivabal@ciena.com</email>
      </address>
    </author>
    <author initials="G." surname="Mirsky" fullname="Gregory Mirsky">
      <organization showOnFrontPage="true">ZTE Corp.</organization>
      <address>
        <email>gregimirsky@gmail.com</email>
      </address>
    </author>
    <date month="01" year="2021"/>
    <area>Routing</area>
    <workgroup>MPLS</workgroup>
    <keyword>MPLS</keyword>
    <keyword>Flow</keyword>
    <keyword>Label</keyword>
    <abstract pn="section-abstract">
      <t indent="0" pn="section-abstract-1">RFC 8372 ("MPLS Flow Identification Considerations") describes the
      requirement for introducing flow identities within the MPLS
      architecture.  This document describes a method of accomplishing this by
      using a technique called "Synonymous Flow Labels" in which labels that
      mimic the behavior of other labels provide the identification service.
      These identifiers can be used to trigger per-flow operations on the
      packet at the receiving label switching router.</t>
    </abstract>
    <boilerplate>
      <section anchor="status-of-memo" numbered="false" removeInRFC="false" toc="exclude" pn="section-boilerplate.1">
        <name slugifiedName="name-status-of-this-memo">Status of This Memo</name>
        <t indent="0" pn="section-boilerplate.1-1">
            This is an Internet Standards Track document.
        </t>
        <t indent="0" pn="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.
        </t>
        <t indent="0" pn="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <eref target="https://www.rfc-editor.org/info/rfc8957" brackets="none"/>.
        </t>
      </section>
      <section anchor="copyright" numbered="false" removeInRFC="false" toc="exclude" pn="section-boilerplate.2">
        <name slugifiedName="name-copyright-notice">Copyright Notice</name>
        <t indent="0" pn="section-boilerplate.2-1">
            Copyright (c) 2021 IETF Trust and the persons identified as the
            document authors. All rights reserved.
        </t>
        <t indent="0" pn="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<eref target="https://trustee.ietf.org/license-info" brackets="none"/>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.
        </t>
      </section>
    </boilerplate>
    <toc>
      <section anchor="toc" numbered="false" removeInRFC="false" toc="exclude" pn="section-toc.1">
        <name slugifiedName="name-table-of-contents">Table of Contents</name>
        <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1">
          <li pn="section-toc.1-1.1">
            <t indent="0" keepWithNext="true" pn="section-toc.1-1.1.1"><xref derivedContent="1" format="counter" sectionFormat="of" target="section-1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-introduction">Introduction</xref></t>
          </li>
          <li pn="section-toc.1-1.2">
            <t indent="0" keepWithNext="true" pn="section-toc.1-1.2.1"><xref derivedContent="2" format="counter" sectionFormat="of" target="section-2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-requirements-language">Requirements Language</xref></t>
          </li>
          <li pn="section-toc.1-1.3">
            <t indent="0" keepWithNext="true" pn="section-toc.1-1.3.1"><xref derivedContent="3" format="counter" sectionFormat="of" target="section-3"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-synonymous-flow-labels">Synonymous Flow Labels</xref></t>
          </li>
          <li pn="section-toc.1-1.4">
            <t indent="0" pn="section-toc.1-1.4.1"><xref derivedContent="4" format="counter" sectionFormat="of" target="section-4"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-user-service-traffic-in-the">User Service Traffic in the Data Plane</xref></t>
            <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.4.2">
              <li pn="section-toc.1-1.4.2.1">
                <t indent="0" pn="section-toc.1-1.4.2.1.1"><xref derivedContent="4.1" format="counter" sectionFormat="of" target="section-4.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-application-label-present">Application Label Present</xref></t>
                <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.4.2.1.2">
                  <li pn="section-toc.1-1.4.2.1.2.1">
                    <t indent="0" pn="section-toc.1-1.4.2.1.2.1.1"><xref derivedContent="4.1.1" format="counter" sectionFormat="of" target="section-4.1.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-setting-ttl-and-the-traffic">Setting TTL and the Traffic Class Bits</xref></t>
                  </li>
                </ul>
              </li>
              <li pn="section-toc.1-1.4.2.2">
                <t indent="0" pn="section-toc.1-1.4.2.2.1"><xref derivedContent="4.2" format="counter" sectionFormat="of" target="section-4.2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-single-label-stack">Single-Label Stack</xref></t>
                <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.4.2.2.2">
                  <li pn="section-toc.1-1.4.2.2.2.1">
                    <t indent="0" pn="section-toc.1-1.4.2.2.2.1.1"><xref derivedContent="4.2.1" format="counter" sectionFormat="of" target="section-4.2.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-setting-ttl-and-the-traffic-">Setting TTL and the Traffic Class Bits</xref></t>
                  </li>
                </ul>
              </li>
              <li pn="section-toc.1-1.4.2.3">
                <t indent="0" pn="section-toc.1-1.4.2.3.1"><xref derivedContent="4.3" format="counter" sectionFormat="of" target="section-4.3"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-aggregation-of-sfl-actions">Aggregation of SFL Actions</xref></t>
              </li>
            </ul>
          </li>
          <li pn="section-toc.1-1.5">
            <t indent="0" pn="section-toc.1-1.5.1"><xref derivedContent="5" format="counter" sectionFormat="of" target="section-5"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-equal-cost-multipath-consid">Equal-Cost Multipath Considerations</xref></t>
          </li>
          <li pn="section-toc.1-1.6">
            <t indent="0" pn="section-toc.1-1.6.1"><xref derivedContent="6" format="counter" sectionFormat="of" target="section-6"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-privacy-considerations">Privacy Considerations</xref></t>
          </li>
          <li pn="section-toc.1-1.7">
            <t indent="0" pn="section-toc.1-1.7.1"><xref derivedContent="7" format="counter" sectionFormat="of" target="section-7"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-security-considerations">Security Considerations</xref></t>
          </li>
          <li pn="section-toc.1-1.8">
            <t indent="0" pn="section-toc.1-1.8.1"><xref derivedContent="8" format="counter" sectionFormat="of" target="section-8"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-iana-considerations">IANA Considerations</xref></t>
          </li>
          <li pn="section-toc.1-1.9">
            <t indent="0" pn="section-toc.1-1.9.1"><xref derivedContent="9" format="counter" sectionFormat="of" target="section-9"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-references">References</xref></t>
            <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.9.2">
              <li pn="section-toc.1-1.9.2.1">
                <t indent="0" pn="section-toc.1-1.9.2.1.1"><xref derivedContent="9.1" format="counter" sectionFormat="of" target="section-9.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-normative-references">Normative References</xref></t>
              </li>
              <li pn="section-toc.1-1.9.2.2">
                <t indent="0" pn="section-toc.1-1.9.2.2.1"><xref derivedContent="9.2" format="counter" sectionFormat="of" target="section-9.2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-informative-references">Informative References</xref></t>
              </li>
            </ul>
          </li>
          <li pn="section-toc.1-1.10">
            <t indent="0" pn="section-toc.1-1.10.1"><xref derivedContent="" format="none" sectionFormat="of" target="section-appendix.a"/><xref derivedContent="" format="title" sectionFormat="of" target="name-contributors">Contributors</xref></t>
          </li>
          <li pn="section-toc.1-1.11">
            <t indent="0" pn="section-toc.1-1.11.1"><xref derivedContent="" format="none" sectionFormat="of" target="section-appendix.b"/><xref derivedContent="" format="title" sectionFormat="of" target="name-authors-addresses">Authors' Addresses</xref></t>
          </li>
        </ul>
      </section>
    </toc>
  </front>
  <middle>
    <section anchor="introduction" numbered="true" toc="include" removeInRFC="false" pn="section-1">
      <name slugifiedName="name-introduction">Introduction</name>
      <t indent="0" pn="section-1-1"><xref target="RFC8372" format="default" sectionFormat="of" derivedContent="RFC8372"/> ("MPLS Flow Identification
      Considerations") describes the requirement for introducing 
flow identities within the MPLS architecture.
This document describes a method of providing the required identification by using a
technique called "Synonymous Flow Labels (SFLs)" in
which labels that mimic the behavior of other MPLS labels provide the
identification service.  These identifiers can be used to trigger
per-flow operations on the packet at the receiving label switching
router.</t>
    </section>
    <section anchor="requirements-language" numbered="true" toc="include" removeInRFC="false" pn="section-2">
      <name slugifiedName="name-requirements-language">Requirements Language</name>
      <t indent="0" pn="section-2-1">
    The key words "<bcp14>MUST</bcp14>", "<bcp14>MUST NOT</bcp14>",
    "<bcp14>REQUIRED</bcp14>", "<bcp14>SHALL</bcp14>", "<bcp14>SHALL NOT</bcp14>", "<bcp14>SHOULD</bcp14>", "<bcp14>SHOULD NOT</bcp14>",
    "<bcp14>RECOMMENDED</bcp14>", "<bcp14>NOT RECOMMENDED</bcp14>", 
    "<bcp14>MAY</bcp14>", and "<bcp14>OPTIONAL</bcp14>" in this document are to be interpreted as
    described in BCP 14 <xref target="RFC2119" format="default" sectionFormat="of" derivedContent="RFC2119"/> <xref target="RFC8174" format="default" sectionFormat="of" derivedContent="RFC8174"/> 
    when, and only when, they appear in all capitals, as shown here.
      </t>
    </section>
    <section anchor="SFL" numbered="true" toc="include" removeInRFC="false" pn="section-3">
      <name slugifiedName="name-synonymous-flow-labels">Synonymous Flow Labels</name>
      <t indent="0" pn="section-3-1">An SFL is defined to be a label that causes exactly the same
behavior at the egress Label Edge Router (LER) as the label it
replaces, except that it also causes one or more additional actions that have
been previously agreed between the peer LERs to be executed 
on the packet.  There are many possible additional actions, such as
measuring the number of received packets in a flow,
triggering an IP Flow Information Export (IPFIX) <xref target="RFC7011" format="default" sectionFormat="of" derivedContent="RFC7011"/> capture, triggering other types of deep packet 
inspection, or identifying the packet source.  For example, in
a Performance Monitoring (PM) application, the agreed action could be
recording the receipt of the packet by incrementing a packet
counter.  This is a natural action in many MPLS implementations, and
where supported, this permits the implementation of high-quality
packet loss measurement without any change to the packet-forwarding
system.</t>
      <t indent="0" pn="section-3-2">To illustrate the use of this technology, we start by  considering
the case where there is an <tt>application</tt> label in the MPLS label stack.
As a first example, let us consider a
pseudowire (PW) <xref target="RFC3985" format="default" sectionFormat="of" derivedContent="RFC3985"/> on which it is desired to make
packet loss measurements. Two labels, synonymous with the PW labels, are obtained
from the egress terminating provider edge (T-PE). By alternating
between these SFLs and using them in place of the PW label, the PW
packets may be batched for counting without any impact on the PW
forwarding behavior <xref target="RFC8321" format="default" sectionFormat="of" derivedContent="RFC8321"/> (note that
strictly only one SFL is needed in 
this application, but that is an optimization that is a matter for
the implementor). The method of obtaining these additional
labels is outside the scope of this text; however,
one control protocol that provides a method of obtaining SFLs  is described in
<xref target="I-D.bryant-mpls-sfl-control" format="default" sectionFormat="of" derivedContent="MPLS-SFL-CONTROL"/>.</t>
      <t indent="0" pn="section-3-3">Next, consider an MPLS application that is multipoint to point, such as
a VPN.  Here, it is necessary to identify a packet batch from a
specific source.  This is achieved by making the SFLs source
specific, so that batches from one source are marked differently from
batches from another source.  The sources all operate independently
and asynchronously from each other, independently coordinating with
the destination.  Each ingress LER is thus able to establish its own SFL
to identify the subflow and thus enable PM per flow.</t>
      <t indent="0" pn="section-3-4">Finally, we need to consider the case where there is no MPLS
application label such as occurs when sending IP over a Label Switched Path
(LSP), i.e., there is a single label in the MPLS label stack.  In 
this case, introducing an SFL that was synonymous with the LSP label
would introduce network-wide forwarding state.  This would not be
acceptable for scaling reasons. Therefore, we have no choice but to
introduce an additional label.  Where penultimate hop popping (PHP)
is in use, the semantics of this additional label can be similar to
the LSP label.  Where PHP is not in use, the semantics are similar to
an MPLS Explicit NULL <xref target="RFC3032" format="default" sectionFormat="of" derivedContent="RFC3032"/>.  In both of
these cases, the label has the additional semantics of the SFL.</t>
      <t indent="0" pn="section-3-5">Note that to achieve the goals set out above, SFLs need to be
allocated from the platform label table.</t>
    </section>
    <section anchor="user-service-traffic-in-the-data-plane" numbered="true" toc="include" removeInRFC="false" pn="section-4">
      <name slugifiedName="name-user-service-traffic-in-the">User Service Traffic in the Data Plane</name>
      <t indent="0" pn="section-4-1">As noted in <xref target="SFL" format="default" sectionFormat="of" derivedContent="Section 3"/>, it is necessary to
      consider two cases:</t>
      <ol spacing="normal" type="1" indent="adaptive" start="1" pn="section-4-2">
	<li pn="section-4-2.1" derivedCounter="1.">Application label is present</li>
        <li pn="section-4-2.2" derivedCounter="2.">Single-label stack</li>
      </ol>
      <section anchor="ALP" numbered="true" toc="include" removeInRFC="false" pn="section-4.1">
        <name slugifiedName="name-application-label-present">Application Label Present</name>
        <t indent="0" pn="section-4.1-1"><xref target="Figure1" format="default" sectionFormat="of" derivedContent="Figure 1"/> shows the case in which
	both an LSP label and an application 
label are present in the MPLS label stack.  Traffic with no SFL
function present runs over the <tt>normal</tt> stack, and SFL-enabled flows
run over the SFL stack with the SFL used to indicate the packet
batch.</t>
        <figure anchor="Figure1" align="left" suppress-title="false" pn="figure-1">
          <name slugifiedName="name-use-of-synonymous-labels-in">Use of Synonymous Labels in a Two-Label MPLS Label Stack</name>
          <artwork name="" type="" align="left" alt="" pn="section-4.1-2.1">
 +-----------------+          +-----------------+
 |      LSP        |          |      LSP        |
 |     Label       |          |     Label       |
 |  (May be PHPed) |          |  (May be PHPed) |
 +-----------------+          +-----------------+
 |                 |          |                 |
 |  Application    |          | Synonymous Flow |
 |     Label       |          |     Label       |
 +-----------------+ &lt;= BoS   +-----------------+ &lt;= Bottom of Stack
 |                 |          |                 |
 |   Payload       |          |   Payload       |
 |                 |          |                 |
 +-----------------+          +-----------------+

"Normal" Label Stack         Label Stack with SFL
</artwork>
        </figure>
        <t indent="0" pn="section-4.1-3">At the egress LER, the LSP label is popped (if present). Then, the
	SFL is processed executing both the synonymous function and the
	corresponding application function.</t>
        <section anchor="TTLandTC" numbered="true" toc="include" removeInRFC="false" pn="section-4.1.1">
          <name slugifiedName="name-setting-ttl-and-the-traffic">Setting TTL and the Traffic Class Bits</name>
          <t indent="0" pn="section-4.1.1-1">The TTL and the Traffic Class bits <xref target="RFC5462" format="default" sectionFormat="of" derivedContent="RFC5462"/> in the SFL label stack entry (LSE) would 
normally be set to the same value as would have been set in the label
that the SFL is synonymous with.  However, it is recognized that, if there
is an application need, these fields in the SFL LSE
<bcp14>MAY</bcp14> be set to some other value.  An 
example would be where it was desired to cause the SFL to trigger an
action in the TTL expiry exception path as part of the label action.</t>
        </section>
      </section>
      <section anchor="SLS" numbered="true" toc="include" removeInRFC="false" pn="section-4.2">
        <name slugifiedName="name-single-label-stack">Single-Label Stack</name>
        <t indent="0" pn="section-4.2-1"><xref target="Figure2" format="default" sectionFormat="of" derivedContent="Figure 2"/> shows the case in which
	only an LSP label is present in the 
MPLS label stack.  Traffic with no SFL function present runs over the
"normal" stack, and SFL-enabled flows run over the SFL stack with the
SFL used to indicate the packet batch.  However, in this case, it is
necessary for the ingress Label Edge Router (LER) to first push the SFL and
	then to push the LSP label.</t>
        <figure anchor="Figure2" align="left" suppress-title="false" pn="figure-2">
          <name slugifiedName="name-use-of-synonymous-labels-in-">Use of Synonymous Labels in a Single-Label MPLS Label Stack</name>
          <artwork name="" type="" align="left" alt="" pn="section-4.2-2.1">
                              +-----------------+
                              |      LSP        |
                              |     Label       |
                              |  (May be PHPed) |
 +-----------------+          +-----------------+
 |      LSP        |          |                 | &lt;= Synonymous with
 |     Label       |          | Synonymous Flow |    Explicit NULL
 |  (May be PHPed) |          |     Label       |
 +-----------------+ &lt;= BoS   +-----------------+ &lt;= Bottom of Stack
 |                 |          |                 |
 |   Payload       |          |   Payload       |
 |                 |          |                 |
 +-----------------+          +-----------------+

"Normal" Label Stack         Label Stack with SFL
</artwork>
        </figure>
        <t indent="0" pn="section-4.2-3">At the receiving Label Switching Router (LSR), it is necessary to
	consider two cases:</t>
        <ol spacing="normal" type="1" indent="adaptive" start="1" pn="section-4.2-4">
	  <li pn="section-4.2-4.1" derivedCounter="1.">Where the LSP label is still present</li>
          <li pn="section-4.2-4.2" derivedCounter="2.">Where the LSP label is penultimate hop popped</li>
        </ol>
        <t indent="0" pn="section-4.2-5">If the LSP label is present, it is processed exactly as it would
        normally be processed, and then it is popped.  This reveals the SFL,
        which, in the case of the measurements defined in <xref target="RFC6374" format="default" sectionFormat="of" derivedContent="RFC6374"/>, is simply counted and then
        discarded.  In this respect, the processing of the SFL is synonymous
        with an MPLS Explicit NULL.  As the SFL is the bottom of stack, the IP
        packet that follows is processed as normal.</t>
        <t indent="0" pn="section-4.2-6">If the LSP label is not present due to PHP action in the upstream
LSR, two almost equivalent processing actions can take place.
The SFL can be treated either 1) as an LSP label that was not PHPed and the
additional associated SFL action is taken when the label is
processed or 2) as an MPLS Explicit NULL with
associated SFL actions.  From the perspective of the measurement
system described in this document, the behavior of the two approaches is 
indistinguishable; thus, either may be implemented.</t>
        <section anchor="setting-ttl-and-the-traffic-class-bits" numbered="true" toc="include" removeInRFC="false" pn="section-4.2.1">
          <name slugifiedName="name-setting-ttl-and-the-traffic-">Setting TTL and the Traffic Class Bits</name>
          <t indent="0" pn="section-4.2.1-1">The TTL and the Traffic Class considerations described in <xref target="TTLandTC" format="default" sectionFormat="of" derivedContent="Section 4.1.1"/> apply.</t>
        </section>
      </section>
      <section anchor="aggregation-of-sfl-actions" numbered="true" toc="include" removeInRFC="false" pn="section-4.3">
        <name slugifiedName="name-aggregation-of-sfl-actions">Aggregation of SFL Actions</name>
        <t indent="0" pn="section-4.3-1">There are cases where it is desirable to aggregate an SFL action
against a number of labels, for example, where it is desirable to
have one counter record the number of packets received over a group
of application labels or where the number of labels used by a single
application is large and the resultant increase in the number of
allocated labels needed to support the SFL actions may
become too large to be viable.  In these circumstances, it would be
necessary to introduce an additional label in the stack to act as an
aggregate instruction.  This is not strictly a synonymous action in
that the SFL is not replacing an existing label but is somewhat
similar to the single-label case shown in <xref target="SLS" format="default" sectionFormat="of" derivedContent="Section 4.2"/>, and the same
signaling, management, and configuration tools would be applicable.</t>
        <figure anchor="Figure3" align="left" suppress-title="false" pn="figure-3">
          <name slugifiedName="name-aggregate-sfl-actions">Aggregate SFL Actions</name>
          <artwork name="" type="" align="left" alt="" pn="section-4.3-2.1">
                              +-----------------+
                              |      LSP        |
                              |     Label       |
                              |  (May be PHPed) |
 +-----------------+          +-----------------+
 |      LSP        |          |                 |
 |     Label       |          |   Aggregate     |
 |  (May be PHPed) |          |      SFL        |
 +-----------------+          +-----------------+
 |                 |          |                 |
 |  Application    |          |  Application    |
 |     Label       |          |     Label       |
 +-----------------+ &lt;=BoS    +-----------------+ &lt;= Bottom of Stack
 |                 |          |                 |
 |   Payload       |          |   Payload       |
 |                 |          |                 |
 +-----------------+          +-----------------+

"Normal" Label Stack         Label Stack with SFL
</artwork>
        </figure>
        <t indent="0" pn="section-4.3-3">The aggregate SFL is shown in the label stack depicted in <xref target="Figure3" format="default" sectionFormat="of" derivedContent="Figure 3"/> as 
preceding the application label; however, the choice of position
before or after the application label will be application specific.
In the case described in <xref target="ALP" format="default" sectionFormat="of" derivedContent="Section 4.1"/>, by definition, the SFL has the
full application context.  In this case, the positioning will depend
on whether the SFL action needs the full context of the application
to perform its action and whether the complexity of the application
will be increased by finding an SFL following the application label.</t>
      </section>
    </section>
    <section anchor="equal-cost-multipath-considerations" numbered="true" toc="include" removeInRFC="false" pn="section-5">
      <name slugifiedName="name-equal-cost-multipath-consid">Equal-Cost Multipath Considerations</name>
      <t indent="0" pn="section-5-1">The introduction of an SFL to an existing flow may cause that flow to take
a different path through the network under conditions of Equal-Cost
Multipath (ECMP).  This, in turn, may invalidate certain uses of
the SFL, such as performance measurement applications.  Where this is
a problem, there are two solutions worthy of consideration:</t>
      <ol spacing="normal" type="1" indent="adaptive" start="1" pn="section-5-2">
	<li pn="section-5-2.1" derivedCounter="1.">The operator <bcp14>MAY</bcp14> elect to always run with the SFL
	in place in the MPLS label stack.</li>
        <li pn="section-5-2.2" derivedCounter="2.">The operator can elect to use entropy labels <xref target="RFC6790" format="default" sectionFormat="of" derivedContent="RFC6790"/> in a network that fully supports
	this type of ECMP. If this approach is adopted, the intervening MPLS
	network <bcp14>MUST NOT</bcp14> load balance on any packet field other
	than the entropy label. Note that this is stricter than the text in
	<xref target="RFC6790" sectionFormat="of" section="4.3" format="default" derivedLink="https://rfc-editor.org/rfc/rfc6790#section-4.3" derivedContent="RFC6790"/>.</li>
      </ol>
    </section>
    <section anchor="privacy" numbered="true" toc="include" removeInRFC="false" pn="section-6">
      <name slugifiedName="name-privacy-considerations">Privacy Considerations</name>
      <t indent="0" pn="section-6-1">IETF concerns on pervasive monitoring are described in <xref target="RFC7258" format="default" sectionFormat="of" derivedContent="RFC7258"/>.  The inclusion of originating
      and/or flow information in a packet provides more identity information
      and hence potentially degrades the privacy of the communication to an
      attacker in a position to observe the added identifier.  Whilst the
      inclusion of the additional granularity does allow greater insight into
      the flow characteristics, it does not specifically identify which node
      originated the packet unless the attacker can inspect the network at the
      point of ingress or inspect the control protocol packets.  This privacy
      threat may be mitigated by encrypting the control protocol packets by
      regularly changing the synonymous labels or by concurrently using a
      number of such labels, including the use of a combination of those
      methods.  Minimizing the scope of the identity indication can be useful
      in minimizing the observability of the flow characteristics. Whenever
      IPFIX or other deep packet inspection (DPI) technique is used, their
      relevant privacy considerations apply.</t>
    </section>
    <section anchor="security-considerations" numbered="true" toc="include" removeInRFC="false" pn="section-7">
      <name slugifiedName="name-security-considerations">Security Considerations</name>
      <t indent="0" pn="section-7-1">There are
no new security issues associated with the MPLS data plane.  Any
control protocol used to request SFLs will need to ensure the
legitimacy of the request, i.e., that the requesting node is authorized
to make that SFL request by the network operator.</t>
    </section>
    <section anchor="iana-considerations" numbered="true" toc="include" removeInRFC="false" pn="section-8">
      <name slugifiedName="name-iana-considerations">IANA Considerations</name>
      <t indent="0" pn="section-8-1">This document has no IANA actions.</t>
    </section>
  </middle>
  <back>
    <displayreference target="I-D.bryant-mpls-sfl-control" to="MPLS-SFL-CONTROL"/>
    <references pn="section-9">
      <name slugifiedName="name-references">References</name>
      <references pn="section-9.1">
        <name slugifiedName="name-normative-references">Normative References</name>
        <reference anchor="RFC2119" target="https://www.rfc-editor.org/info/rfc2119" quoteTitle="true" derivedAnchor="RFC2119">
          <front>
            <title>Key words for use in RFCs to Indicate Requirement Levels</title>
            <author initials="S." surname="Bradner" fullname="S. Bradner">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="1997" month="March"/>
            <abstract>
              <t indent="0">In many standards track documents several words are used to signify the requirements in the specification.  These words are often capitalized. This document defines these words as they should be interpreted in IETF documents.  This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="14"/>
          <seriesInfo name="RFC" value="2119"/>
          <seriesInfo name="DOI" value="10.17487/RFC2119"/>
        </reference>
        <reference anchor="RFC3032" target="https://www.rfc-editor.org/info/rfc3032" quoteTitle="true" derivedAnchor="RFC3032">
          <front>
            <title>MPLS Label Stack Encoding</title>
            <author initials="E." surname="Rosen" fullname="E. Rosen">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="D." surname="Tappan" fullname="D. Tappan">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="G." surname="Fedorkow" fullname="G. Fedorkow">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="Y." surname="Rekhter" fullname="Y. Rekhter">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="D." surname="Farinacci" fullname="D. Farinacci">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="T." surname="Li" fullname="T. Li">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="A." surname="Conta" fullname="A. Conta">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2001" month="January"/>
            <abstract>
              <t indent="0">This document specifies the encoding to be used by an LSR in order to transmit labeled packets on Point-to-Point Protocol (PPP) data links, on LAN data links, and possibly on other data links as well.  This document also specifies rules and procedures for processing the various fields of the label stack encoding.  [STANDARDS-TRACK]</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="3032"/>
          <seriesInfo name="DOI" value="10.17487/RFC3032"/>
        </reference>
        <reference anchor="RFC5462" target="https://www.rfc-editor.org/info/rfc5462" quoteTitle="true" derivedAnchor="RFC5462">
          <front>
            <title>Multiprotocol Label Switching (MPLS) Label Stack Entry: "EXP" Field Renamed to "Traffic Class" Field</title>
            <author initials="L." surname="Andersson" fullname="L. Andersson">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="R." surname="Asati" fullname="R. Asati">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2009" month="February"/>
            <abstract>
              <t indent="0">The early Multiprotocol Label Switching (MPLS) documents defined the form of the MPLS label stack entry.  This includes a three-bit field called the "EXP field".  The exact use of this field was not defined by these documents, except to state that it was to be "reserved for experimental use".</t>
              <t indent="0">Although the intended use of the EXP field was as a "Class of Service" (CoS) field, it was not named a CoS field by these early documents because the use of such a CoS field was not considered to be sufficiently defined.  Today a number of standards documents define its usage as a CoS field.</t>
              <t indent="0">To avoid misunderstanding about how this field may be used, it has become increasingly necessary to rename this field.  This document changes the name of the field to the "Traffic Class field" ("TC field").  In doing so, it also updates documents that define the current use of the EXP field.  [STANDARDS-TRACK]</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="5462"/>
          <seriesInfo name="DOI" value="10.17487/RFC5462"/>
        </reference>
        <reference anchor="RFC6790" target="https://www.rfc-editor.org/info/rfc6790" quoteTitle="true" derivedAnchor="RFC6790">
          <front>
            <title>The Use of Entropy Labels in MPLS Forwarding</title>
            <author initials="K." surname="Kompella" fullname="K. Kompella">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="J." surname="Drake" fullname="J. Drake">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="S." surname="Amante" fullname="S. Amante">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="W." surname="Henderickx" fullname="W. Henderickx">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="L." surname="Yong" fullname="L. Yong">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2012" month="November"/>
            <abstract>
              <t indent="0">Load balancing is a powerful tool for engineering traffic across a network.  This memo suggests ways of improving load balancing across MPLS networks using the concept of "entropy labels".  It defines the concept, describes why entropy labels are useful, enumerates properties of entropy labels that allow maximal benefit, and shows how they can be signaled and used for various applications.  This document updates RFCs 3031, 3107, 3209, and 5036.  [STANDARDS-TRACK]</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="6790"/>
          <seriesInfo name="DOI" value="10.17487/RFC6790"/>
        </reference>
        <reference anchor="RFC8174" target="https://www.rfc-editor.org/info/rfc8174" quoteTitle="true" derivedAnchor="RFC8174">
          <front>
            <title>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</title>
            <author initials="B." surname="Leiba" fullname="B. Leiba">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2017" month="May"/>
            <abstract>
              <t indent="0">RFC 2119 specifies common key words that may be used in protocol  specifications.  This document aims to reduce the ambiguity by clarifying that only UPPERCASE usage of the key words have the  defined special meanings.</t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="14"/>
          <seriesInfo name="RFC" value="8174"/>
          <seriesInfo name="DOI" value="10.17487/RFC8174"/>
        </reference>
      </references>
      <references pn="section-9.2">
        <name slugifiedName="name-informative-references">Informative References</name>
        <reference anchor="I-D.bryant-mpls-sfl-control" quoteTitle="true" target="https://tools.ietf.org/html/draft-bryant-mpls-sfl-control-09" derivedAnchor="MPLS-SFL-CONTROL">
          <front>
            <title>A Simple Control Protocol for MPLS SFLs</title>
            <author fullname="Stewart Bryant">
              <organization showOnFrontPage="true">Futurewei Technologies Inc.</organization>
            </author>
            <author fullname="George Swallow">
              <organization showOnFrontPage="true">Southend Technical Center</organization>
            </author>
            <author fullname="Siva Sivabalan">
              <organization showOnFrontPage="true">Ciena Corporation</organization>
            </author>
            <date month="December" day="7" year="2020"/>
            <abstract>
              <t indent="0">   In draft-ietf-mpls-sfl-framework the concept of MPLS synonymous flow
   labels (SFL) was introduced.  This document describes a simple
   control protocol that runs over an associated control header to
   request, withdraw, and extend the lifetime of such labels.  It is not
   the only control protocol that moght be used to support SFL, but it
   has the benefit of being able to be used without modifying of the
   existing MPLS control prodocols.  The existance of this design is not
   intended to restrict the ability to enhance an existing MPLS control
   protocol to add a similar capability.

   A Querier MUST wait a configured time (suggested wait of 60 seconds)
   before re-attempting a Withdraw request.  No more than three Withdraw
   requests SHOULD be made.  These restricctions are to prevent
   overloading the control plane of the actioning router.

              </t>
            </abstract>
          </front>
          <seriesInfo name="Internet-Draft" value="draft-bryant-mpls-sfl-control-09"/>
          <format type="TXT" target="https://www.ietf.org/internet-drafts/draft-bryant-mpls-sfl-control-09.txt"/>
          <refcontent>Work in Progress</refcontent>
        </reference>
        <reference anchor="RFC3985" target="https://www.rfc-editor.org/info/rfc3985" quoteTitle="true" derivedAnchor="RFC3985">
          <front>
            <title>Pseudo Wire Emulation Edge-to-Edge (PWE3) Architecture</title>
            <author initials="S." surname="Bryant" fullname="S. Bryant" role="editor">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="P." surname="Pate" fullname="P. Pate" role="editor">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2005" month="March"/>
            <abstract>
              <t indent="0">This document describes an architecture for Pseudo Wire Emulation Edge-to-Edge (PWE3).  It discusses the emulation of services such as Frame Relay, ATM, Ethernet, TDM, and SONET/SDH over packet switched networks (PSNs) using IP or MPLS.  It presents the architectural framework for pseudo wires (PWs), defines terminology, and specifies the various protocol elements and their functions.  This memo provides information for the Internet community.</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="3985"/>
          <seriesInfo name="DOI" value="10.17487/RFC3985"/>
        </reference>
        <reference anchor="RFC6374" target="https://www.rfc-editor.org/info/rfc6374" quoteTitle="true" derivedAnchor="RFC6374">
          <front>
            <title>Packet Loss and Delay Measurement for MPLS Networks</title>
            <author initials="D." surname="Frost" fullname="D. Frost">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="S." surname="Bryant" fullname="S. Bryant">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2011" month="September"/>
            <abstract>
              <t indent="0">Many service provider service level agreements (SLAs) depend on the ability to measure and monitor performance metrics for packet loss and one-way and two-way delay, as well as related metrics such as delay variation and channel throughput.  This measurement capability also provides operators with greater visibility into the performance characteristics of their networks, thereby facilitating planning, troubleshooting, and network performance evaluation.  This document specifies protocol mechanisms to enable the efficient and accurate measurement of these performance metrics in MPLS networks.  [STANDARDS-TRACK]</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="6374"/>
          <seriesInfo name="DOI" value="10.17487/RFC6374"/>
        </reference>
        <reference anchor="RFC7011" target="https://www.rfc-editor.org/info/rfc7011" quoteTitle="true" derivedAnchor="RFC7011">
          <front>
            <title>Specification of the IP Flow Information Export (IPFIX) Protocol for the Exchange of Flow Information</title>
            <author initials="B." surname="Claise" fullname="B. Claise" role="editor">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="B." surname="Trammell" fullname="B. Trammell" role="editor">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="P." surname="Aitken" fullname="P. Aitken">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2013" month="September"/>
            <abstract>
              <t indent="0">This document specifies the IP Flow Information Export (IPFIX) protocol, which serves as a means for transmitting Traffic Flow information over the network.  In order to transmit Traffic Flow information from an Exporting Process to a Collecting Process, a common representation of flow data and a standard means of communicating them are required.  This document describes how the IPFIX Data and Template Records are carried over a number of transport protocols from an IPFIX Exporting Process to an IPFIX Collecting Process.  This document obsoletes RFC 5101.</t>
            </abstract>
          </front>
          <seriesInfo name="STD" value="77"/>
          <seriesInfo name="RFC" value="7011"/>
          <seriesInfo name="DOI" value="10.17487/RFC7011"/>
        </reference>
        <reference anchor="RFC7258" target="https://www.rfc-editor.org/info/rfc7258" quoteTitle="true" derivedAnchor="RFC7258">
          <front>
            <title>Pervasive Monitoring Is an Attack</title>
            <author initials="S." surname="Farrell" fullname="S. Farrell">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="H." surname="Tschofenig" fullname="H. Tschofenig">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2014" month="May"/>
            <abstract>
              <t indent="0">Pervasive monitoring is a technical attack that should be mitigated in the design of IETF protocols, where possible.</t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="188"/>
          <seriesInfo name="RFC" value="7258"/>
          <seriesInfo name="DOI" value="10.17487/RFC7258"/>
        </reference>
        <reference anchor="RFC8321" target="https://www.rfc-editor.org/info/rfc8321" quoteTitle="true" derivedAnchor="RFC8321">
          <front>
            <title>Alternate-Marking Method for Passive and Hybrid Performance Monitoring</title>
            <author initials="G." surname="Fioccola" fullname="G. Fioccola" role="editor">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="A." surname="Capello" fullname="A. Capello">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="M." surname="Cociglio" fullname="M. Cociglio">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="L." surname="Castaldelli" fullname="L. Castaldelli">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="M." surname="Chen" fullname="M. Chen">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="L." surname="Zheng" fullname="L. Zheng">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="G." surname="Mirsky" fullname="G. Mirsky">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="T." surname="Mizrahi" fullname="T. Mizrahi">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2018" month="January"/>
            <abstract>
              <t indent="0">This document describes a method to perform packet loss, delay, and jitter measurements on live traffic.  This method is based on an Alternate-Marking (coloring) technique.  A report is provided in order to explain an example and show the method applicability.  This technology can be applied in various situations, as detailed in this document, and could be considered Passive or Hybrid depending on the application.</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="8321"/>
          <seriesInfo name="DOI" value="10.17487/RFC8321"/>
        </reference>
        <reference anchor="RFC8372" target="https://www.rfc-editor.org/info/rfc8372" quoteTitle="true" derivedAnchor="RFC8372">
          <front>
            <title>MPLS Flow Identification Considerations</title>
            <author initials="S." surname="Bryant" fullname="S. Bryant">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="C." surname="Pignataro" fullname="C. Pignataro">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="M." surname="Chen" fullname="M. Chen">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="Z." surname="Li" fullname="Z. Li">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="G." surname="Mirsky" fullname="G. Mirsky">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2018" month="May"/>
            <abstract>
              <t indent="0">This document discusses aspects to consider when developing a solution for MPLS flow identification.  The key application that needs this solution is in-band performance monitoring of MPLS flows when MPLS is used to encapsulate user data packets.</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="8372"/>
          <seriesInfo name="DOI" value="10.17487/RFC8372"/>
        </reference>
      </references>
    </references>
    <section anchor="contributors" numbered="false" toc="include" removeInRFC="false" pn="section-appendix.a">
      <name slugifiedName="name-contributors">Contributors</name>
      <contact fullname="Zhenbin Li">
        <organization showOnFrontPage="true">Huawei</organization>
        <address>
          <postal/>
          <email>lizhenbin@huawei.com</email>
        </address>
      </contact>
    </section>
    <section anchor="authors-addresses" numbered="false" removeInRFC="false" toc="include" pn="section-appendix.b">
      <name slugifiedName="name-authors-addresses">Authors' Addresses</name>
      <author initials="S." surname="Bryant" fullname="Stewart Bryant">
        <organization showOnFrontPage="true">Futurewei Technologies Inc.</organization>
        <address>
          <email>sb@stewartbryant.com</email>
        </address>
      </author>
      <author initials="M." surname="Chen" fullname="Mach(Guoyi) Chen">
        <organization showOnFrontPage="true">Huawei</organization>
        <address>
          <email>mach.chen@huawei.com</email>
        </address>
      </author>
      <author initials="G." surname="Swallow" fullname="George Swallow">
        <organization showOnFrontPage="true">Southend Technical Center</organization>
        <address>
          <email>swallow.ietf@gmail.com</email>
        </address>
      </author>
      <author initials="S." surname="Sivabalan" fullname="Siva Sivabalan">
        <organization showOnFrontPage="true">Ciena Corporation</organization>
        <address>
          <email>ssivabal@ciena.com</email>
        </address>
      </author>
      <author initials="G." surname="Mirsky" fullname="Gregory Mirsky">
        <organization showOnFrontPage="true">ZTE Corp.</organization>
        <address>
          <email>gregimirsky@gmail.com</email>
        </address>
      </author>
    </section>
  </back>
</rfc>
