<?xml version='1.0' encoding='utf-8'?>
<rfc xmlns:xi="http://www.w3.org/2001/XInclude" version="3" ipr="trust200902" number="9444" docName="draft-ietf-acme-subdomains-07" category="std" submissionType="IETF" consensus="true" tocDepth="2" tocInclude="true" sortRefs="true" symRefs="true" prepTime="2023-08-23T18:05:56" indexInclude="true" scripts="Common,Latin">
  <link href="https://datatracker.ietf.org/doc/draft-ietf-acme-subdomains-07" rel="prev"/>
  <link href="https://dx.doi.org/10.17487/rfc9444" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  <front>
    <title abbrev="ACME for Subdomains">Automated Certificate Management Environment (ACME) for Subdomains</title>
    <seriesInfo name="RFC" value="9444" stream="IETF"/>
    <author initials="O." surname="Friel" fullname="Owen Friel">
      <organization showOnFrontPage="true">Cisco</organization>
      <address>
        <email>ofriel@cisco.com</email>
      </address>
    </author>
    <author initials="R." surname="Barnes" fullname="Richard Barnes">
      <organization showOnFrontPage="true">Cisco</organization>
      <address>
        <email>rlb@ipv.sx</email>
      </address>
    </author>
    <author initials="T." surname="Hollebeek" fullname="Tim Hollebeek">
      <organization showOnFrontPage="true">DigiCert</organization>
      <address>
        <email>tim.hollebeek@digicert.com</email>
      </address>
    </author>
    <author initials="M." surname="Richardson" fullname="Michael Richardson">
      <organization showOnFrontPage="true">Sandelman Software Works</organization>
      <address>
        <email>mcr+ietf@sandelman.ca</email>
      </address>
    </author>
    <date month="08" year="2023"/>
    <area>Security</area>
    <workgroup>ACME Working Group</workgroup>
    <keyword>BRSKI</keyword>
    <keyword>BRSKI-Cloud</keyword>
    <keyword>ACME-Integrations</keyword>
    <abstract pn="section-abstract">
      <t indent="0" pn="section-abstract-1">This document specifies how Automated Certificate Management Environment (ACME) can be used by a client to obtain a certificate for a subdomain identifier from a certification authority. Additionally, this document specifies how a client can fulfill a challenge against an ancestor domain but may not need to fulfill a challenge against the explicit subdomain if certification authority policy allows issuance of the subdomain certificate without explicit subdomain ownership proof.</t>
    </abstract>
    <boilerplate>
      <section anchor="status-of-memo" numbered="false" removeInRFC="false" toc="exclude" pn="section-boilerplate.1">
        <name slugifiedName="name-status-of-this-memo">Status of This Memo</name>
        <t indent="0" pn="section-boilerplate.1-1">
            This is an Internet Standards Track document.
        </t>
        <t indent="0" pn="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.
        </t>
        <t indent="0" pn="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <eref target="https://www.rfc-editor.org/info/rfc9444" brackets="none"/>.
        </t>
      </section>
      <section anchor="copyright" numbered="false" removeInRFC="false" toc="exclude" pn="section-boilerplate.2">
        <name slugifiedName="name-copyright-notice">Copyright Notice</name>
        <t indent="0" pn="section-boilerplate.2-1">
            Copyright (c) 2023 IETF Trust and the persons identified as the
            document authors. All rights reserved.
        </t>
        <t indent="0" pn="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<eref target="https://trustee.ietf.org/license-info" brackets="none"/>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.
        </t>
      </section>
    </boilerplate>
    <toc>
      <section anchor="toc" numbered="false" removeInRFC="false" toc="exclude" pn="section-toc.1">
        <name slugifiedName="name-table-of-contents">Table of Contents</name>
        <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1">
          <li pn="section-toc.1-1.1">
            <t indent="0" keepWithNext="true" pn="section-toc.1-1.1.1"><xref derivedContent="1" format="counter" sectionFormat="of" target="section-1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-introduction">Introduction</xref></t>
          </li>
          <li pn="section-toc.1-1.2">
            <t indent="0" keepWithNext="true" pn="section-toc.1-1.2.1"><xref derivedContent="2" format="counter" sectionFormat="of" target="section-2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-terminology">Terminology</xref></t>
          </li>
          <li pn="section-toc.1-1.3">
            <t indent="0" keepWithNext="true" pn="section-toc.1-1.3.1"><xref derivedContent="3" format="counter" sectionFormat="of" target="section-3"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-acme-workflow-and-identifie">ACME Workflow and Identifier Requirements</xref></t>
          </li>
          <li pn="section-toc.1-1.4">
            <t indent="0" pn="section-toc.1-1.4.1"><xref derivedContent="4" format="counter" sectionFormat="of" target="section-4"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-acme-issuance-of-subdomain-">ACME Issuance of Subdomain Certificates</xref></t>
            <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.4.2">
              <li pn="section-toc.1-1.4.2.1">
                <t indent="0" pn="section-toc.1-1.4.2.1.1"><xref derivedContent="4.1" format="counter" sectionFormat="of" target="section-4.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-authorization-object">Authorization Object</xref></t>
              </li>
              <li pn="section-toc.1-1.4.2.2">
                <t indent="0" pn="section-toc.1-1.4.2.2.1"><xref derivedContent="4.2" format="counter" sectionFormat="of" target="section-4.2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-pre-authorization">Pre-authorization</xref></t>
              </li>
              <li pn="section-toc.1-1.4.2.3">
                <t indent="0" pn="section-toc.1-1.4.2.3.1"><xref derivedContent="4.3" format="counter" sectionFormat="of" target="section-4.3"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-new-orders">New Orders</xref></t>
              </li>
              <li pn="section-toc.1-1.4.2.4">
                <t indent="0" pn="section-toc.1-1.4.2.4.1"><xref derivedContent="4.4" format="counter" sectionFormat="of" target="section-4.4"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-directory-object-metadata">Directory Object Metadata</xref></t>
              </li>
            </ul>
          </li>
          <li pn="section-toc.1-1.5">
            <t indent="0" pn="section-toc.1-1.5.1"><xref derivedContent="5" format="counter" sectionFormat="of" target="section-5"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-illustrative-call-flow">Illustrative Call Flow</xref></t>
          </li>
          <li pn="section-toc.1-1.6">
            <t indent="0" pn="section-toc.1-1.6.1"><xref derivedContent="6" format="counter" sectionFormat="of" target="section-6"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-iana-considerations">IANA Considerations</xref></t>
            <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.6.2">
              <li pn="section-toc.1-1.6.2.1">
                <t indent="0" pn="section-toc.1-1.6.2.1.1"><xref derivedContent="6.1" format="counter" sectionFormat="of" target="section-6.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-authorization-object-fields">Authorization Object Fields Registry</xref></t>
              </li>
              <li pn="section-toc.1-1.6.2.2">
                <t indent="0" pn="section-toc.1-1.6.2.2.1"><xref derivedContent="6.2" format="counter" sectionFormat="of" target="section-6.2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-directory-object-metadata-f">Directory Object Metadata Fields Registry</xref></t>
              </li>
            </ul>
          </li>
          <li pn="section-toc.1-1.7">
            <t indent="0" pn="section-toc.1-1.7.1"><xref derivedContent="7" format="counter" sectionFormat="of" target="section-7"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-security-considerations">Security Considerations</xref></t>
            <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.7.2">
              <li pn="section-toc.1-1.7.2.1">
                <t indent="0" pn="section-toc.1-1.7.2.1.1"><xref derivedContent="7.1" format="counter" sectionFormat="of" target="section-7.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-client-account-security">Client Account Security</xref></t>
              </li>
              <li pn="section-toc.1-1.7.2.2">
                <t indent="0" pn="section-toc.1-1.7.2.2.1"><xref derivedContent="7.2" format="counter" sectionFormat="of" target="section-7.2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-subdomain-determination">Subdomain Determination</xref></t>
              </li>
              <li pn="section-toc.1-1.7.2.3">
                <t indent="0" pn="section-toc.1-1.7.2.3.1"><xref derivedContent="7.3" format="counter" sectionFormat="of" target="section-7.3"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-acme-server-policy-consider">ACME Server Policy Considerations</xref></t>
              </li>
            </ul>
          </li>
          <li pn="section-toc.1-1.8">
            <t indent="0" pn="section-toc.1-1.8.1"><xref derivedContent="8" format="counter" sectionFormat="of" target="section-8"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-references">References</xref></t>
            <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.8.2">
              <li pn="section-toc.1-1.8.2.1">
                <t indent="0" pn="section-toc.1-1.8.2.1.1"><xref derivedContent="8.1" format="counter" sectionFormat="of" target="section-8.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-normative-references">Normative References</xref></t>
              </li>
              <li pn="section-toc.1-1.8.2.2">
                <t indent="0" pn="section-toc.1-1.8.2.2.1"><xref derivedContent="8.2" format="counter" sectionFormat="of" target="section-8.2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-informative-references">Informative References</xref></t>
              </li>
            </ul>
          </li>
          <li pn="section-toc.1-1.9">
            <t indent="0" pn="section-toc.1-1.9.1"><xref derivedContent="" format="none" sectionFormat="of" target="section-appendix.a"/><xref derivedContent="" format="title" sectionFormat="of" target="name-authors-addresses">Authors' Addresses</xref></t>
          </li>
        </ul>
      </section>
    </toc>
  </front>
  <middle>
    <section anchor="introduction" numbered="true" removeInRFC="false" toc="include" pn="section-1">
      <name slugifiedName="name-introduction">Introduction</name>
      <t indent="0" pn="section-1-1">ACME <xref target="RFC8555" format="default" sectionFormat="of" derivedContent="RFC8555"/> defines a protocol that a certification authority (CA) and an applicant can use to automate the process of domain name ownership validation and X.509v3 (PKIX) <xref target="RFC5280" format="default" sectionFormat="of" derivedContent="RFC5280"/> certificate issuance. The CA is the ACME server and the applicant is the ACME client, and the client uses the ACME protocol to request certificate issuance from the server. This document outlines how ACME can be used to issue subdomain certificates without requiring the ACME client to explicitly fulfill an ownership challenge against the subdomain identifiers -- the ACME client need only fulfill an ownership challenge against an ancestor domain identifier.</t>
    </section>
    <section anchor="terminology" numbered="true" removeInRFC="false" toc="include" pn="section-2">
      <name slugifiedName="name-terminology">Terminology</name>
      <t indent="0" pn="section-2-1">
    The key words "<bcp14>MUST</bcp14>", "<bcp14>MUST NOT</bcp14>", "<bcp14>REQUIRED</bcp14>", "<bcp14>SHALL</bcp14>", "<bcp14>SHALL NOT</bcp14>", "<bcp14>SHOULD</bcp14>", "<bcp14>SHOULD NOT</bcp14>", "<bcp14>RECOMMENDED</bcp14>", "<bcp14>NOT RECOMMENDED</bcp14>",
    "<bcp14>MAY</bcp14>", and "<bcp14>OPTIONAL</bcp14>" in this document are to be interpreted as
    described in BCP 14 <xref target="RFC2119" format="default" sectionFormat="of" derivedContent="RFC2119"/> <xref target="RFC8174" format="default" sectionFormat="of" derivedContent="RFC8174"/> 
    when, and only when, they appear in all capitals, as shown here.
      </t>
      <t indent="0" pn="section-2-2">The following terms are defined in "DNS Terminology" <xref target="RFC8499" format="default" sectionFormat="of" derivedContent="RFC8499"/> and are reproduced here:</t>
      <dl newline="true" indent="3" spacing="normal" pn="section-2-3">
        <dt pn="section-2-3.1">Label:</dt>
        <dd pn="section-2-3.2">An ordered list of zero or more octets that makes up a
    portion of a domain name.  Using graph theory, a label identifies
    one node in a portion of the graph of all possible domain names.</dd>
        <dt pn="section-2-3.3">Domain Name:</dt>
        <dd pn="section-2-3.4">An ordered list of one or more labels.</dd>
        <dt pn="section-2-3.5">Fully-Qualified Domain Name (FQDN):</dt>
        <dd pn="section-2-3.6">This is often just a clear way
    of saying the same thing as "domain name of a node", as outlined
    above.  However, the term is ambiguous.  Strictly speaking, a
    fully-qualified domain name would include every label, including
    the zero-length label of the root: such a name would be written
    <tt>www.example.net.</tt> (note the terminating dot).  But, because every
    name eventually shares the common root, names are often written
    relative to the root (such as <tt>www.example.net</tt>) and are still
    called "fully qualified".  This term first appeared in <xref target="RFC0819" format="default" sectionFormat="of" derivedContent="RFC0819"/>.
    In this document, names are often written relative to the root.</dd>
      </dl>
      <t indent="0" pn="section-2-4">The following definition for "subdomain" is taken from "DNS Terminology" <xref target="RFC8499" format="default" sectionFormat="of" derivedContent="RFC8499"/> and reproduced here; however, the definition is ambiguous and is further clarified below:</t>
      <dl newline="true" indent="3" spacing="normal" pn="section-2-5">
        <dt pn="section-2-5.1">Subdomain:</dt>
        <dd pn="section-2-5.2">"A domain is a subdomain of another domain if it is
    contained within that domain.  This relationship can be tested by
    seeing if the subdomain's name ends with the containing domain's
    name."  (Quoted from <xref section="3.1" sectionFormat="of" target="RFC1034" format="default" derivedLink="https://rfc-editor.org/rfc/rfc1034#section-3.1" derivedContent="RFC1034"/>.) For example, in the
    host name <tt>nnn.mmm.example.com</tt>, both <tt>mmm.example.com</tt> and
    <tt>nnn.mmm.example.com</tt> are subdomains of <tt>example.com</tt>.  Note that
    the comparisons here are done on whole labels; that is,
    <tt>ooo.example.com</tt> is not a subdomain of <tt>oo.example.com</tt>.</dd>
      </dl>
      <t indent="0" pn="section-2-6">The definition is ambiguous as it appears to allow a subdomain to include the given domain. That is, <tt>mmm.example.com</tt> ends with <tt>mmm.example.com</tt> and thus is a subdomain of itself. This document interprets the first sentence of the above definition as meaning "a domain is a subdomain of a different domain if it is contained within that different domain". A domain cannot be a subdomain of itself. For example,  <tt>mmm.example.com</tt> is not a subdomain of <tt>mmm.example.com</tt>.</t>
      <t indent="0" pn="section-2-7">The following additional terms are used in this document:</t>
      <dl newline="true" indent="3" spacing="normal" pn="section-2-8">
        <dt pn="section-2-8.1">Certification Authority (CA):</dt>
        <dd pn="section-2-8.2">An organization that is responsible for the creation, issuance, revocation, and management of Certificates. The term applies equally to both root CAs and subordinate CAs. Refer to <xref target="RFC5280" format="default" sectionFormat="of" derivedContent="RFC5280"/> for detailed information on Certification Authorities.</dd>
        <dt pn="section-2-8.3">CSR:</dt>
        <dd pn="section-2-8.4">Certificate Signing Request, as defined in <xref target="RFC2986" format="default" sectionFormat="of" derivedContent="RFC2986"/>.</dd>
        <dt pn="section-2-8.5">Ancestor Domain:</dt>
        <dd pn="section-2-8.6">A domain is an ancestor domain of a subdomain if it contains that subdomain and has fewer labels than that subdomain. A domain cannot be an ancestor domain of itself. For example, for the host name <tt>nnn.mmm.example.com</tt>, both <tt>mmm.example.com</tt> and <tt>example.com</tt> are ancestor domains of <tt>nnn.mmm.example.com</tt>. However, <tt>nnn.mmm.example.com</tt> is not an ancestor domain of  <tt>nnn.mmm.example.com</tt>. Note that the comparisons here are done on whole labels; that is, <tt>oo.example.com</tt> is not an ancestor domain of <tt>ooo.example.com</tt>.</dd>
      </dl>
      <t indent="0" pn="section-2-9"><xref target="RFC8555" format="default" sectionFormat="of" derivedContent="RFC8555"/> defines the following object types that are used in this document:</t>
      <dl newline="false" indent="3" spacing="normal" pn="section-2-10">
        <dt pn="section-2-10.1">Order Object:</dt>
        <dd pn="section-2-10.2">An ACME order object represents a client's request for a certificate and is used to track the progress of that order through to issuance.</dd>
        <dt pn="section-2-10.3">Authorization Object:</dt>
        <dd pn="section-2-10.4">An ACME authorization object represents a server's authorization for an account to represent an identifier.</dd>
        <dt pn="section-2-10.5">Challenge Object:</dt>
        <dd pn="section-2-10.6">An ACME challenge object represents a server's offer to validate a client's possession of an identifier in a specific way.</dd>
      </dl>
      <t indent="0" pn="section-2-11">ACME <xref target="RFC8555" sectionFormat="comma" section="6.3" format="default" derivedLink="https://rfc-editor.org/rfc/rfc8555#section-6.3" derivedContent="RFC8555"/> introduces the following term which is used in this document:</t>
      <dl newline="true" indent="3" spacing="normal" pn="section-2-12">
        <dt pn="section-2-12.1">POST-as-GET Request:</dt>
        <dd pn="section-2-12.2">When a client wishes to fetch a resource from the server, then it <bcp14>MUST</bcp14> send a POST request with a signed JSON Web Signature (JWS) body, where the JWS body is specified in ACME <xref target="RFC8555" sectionFormat="comma" section="6.2" format="default" derivedLink="https://rfc-editor.org/rfc/rfc8555#section-6.2" derivedContent="RFC8555"/>. ACME refers to these as "POST-as-GET" requests.</dd>
      </dl>
    </section>
    <section anchor="acme-workflow-and-identifier-requirements" numbered="true" removeInRFC="false" toc="include" pn="section-3">
      <name slugifiedName="name-acme-workflow-and-identifie">ACME Workflow and Identifier Requirements</name>
      <t indent="0" pn="section-3-1">A typical ACME workflow for issuance of certificates is as follows:</t>
      <ol spacing="normal" type="1" indent="adaptive" start="1" pn="section-3-2">
	<li pn="section-3-2.1" derivedCounter="1.">Client POSTs a newOrder request that contains a set of identifier objects in the <tt>identifiers</tt> field of the ACME order object.</li>
        <li pn="section-3-2.2" derivedCounter="2.">Server replies with an order object that contains a set of links to authorization object(s) and a <tt>finalize</tt> URI.</li>
        <li pn="section-3-2.3" derivedCounter="3.">Client sends POST-as-GET request(s) to retrieve the authorization object(s), with the downloaded authorization object(s) containing the <tt>identifier</tt> that the client must prove that they control, and a set of links to associated challenge objects, one of which the client must fulfill.</li>
        <li pn="section-3-2.4" derivedCounter="4.">Client proves control over the <tt>identifier</tt> in the authorization object by completing one of the specified challenges, for example, by publishing a DNS TXT record.</li>
        <li pn="section-3-2.5" derivedCounter="5.">Client POSTs a CSR to the <tt>finalize</tt> API.</li>
        <li pn="section-3-2.6" derivedCounter="6.">Server replies with an updated order object that includes a <tt>certificate</tt> URI.</li>
        <li pn="section-3-2.7" derivedCounter="7.">Client sends a POST-as-GET request to the <tt>certificate</tt> URI to download the certificate.</li>
      </ol>
      <t indent="0" pn="section-3-3">ACME places the following restrictions on <tt>identifiers</tt>:</t>
      <ul spacing="normal" bare="false" empty="false" indent="3" pn="section-3-4">
        <li pn="section-3-4.1">
          <xref section="7.1.3" sectionFormat="comma" target="RFC8555" format="default" derivedLink="https://rfc-editor.org/rfc/rfc8555#section-7.1.3" derivedContent="RFC8555"/>: "The authorizations required are dictated by server policy; there may not be a 1:1 relationship between the order identifiers and the authorizations required."</li>
        <li pn="section-3-4.2">
          <xref section="7.1.4" sectionFormat="comma" target="RFC8555" format="default" derivedLink="https://rfc-editor.org/rfc/rfc8555#section-7.1.4" derivedContent="RFC8555"/>: The only type of <tt>identifier</tt> defined by the ACME specification is an FQDN: "The only type of identifier defined by this specification is a fully qualified domain name (type: "dns"). The domain name <bcp14>MUST</bcp14> be encoded in the form in which it would appear in a certificate."</li>
        <li pn="section-3-4.3">
          <xref section="7.4" sectionFormat="comma" target="RFC8555" format="default" derivedLink="https://rfc-editor.org/rfc/rfc8555#section-7.4" derivedContent="RFC8555"/>: The <tt>identifier</tt> in the CSR request must match the <tt>identifier</tt> in the newOrder request: "The CSR <bcp14>MUST</bcp14> indicate the exact same set of requested identifiers as the initial newOrder request."</li>
        <li pn="section-3-4.4">
          <xref section="8.3" sectionFormat="comma" target="RFC8555" format="default" derivedLink="https://rfc-editor.org/rfc/rfc8555#section-8.3" derivedContent="RFC8555"/>: The <tt>identifier</tt>, or FQDN, in the authorization object must be used when fulfilling challenges via HTTP: "Construct a URL by populating the URL template ... where the <tt>domain</tt> field is set to the domain name being verified."</li>
        <li pn="section-3-4.5">
          <xref section="8.4" sectionFormat="comma" target="RFC8555" format="default" derivedLink="https://rfc-editor.org/rfc/rfc8555#section-8.4" derivedContent="RFC8555"/>: The <tt>identifier</tt>, or FQDN, in the authorization object must be used when fulfilling challenges via DNS: "The client constructs the validation domain name by prepending the label "_acme-challenge" to the domain name being validated."</li>
      </ul>
      <t indent="0" pn="section-3-5">ACME does not mandate that the <tt>identifier</tt> in a newOrder request matches the <tt>identifier</tt> in authorization objects.</t>
      <t indent="0" pn="section-3-6">The ACME base document <xref target="RFC8555" format="default" sectionFormat="of" derivedContent="RFC8555"/> only specifies the "dns" identifier type. Additional identifiers may be defined and registered in the IANA <xref target="ACME-Identifier-Types" format="default" sectionFormat="of" derivedContent="ACME-Identifier-Types"/> registry. For example, <xref target="RFC8738" format="default" sectionFormat="of" derivedContent="RFC8738"/> specifies the "ip" identifier type. This document is only relevant for the "dns" identifier type.</t>
      <t indent="0" pn="section-3-7">Note that ACME supports multiple different validation methods that can be used to fulfill challenges and prove ownership of identifiers. Validation methods are registered in the IANA <xref target="ACME-Validation-Methods" format="default" sectionFormat="of" derivedContent="ACME-Validation-Methods"/> registry. This document does not mandate use of any particular validation method or methods. ACME server policy dictates which validation methods are supported. See <xref target="acme-server-policy-considerations" format="default" sectionFormat="of" derivedContent="Section 7.3"/> for more information on ACME server policy.</t>
    </section>
    <section anchor="acme-issuance-of-subdomain-certificates" numbered="true" removeInRFC="false" toc="include" pn="section-4">
      <name slugifiedName="name-acme-issuance-of-subdomain-">ACME Issuance of Subdomain Certificates</name>
      <t indent="0" pn="section-4-1">As noted in the previous section, ACME <xref target="RFC8555" format="default" sectionFormat="of" derivedContent="RFC8555"/> does not mandate that the <tt>identifier</tt> in a newOrder request matches the <tt>identifier</tt> in authorization objects. This means that the ACME specification does not preclude an ACME server processing newOrder requests and issuing certificates for a subdomain without requiring a challenge to be fulfilled against that explicit subdomain.</t>
      <t indent="0" pn="section-4-2">ACME server policy could allow issuance of certificates for a subdomain to a client where the client only has to fulfill an authorization challenge for an ancestor domain of that subdomain. For example, this allows for a flow where a client proves ownership of <tt>example.org</tt> and then successfully obtains a certificate for <tt>sub.example.org</tt>.</t>
      <t indent="0" pn="section-4-3">ACME server policy is out of scope of this document; however, some commentary is provided in <xref target="acme-server-policy-considerations" format="default" sectionFormat="of" derivedContent="Section 7.3"/>.</t>
      <t indent="0" pn="section-4-4">Clients need a mechanism to instruct the ACME server that they are requesting authorization for all subdomains subordinate to the specified domain, as opposed to just requesting authorization for an explicit domain identifier. Clients need a mechanism to do this in both newAuthz and newOrder requests. ACME servers need a mechanism to indicate to clients that authorization objects are valid for all subdomains under the specified domain. These are described in this section.</t>
      <section anchor="authorization-object" numbered="true" removeInRFC="false" toc="include" pn="section-4.1">
        <name slugifiedName="name-authorization-object">Authorization Object</name>
        <t indent="0" pn="section-4.1-1">ACME (<xref section="7.1.4" sectionFormat="comma" target="RFC8555" format="default" derivedLink="https://rfc-editor.org/rfc/rfc8555#section-7.1.4" derivedContent="RFC8555"/>) defines the authorization object. This document defines a new <tt>subdomainAuthAllowed</tt> field for the authorization object. 
When ACME server policy allows authorization for subdomains subordinate to a domain, the server indicates this by including the new <tt>subdomainAuthAllowed</tt> field in the authorization object for that domain identifier:</t>
        <dl indent="3" newline="false" spacing="normal" pn="section-4.1-2">
          <dt pn="section-4.1-2.1"><tt>subdomainAuthAllowed</tt> (optional, boolean):</dt>
          <dd pn="section-4.1-2.2">If present, this field
   <bcp14>MUST</bcp14> be true for authorizations where ACME server policy
   allows certificates to be issued for any subdomain subordinate
   to the domain specified in the <tt>identifier</tt> field of the
   authorization object.</dd>
        </dl>
        <t indent="0" pn="section-4.1-3">The following example shows an authorization object for the domain <tt>example.org</tt>, where the authorization covers the subdomains subordinate to <tt>example.org</tt>.</t>
        <sourcecode type="json" markers="false" pn="section-4.1-4">
{
  "status": "valid",
  "expires": "2023-09-01T14:09:07.99Z",

  "identifier": {
    "type": "dns",
    "value": "example.org"
  },

  "challenges": [
    {
      "url": "https://example.com/acme/chall/prV_B7yEyA4",
      "type": "http-01",
      "status": "valid",
      "token": "DGyRejmCefe7v4NfDGDKfA",
      "validated": "2014-12-01T12:05:58.16Z"
    }
  ],

  "subdomainAuthAllowed": true
}
</sourcecode>
        <t indent="0" pn="section-4.1-5">If the <tt>subdomainAuthAllowed</tt> field is not included, then the assumed default value is false.</t>
        <t indent="0" pn="section-4.1-6">If ACME server policy allows issuance of certificates containing wildcard identifiers under that authorization object, then the server <bcp14>SHOULD</bcp14> include the <tt>wildcard</tt> field with a value of true, as per <xref section="7.1.4" sectionFormat="comma" target="RFC8555" format="default" derivedLink="https://rfc-editor.org/rfc/rfc8555#section-7.1.4" derivedContent="RFC8555"/>.</t>
      </section>
      <section anchor="pre-authorization" numbered="true" removeInRFC="false" toc="include" pn="section-4.2">
        <name slugifiedName="name-pre-authorization">Pre-authorization</name>
        <t indent="0" pn="section-4.2-1">The basic ACME workflow has authorization objects created reactively in response to a certificate order. ACME also allows for pre-authorization, where clients obtain authorization for an identifier proactively, outside of the context of a specific issuance. With the ACME pre-authorization flow, a client can pre-authorize for a domain once and then issue multiple newOrder requests for certificates with identifiers in the subdomains subordinate to that domain.</t>
        <t indent="0" pn="section-4.2-2">ACME (<xref section="7.4.1" sectionFormat="comma" target="RFC8555" format="default" derivedLink="https://rfc-editor.org/rfc/rfc8555#section-7.4.1" derivedContent="RFC8555"/>) defines the <tt>identifier</tt> object for newAuthz requests. This document defines a new <tt>subdomainAuthAllowed</tt> field for the <tt>identifier</tt> object:</t>
        <dl indent="3" newline="false" spacing="normal" pn="section-4.2-3">
          <dt pn="section-4.2-3.1"><tt>subdomainAuthAllowed</tt> (optional, boolean):</dt>
          <dd pn="section-4.2-3.2">An ACME client sets
   this flag to indicate to the server that it is requesting an 
   authorization for the subdomains subordinate to the specified
   domain identifier value.</dd>
        </dl>
        <t indent="0" pn="section-4.2-4">Clients include the new <tt>subdomainAuthAllowed</tt> field in the <tt>identifier</tt> object of newAuthz requests to indicate that they are requesting a subdomain authorization. In the following example of a newAuthz payload, the client is requesting pre-authorization for the subdomains subordinate to <tt>example.org</tt>.</t>
        <sourcecode type="json" markers="false" pn="section-4.2-5">
"payload": base64url({
  "identifier": {
    "type": "dns",
    "value": "example.org",
    "subdomainAuthAllowed": true
  }
})
</sourcecode>
        <t indent="0" pn="section-4.2-6">If the server is willing to allow a single authorization for the subdomains and there is not an existing authorization object for the identifier, then it will create an authorization object and include the <tt>subdomainAuthAllowed</tt> flag with a value of true.</t>
        <t indent="0" pn="section-4.2-7">If the server policy does not allow creation of subdomain authorizations subordinate to that domain, the server can create an authorization object for the indicated identifier and <bcp14>MAY</bcp14> include the <tt>subdomainAuthAllowed</tt> flag with a value of false. If the server creates an authorization object and does not include the <tt>subdomainAuthAllowed</tt> flag, then the assumed value is false.</t>
        <t indent="0" pn="section-4.2-8">In both scenarios, handling of the pre-authorization follows the process documented in ACME <xref section="7.4.1" sectionFormat="comma" target="RFC8555" format="default" derivedLink="https://rfc-editor.org/rfc/rfc8555#section-7.4.1" derivedContent="RFC8555"/>.</t>
      </section>
      <section anchor="new-orders" numbered="true" removeInRFC="false" toc="include" pn="section-4.3">
        <name slugifiedName="name-new-orders">New Orders</name>
        <t indent="0" pn="section-4.3-1">Clients need a mechanism to optionally indicate to servers whether or not they are authorized to fulfill challenges against an ancestor domain for a given identifier. For example, if a client places an order for an identifier <tt>foo.bar.example.org</tt> and is authorized to fulfill a challenge against the ancestor domains <tt>bar.example.org</tt> or <tt>example.org</tt>, then the client needs a mechanism to indicate control over the ancestor domains to the ACME server.</t>
        <t indent="0" pn="section-4.3-2">In order to accomplish this, this document defines a new <tt>ancestorDomain</tt> field for the identifier that is included in order objects.</t>
        <dl indent="3" newline="false" spacing="normal" pn="section-4.3-3">
          <dt pn="section-4.3-3.1"><tt>ancestorDomain</tt> (optional, string):</dt>
          <dd pn="section-4.3-3.2">This is an ancestor domain of
   the requested identifier. The client <bcp14>MUST</bcp14> be able to fulfill
   a challenge against the ancestor domain.</dd>
        </dl>
        <t indent="0" pn="section-4.3-4">This field specifies an ancestor domain of the identifier that the client has DNS control over and is capable of fulfilling challenges against. Based on server policy, the server can choose to issue a challenge against any ancestor domain of the identifier up to and including the specified <tt>ancestorDomain</tt> and create a corresponding authorization object against the chosen identifier.</t>
        <t indent="0" pn="section-4.3-5">In the following example of a newOrder payload, the client requests a certificate for identifier <tt>foo.bar.example.org</tt> and indicates that it can fulfill a challenge against the ancestor domain <tt>bar.example.org</tt>. The server can then choose to issue a challenge against either <tt>foo.bar.example.org</tt> or <tt>bar.example.org</tt> identifiers.</t>
        <sourcecode type="json" markers="false" pn="section-4.3-6">
"payload": base64url({
       "identifiers": [
         { "type": "dns",
           "value": "foo.bar.example.org",
           "ancestorDomain": "bar.example.org"  }
       ],
       "notBefore": "2023-09-01T00:04:00+04:00",
       "notAfter": "2023-09-08T00:04:00+04:00"
     })
</sourcecode>
        <t indent="0" pn="section-4.3-7">In the following example of a newOrder payload, the client requests a certificate for identifier <tt>foo.bar.example.org</tt> and indicates that it can fulfill a challenge against the ancestor domain <tt>example.org</tt>. The server can then choose to issue a challenge against any one of <tt>foo.bar.example.org</tt>, <tt>bar.example.org</tt>, or <tt>example.org</tt> identifiers.</t>
        <sourcecode type="json" markers="false" pn="section-4.3-8">
"payload": base64url({
       "identifiers": [
         { "type": "dns",
           "value": "foo.bar.example.org",
           "ancestorDomain": "example.org"  }
       ],
       "notBefore": "2023-09-01T00:04:00+04:00",
       "notAfter": "2023-09-08T00:04:00+04:00"
     })
</sourcecode>
        <t indent="0" pn="section-4.3-9">If the client is unable to fulfill authorizations against an ancestor domain, the client should not include the <tt>ancestorDomain</tt> field.</t>
        <t indent="0" pn="section-4.3-10">Server newOrder handling generally follows the process documented in ACME (<xref section="7.4" sectionFormat="of" target="RFC8555" format="default" derivedLink="https://rfc-editor.org/rfc/rfc8555#section-7.4" derivedContent="RFC8555"/>). If the server is willing to allow subdomain authorizations for the domain specified in <tt>ancestorDomain</tt>, then it creates an authorization object against that ancestor domain and includes the <tt>subdomainAuthAllowed</tt> flag with a value of true.</t>
        <t indent="0" pn="section-4.3-11">If the server policy does not allow creation of subdomain authorizations against that ancestor domain, then it can create an authorization object for the indicated identifier value and <bcp14>SHOULD NOT</bcp14> include the <tt>subdomainAuthAllowed</tt> flag. As the client requested a subdomain authorization for the ancestor domain and not for the indicated identifier, there is no need for the server to include the <tt>subdomainAuthAllowed</tt> flag in the authorization object for the indicated identifier.</t>
      </section>
      <section anchor="directory-object-metadata" numbered="true" removeInRFC="false" toc="include" pn="section-4.4">
        <name slugifiedName="name-directory-object-metadata">Directory Object Metadata</name>
        <t indent="0" pn="section-4.4-1">This document defines a new <tt>subdomainAuthAllowed</tt> ACME directory metadata field. An ACME server can advertise support for authorization of subdomains by including the <tt>subdomainAuthAllowed</tt> boolean flag in its "ACME Directory Metadata Fields" registry:</t>
        <dl indent="3" newline="false" spacing="normal" pn="section-4.4-2">
          <dt pn="section-4.4-2.1"><tt>subdomainAuthAllowed</tt> (optional, bool):</dt>
          <dd pn="section-4.4-2.2">Indicates if an ACME 
   server supports authorization of subdomains.</dd>
        </dl>
        <t indent="0" pn="section-4.4-3">If not specified, then the assumed default value is false. If an ACME server supports authorization of subdomains, it can indicate this by including this field with a value of "true".</t>
      </section>
    </section>
    <section anchor="illustrative-call-flow" numbered="true" removeInRFC="false" toc="include" pn="section-5">
      <name slugifiedName="name-illustrative-call-flow">Illustrative Call Flow</name>
      <t indent="0" pn="section-5-1">The call flow illustrated here uses the ACME pre-authorization flow using DNS-based proof of ownership.</t>
      <artwork align="left" pn="section-5-2">
+--------+                   +------+     +-----+
| Client |                   | ACME |     | DNS |
+--------+                   +------+     +-----+
    |                            |           |
 Step 1: Pre-authorization of ancestor domain.
    |                            |           |
    | POST /newAuthz             |           |
    | "example.org"              |           |
    |---------------------------&gt;|           |
    |                            |           |
    | 201 authorizations         |           |
    |&lt;---------------------------|           |
    |                            |           |
    | Publish DNS TXT            |           |
    | "example.org"              |           |
    |---------------------------------------&gt;|
    |                            |           |
    | POST /challenge            |           |
    |---------------------------&gt;|           |
    |                            | Verify    |
    |                            |----------&gt;|
    | 200 status=valid           |           |
    |&lt;---------------------------|           |
    |                            |           |
    | Delete DNS TXT             |           |
    | "example.org"              |           |
    |---------------------------------------&gt;|
    |                            |           |
 Step 2: Place order for sub1.example.org.
    |                            |           |
    | POST /newOrder             |           |
    | "sub1.example.org"         |           |
    |---------------------------&gt;|           |
    |                            |           |
    | 201 status=ready           |           |
    |&lt;---------------------------|           |
    |                            |           |
    | POST /finalize             |           |
    | CSR SAN "sub1.example.org" |           |
    |---------------------------&gt;|           |
    |                            |           |
    | 200 OK status=valid        |           |
    |&lt;---------------------------|           |
    |                            |           |
    | POST /certificate          |           |
    |---------------------------&gt;|           |
    |                            |           |
    | 200 OK                     |           |
    | PEM SAN "sub1.example.org" |           |
    |&lt;---------------------------|           |
    |                            |           |
 Step 3: Place order for sub2.example.org.
    |                            |           |
    | POST /newOrder             |           |
    | "sub2.example.org"         |           |
    |---------------------------&gt;|           |
    |                            |           |
    | 201 status=ready           |           |
    |&lt;---------------------------|           |
    |                            |           |
    | POST /finalize             |           |
    | CSR SAN "sub2.example.org" |           |
    |---------------------------&gt;|           |
    |                            |           |
    | 200 OK status=valid        |           |
    |&lt;---------------------------|           |
    |                            |           |
    | POST /certificate          |           |
    |---------------------------&gt;|           |
    |                            |           |
    | 200 OK                     |           |
    | PEM SAN "sub2.example.org" |           |
    |&lt;---------------------------|           |
</artwork>
      <ul bare="false" empty="false" indent="3" spacing="normal" pn="section-5-3">
        <li pn="section-5-3.1">
          <t indent="0" pn="section-5-3.1.1">Step 1: Pre-authorization of ancestor domain.</t>
          <t indent="0" pn="section-5-3.1.2">
The client sends a newAuthz request for the ancestor domain and includes the <tt>subdomainAuthAllowed</tt> flag in the identifier object.</t>
          <sourcecode type="http-message" markers="false" pn="section-5-3.1.3">
POST /acme/new-authz HTTP/1.1
Host: example.com
Content-Type: application/jose+json

{
  "protected": base64url({
    "alg": "ES256",
    "kid": "https://example.com/acme/acct/evOfKhNU60wg",
    "nonce": "uQpSjlRb4vQVCjVYAyyUWg",
    "url": "https://example.com/acme/new-authz"
  }),
  "payload": base64url({
    "identifier": {
      "type": "dns",
      "value": "example.org",
      "subdomainAuthAllowed": true
    }
  }),
  "signature": "nuSDISbWG8mMgE7H...QyVUL68yzf3Zawps"
}
</sourcecode>
          <t indent="0" pn="section-5-3.1.4">The server creates and returns an authorization object for the identifier that includes the <tt>subdomainAuthAllowed</tt> flag. The object is initially in "pending" state.</t>
          <sourcecode type="json" markers="false" pn="section-5-3.1.5">
{
  "status": "pending",
  "expires": "2023-09-01T14:09:07.99Z",

  "identifier": {
    "type": "dns",
    "value": "example.org"
  },

  "challenges": [
    {
      "url": "https://example.com/acme/chall/prV_B7yEyA4",
      "type": "dns-01",
      "status": "pending",
      "token": "DGyRejmCefe7v4NfDGDKfA",
      "validated": "2023-08-01T12:05:58.16Z"
    }
  ],

  "subdomainAuthAllowed": true
}
</sourcecode>
          <t indent="0" pn="section-5-3.1.6">The example illustrates the client completing a DNS challenge by publishing a DNS TXT record. The client then posts to the challenge resource to inform the server that it can validate the challenge.</t>
          <t indent="0" pn="section-5-3.1.7">Once the server validates the challenge by checking the DNS TXT record, the server will transition the authorization object and associated challenge object status to "valid".</t>
          <t indent="0" pn="section-5-3.1.8">The call flow above illustrates the ACME server replying to the client's challenge with status of "valid" after the ACME server has validated the DNS challenge. However, the validation flow may take some time. If this is the case, the ACME server may reply to the client's challenge immediately with a status of "processing" and the client will then need to poll the authorization resource to see when it is finalized. Refer to <xref section="7.5.1" sectionFormat="of" target="RFC8555" format="default" derivedLink="https://rfc-editor.org/rfc/rfc8555#section-7.5.1" derivedContent="RFC8555"/> for more details.</t>
        </li>
        <li pn="section-5-3.2">
          <t indent="0" pn="section-5-3.2.1">Step 2: The client places a newOrder for <tt>sub1.example.org</tt>.</t>
          <t indent="0" pn="section-5-3.2.2">   
    The client sends a newOrder request to the server and includes the subdomain identifier. Note that the identifier is a subdomain of the ancestor domain that has been pre-authorized in Step 1. The client does not need to include the <tt>subdomainAuthAllowed</tt> field in the <tt>identifier</tt> object, as it has already pre-authorized the ancestor domain.</t>
          <sourcecode type="http-message" markers="false" pn="section-5-3.2.3">
POST /acme/new-order HTTP/1.1
Host: example.com
Content-Type: application/jose+json

{
  "protected": base64url({
    "alg": "ES256",
    "kid": "https://example.com/acme/acct/evOfKhNU60wg",
    "nonce": "5XJ1L3lEkMG7tR6pA00clA",
    "url": "https://example.com/acme/new-order"
  }),
  "payload": base64url({
    "identifiers": [
      { "type": "dns", "value": "sub1.example.org" }
    ],
    "notBefore": "2023-09-01T00:04:00+04:00",
    "notAfter": "2023-09-08T00:04:00+04:00"
  }),
  "signature": "H6ZXtGjTZyUnPeKn...wEA4TklBdh3e454g"
}
</sourcecode>
          <t indent="0" pn="section-5-3.2.4">As an authorization object already exists for the ancestor domain, the server replies with an order object with a status of "ready" that includes a link to the existing "valid" authorization object.</t>
          <sourcecode type="http-message" markers="false" pn="section-5-3.2.5">
HTTP/1.1 201 Created
Replay-Nonce: MYAuvOpaoIiywTezizk5vw
Link: &lt;https://example.com/acme/directory&gt;;rel="index"
Location: https://example.com/acme/order/TOlocE8rfgo

{
  "status": "ready",
  "expires": "2023-09-01T14:09:07.99Z",

  "notBefore": "2023-09-01T00:00:00Z",
  "notAfter": "2023-09-08T00:00:00Z",

  "identifiers": [
    { "type": "dns", "value": "sub1.example.org" }
  ],

  "authorizations": [
    "https://example.com/acme/authz/PAniVnsZcis"
  ],

  "finalize": "https://example.com/acme/order/TOlocrfgo/finalize"
}
</sourcecode>
          <t indent="0" pn="section-5-3.2.6">The client can proceed to finalize the order by posting a CSR to the <tt>finalize</tt> resource. The client can then download the certificate for <tt>sub1.example.org</tt>.</t>
        </li>
        <li pn="section-5-3.3">
          <t indent="0" pn="section-5-3.3.1">Step 3: The client places a newOrder for <tt>sub2.example.org</tt>.  </t>
          <t indent="0" pn="section-5-3.3.2">
    The client sends a newOrder request to the server and includes the subdomain identifier. Note that the identifier is a subdomain of the ancestor domain that has been pre-authorized in Step 1. The client does not need to include the <tt>subdomainAuthAllowed</tt> field in the <tt>identifier</tt> object, as it has already pre-authorized the ancestor domain.</t>
          <sourcecode type="http-message" markers="false" pn="section-5-3.3.3">
POST /acme/new-order HTTP/1.1
Host: example.com
Content-Type: application/jose+json

{
  "protected": base64url({
    "alg": "ES256",
    "kid": "https://example.com/acme/acct/evOfKhNU60wg",
    "nonce": "5XJ1L3lEkMG7tR6pA00clA",
    "url": "https://example.com/acme/new-order"
  }),
  "payload": base64url({
    "identifiers": [
      { "type": "dns", "value": "sub2.example.org" }
    ],
    "notBefore": "2023-09-01T00:04:00+04:00",
    "notAfter": "2023-09-08T00:04:00+04:00"
  }),
  "signature": "H6ZXtGjTZyUnPeKn...wEA4TklBdh3e454g"
}
</sourcecode>
          <t indent="0" pn="section-5-3.3.4">As an authorization object already exists for the ancestor domain, the server replies with an order object with a status of "ready" that includes a link to the existing "valid" authorization object.</t>
          <sourcecode type="http-message" markers="false" pn="section-5-3.3.5">
HTTP/1.1 201 Created
Replay-Nonce: MYAuvOpaoIiywTezizk5vw
Link: &lt;https://example.com/acme/directory&gt;;rel="index"
Location: https://example.com/acme/order/TOlocE8rfgo

{
  "status": "ready",
  "expires": "2023-09-01T14:09:07.99Z",

  "notBefore": "2023-09-01T00:00:00Z",
  "notAfter": "2023-09-08T00:00:00Z",

  "identifiers": [
    { "type": "dns", "value": "sub2.example.org" }
  ],

  "authorizations": [
    "https://example.com/acme/authz/PAniVnsZcis"
  ],

  "finalize": "https://example.com/acme/order/ROni7rdde/finalize"
}
</sourcecode>
          <t indent="0" pn="section-5-3.3.6">The client can proceed to finalize the order by posting a CSR to the <tt>finalize</tt> resource. The client can then download the certificate for <tt>sub2.example.org</tt>.</t>
        </li>
      </ul>
    </section>
    <section anchor="iana-considerations" numbered="true" removeInRFC="false" toc="include" pn="section-6">
      <name slugifiedName="name-iana-considerations">IANA Considerations</name>
      <section anchor="authorization-object-fields-registry" numbered="true" removeInRFC="false" toc="include" pn="section-6.1">
        <name slugifiedName="name-authorization-object-fields">Authorization Object Fields Registry</name>
        <t indent="0" pn="section-6.1-1">The following field has been added to the "ACME Authorization Object Fields" registry defined in ACME <xref target="RFC8555" format="default" sectionFormat="of" derivedContent="RFC8555"/>.</t>
        <table anchor="iana1" align="center" pn="table-1">
          <name/>
          <thead>
            <tr>
              <th align="left" colspan="1" rowspan="1">Field Name</th>
              <th align="left" colspan="1" rowspan="1">Field Type</th>
              <th align="left" colspan="1" rowspan="1">Configurable</th>
              <th align="left" colspan="1" rowspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left" colspan="1" rowspan="1">subdomainAuthAllowed</td>
              <td align="left" colspan="1" rowspan="1">boolean</td>
              <td align="left" colspan="1" rowspan="1">false</td>
              <td align="left" colspan="1" rowspan="1">RFC 9444</td>
            </tr>
          </tbody>
        </table>
      </section>
      <section anchor="directory-object-metadata-fields-registry" numbered="true" removeInRFC="false" toc="include" pn="section-6.2">
        <name slugifiedName="name-directory-object-metadata-f">Directory Object Metadata Fields Registry</name>
        <t indent="0" pn="section-6.2-1">The following field has been added to the "ACME Directory Metadata Fields" registry defined in <xref target="RFC8555" format="default" sectionFormat="of" derivedContent="RFC8555"/>.</t>
        <table anchor="iana2" align="center" pn="table-2">
          <name/>
          <thead>
            <tr>
              <th align="left" colspan="1" rowspan="1">Field Name</th>
              <th align="left" colspan="1" rowspan="1">Field Type</th>
              <th align="left" colspan="1" rowspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left" colspan="1" rowspan="1">subdomainAuthAllowed</td>
              <td align="left" colspan="1" rowspan="1">boolean</td>
              <td align="left" colspan="1" rowspan="1">RFC 9444</td>
            </tr>
          </tbody>
        </table>
      </section>
    </section>
    <section anchor="security-considerations" numbered="true" removeInRFC="false" toc="include" pn="section-7">
      <name slugifiedName="name-security-considerations">Security Considerations</name>
      <t indent="0" pn="section-7-1">This document specifies enhancements to ACME <xref target="RFC8555" format="default" sectionFormat="of" derivedContent="RFC8555"/> that optimize the protocol flows for issuance of certificates for subdomains. The underlying goal of ACME for Subdomains remains the same as that of ACME: managing certificates that attest to identifier/key bindings for these subdomains. Thus, ACME for Subdomains has the same two security goals as ACME:</t>
      <ol spacing="normal" type="(%d)" indent="adaptive" start="1" pn="section-7-2"><li pn="section-7-2.1" derivedCounter="(1)">Only an entity that controls an identifier can get an authorization for that identifier.</li>
        <li pn="section-7-2.2" derivedCounter="(2)">Once authorized, an account key's authorizations cannot be improperly used by another account.</li>
      </ol>
      <t indent="0" pn="section-7-3">ACME for Subdomains makes no changes to:</t>
      <ul spacing="normal" bare="false" empty="false" indent="3" pn="section-7-4">
        <li pn="section-7-4.1">account or account key management</li>
        <li pn="section-7-4.2">ACME channel establishment, security mechanisms, or threat model</li>
        <li pn="section-7-4.3">validation channel establishment, security mechanisms, or threat model</li>
      </ul>
      <t indent="0" pn="section-7-5">Therefore, all Security Considerations in ACME in the following areas are equally applicable to ACME for Subdomains:</t>
      <ul spacing="normal" bare="false" empty="false" indent="3" pn="section-7-6">
        <li pn="section-7-6.1">Threat Model</li>
        <li pn="section-7-6.2">Integrity of Authorizations</li>
        <li pn="section-7-6.3">Denial-of-Service Considerations</li>
        <li pn="section-7-6.4">Server-Side Request Forgery</li>
        <li pn="section-7-6.5">CA Policy Considerations</li>
      </ul>
      <t indent="0" pn="section-7-7">The only exception is that in order to satisfy goal (1) above, this document assumes that control over a domain may imply control over a subdomain; therefore, authorization for certificate issuance for the former may imply authorization for certificate issuance for the latter.  
In many ecosystems, this is a safe assumption, especially because control over the domain can often be leveraged to successfully demonstrate control over subdomains anyway, for example, by temporarily modifying DNS for the subdomain to point to a server the ancestor domain owner controls, rendering the distinction moot.  For example, the CA/Browser Forum Baseline Requirements may consider control of an ancestor domain sufficient for issuance of certificates for subdomains, but only if specific processes and procedures are used for validating ownership of the ancestor domain.</t>
      <t indent="0" pn="section-7-8">In ecosystems where control of an ancestor domain may not imply control over subdomains or authorization for issuance of certificates for subdomains, a more complicated threat analysis and server policy might be needed.</t>
      <t indent="0" pn="section-7-9">Some additional comments on ACME server policy are given later in this section.</t>
      <section anchor="client-account-security" numbered="true" removeInRFC="false" toc="include" pn="section-7.1">
        <name slugifiedName="name-client-account-security">Client Account Security</name>
        <t indent="0" pn="section-7.1-1">There may be scenarios were a client wishes to deactivate an authorization object for an ancestor domain or deactivate its account completely. For example, a client may want to do this if an account key is compromised or if an authorization object covering domains subordinate to an ancestor domain is no longer needed. The client can deactivate an authorization using the mechanism specified in <xref section="7.5.2" sectionFormat="comma" target="RFC8555" format="default" derivedLink="https://rfc-editor.org/rfc/rfc8555#section-7.5.2" derivedContent="RFC8555"/> and can deactivate an account using the mechanism specified in <xref section="7.3.6" sectionFormat="comma" target="RFC8555" format="default" derivedLink="https://rfc-editor.org/rfc/rfc8555#section-7.3.6" derivedContent="RFC8555"/>.</t>
      </section>
      <section anchor="subdomain-determination" numbered="true" removeInRFC="false" toc="include" pn="section-7.2">
        <name slugifiedName="name-subdomain-determination">Subdomain Determination</name>
        <t indent="0" pn="section-7.2-1">The <xref target="RFC8499" format="default" sectionFormat="of" derivedContent="RFC8499"/> definition of a subdomain is reproduced in <xref target="terminology" format="default" sectionFormat="of" derivedContent="Section 2"/>. When comparing domains to determine if one is a subdomain of the other, it is important to compare entire labels and not rely on a string prefix match. Relying on string prefix matches may yield incorrect results.</t>
      </section>
      <section anchor="acme-server-policy-considerations" numbered="true" removeInRFC="false" toc="include" pn="section-7.3">
        <name slugifiedName="name-acme-server-policy-consider">ACME Server Policy Considerations</name>
        <t indent="0" pn="section-7.3-1">The ACME for Subdomains and the ACME specifications do not mandate any specific ACME server or CA policies, or any specific use cases for issuance of certificates. For example, an ACME server could be used:</t>
        <ul spacing="normal" bare="false" empty="false" indent="3" pn="section-7.3-2">
          <li pn="section-7.3-2.1">to issue Web PKI certificates where the ACME server must comply with CA/Browser Forum Baseline Requirements <xref target="CAB" format="default" sectionFormat="of" derivedContent="CAB"/>.</li>
          <li pn="section-7.3-2.2">as a Private CA for issuance of certificates within an organization. The organization could enforce whatever policies they desire on the ACME server.</li>
          <li pn="section-7.3-2.3">for issuance of Internet of Things (IoT) device certificates. There are currently no IoT device certificate policies that are generally enforced across the industry. Organizations issuing IoT device certificates can enforce whatever policies they desire on the ACME server.</li>
        </ul>
        <t indent="0" pn="section-7.3-3">ACME server policy could specify whether:</t>
        <ul spacing="normal" bare="false" empty="false" indent="3" pn="section-7.3-4">
          <li pn="section-7.3-4.1">issuance of subdomain certificates is allowed based on proof of ownership of an ancestor domain.</li>
          <li pn="section-7.3-4.2">issuance of subdomain certificates is allowed, but only for a specific set of ancestor domains.</li>
          <li pn="section-7.3-4.3">DNS-based or HTTP-based proof of ownership, or both, are allowed.</li>
        </ul>
        <t indent="0" pn="section-7.3-5">The CA policy considerations listed in <xref section="10.5" sectionFormat="comma" target="RFC8555" format="default" derivedLink="https://rfc-editor.org/rfc/rfc8555#section-10.5" derivedContent="RFC8555"/> are equally applicable here. These include, but are not limited to:</t>
        <ul spacing="normal" bare="false" empty="false" indent="3" pn="section-7.3-6">
          <li pn="section-7.3-6.1">Is the claimed identifier syntactically valid?</li>
          <li pn="section-7.3-6.2">
            <t indent="0" pn="section-7.3-6.2.1">For domain names:</t>
            <ul bare="false" empty="false" indent="3" spacing="normal" pn="section-7.3-6.2.2">
              <li pn="section-7.3-6.2.2.1">Is the name on the Public Suffix List?</li>
              <li pn="section-7.3-6.2.2.2">Is the name a high-value name?</li>
            </ul>
          </li>
          <li pn="section-7.3-6.3">Is the key in the CSR sufficiently strong?</li>
        </ul>
        <t indent="0" pn="section-7.3-7">Refer to <xref section="10.5" sectionFormat="comma" target="RFC8555" format="default" derivedLink="https://rfc-editor.org/rfc/rfc8555#section-10.5" derivedContent="RFC8555"/> for more CA policy considerations.</t>
        <t indent="0" pn="section-7.3-8">ACME server policy specification is explicitly out of scope of this document.</t>
      </section>
    </section>
  </middle>
  <back>
    <references pn="section-8">
      <name slugifiedName="name-references">References</name>
      <references pn="section-8.1">
        <name slugifiedName="name-normative-references">Normative References</name>
        <reference anchor="RFC2119" target="https://www.rfc-editor.org/info/rfc2119" quoteTitle="true" derivedAnchor="RFC2119">
          <front>
            <title>Key words for use in RFCs to Indicate Requirement Levels</title>
            <author fullname="S. Bradner" initials="S." surname="Bradner"/>
            <date month="March" year="1997"/>
            <abstract>
              <t indent="0">In many standards track documents several words are used to signify the requirements in the specification. These words are often capitalized. This document defines these words as they should be interpreted in IETF documents. This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="14"/>
          <seriesInfo name="RFC" value="2119"/>
          <seriesInfo name="DOI" value="10.17487/RFC2119"/>
        </reference>
        <reference anchor="RFC8174" target="https://www.rfc-editor.org/info/rfc8174" quoteTitle="true" derivedAnchor="RFC8174">
          <front>
            <title>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</title>
            <author fullname="B. Leiba" initials="B." surname="Leiba"/>
            <date month="May" year="2017"/>
            <abstract>
              <t indent="0">RFC 2119 specifies common key words that may be used in protocol specifications. This document aims to reduce the ambiguity by clarifying that only UPPERCASE usage of the key words have the defined special meanings.</t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="14"/>
          <seriesInfo name="RFC" value="8174"/>
          <seriesInfo name="DOI" value="10.17487/RFC8174"/>
        </reference>
        <reference anchor="RFC8499" target="https://www.rfc-editor.org/info/rfc8499" quoteTitle="true" derivedAnchor="RFC8499">
          <front>
            <title>DNS Terminology</title>
            <author fullname="P. Hoffman" initials="P." surname="Hoffman"/>
            <author fullname="A. Sullivan" initials="A." surname="Sullivan"/>
            <author fullname="K. Fujiwara" initials="K." surname="Fujiwara"/>
            <date month="January" year="2019"/>
            <abstract>
              <t indent="0">The Domain Name System (DNS) is defined in literally dozens of different RFCs. The terminology used by implementers and developers of DNS protocols, and by operators of DNS systems, has sometimes changed in the decades since the DNS was first defined. This document gives current definitions for many of the terms used in the DNS in a single document.</t>
              <t indent="0">This document obsoletes RFC 7719 and updates RFC 2308.</t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="219"/>
          <seriesInfo name="RFC" value="8499"/>
          <seriesInfo name="DOI" value="10.17487/RFC8499"/>
        </reference>
        <reference anchor="RFC8555" target="https://www.rfc-editor.org/info/rfc8555" quoteTitle="true" derivedAnchor="RFC8555">
          <front>
            <title>Automatic Certificate Management Environment (ACME)</title>
            <author fullname="R. Barnes" initials="R." surname="Barnes"/>
            <author fullname="J. Hoffman-Andrews" initials="J." surname="Hoffman-Andrews"/>
            <author fullname="D. McCarney" initials="D." surname="McCarney"/>
            <author fullname="J. Kasten" initials="J." surname="Kasten"/>
            <date month="March" year="2019"/>
            <abstract>
              <t indent="0">Public Key Infrastructure using X.509 (PKIX) certificates are used for a number of purposes, the most significant of which is the authentication of domain names. Thus, certification authorities (CAs) in the Web PKI are trusted to verify that an applicant for a certificate legitimately represents the domain name(s) in the certificate. As of this writing, this verification is done through a collection of ad hoc mechanisms. This document describes a protocol that a CA and an applicant can use to automate the process of verification and certificate issuance. The protocol also provides facilities for other certificate management functions, such as certificate revocation.</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="8555"/>
          <seriesInfo name="DOI" value="10.17487/RFC8555"/>
        </reference>
      </references>
      <references pn="section-8.2">
        <name slugifiedName="name-informative-references">Informative References</name>
        <reference anchor="ACME-Identifier-Types" target="https://www.iana.org/assignments/acme/" quoteTitle="true" derivedAnchor="ACME-Identifier-Types">
          <front>
            <title>ACME Identifier Types</title>
            <author>
              <organization showOnFrontPage="true">IANA</organization>
            </author>
          </front>
        </reference>
        <reference anchor="ACME-Validation-Methods" target="https://www.iana.org/assignments/acme/" quoteTitle="true" derivedAnchor="ACME-Validation-Methods">
          <front>
            <title>ACME Validation Methods</title>
            <author>
              <organization showOnFrontPage="true">IANA</organization>
            </author>
          </front>
        </reference>
        <reference anchor="CAB" target="https://cabforum.org/baseline-requirements-documents/" quoteTitle="true" derivedAnchor="CAB">
          <front>
            <title>Baseline Requirements for the Issuance and Management of Publicly-Trusted Certificates</title>
            <author>
              <organization showOnFrontPage="true">CA/Browser Forum</organization>
            </author>
          </front>
        </reference>
        <reference anchor="RFC0819" target="https://www.rfc-editor.org/info/rfc819" quoteTitle="true" derivedAnchor="RFC0819">
          <front>
            <title>The Domain Naming Convention for Internet User Applications</title>
            <author fullname="Z. Su" initials="Z." surname="Su"/>
            <author fullname="J. Postel" initials="J." surname="Postel"/>
            <date month="August" year="1982"/>
            <abstract>
              <t indent="0">This RFC is an attempt to clarify the generalization of the Domain Naming Convention, the Internet Naming Convention, and to explore the implications of its adoption for Internet name service and user applications.</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="819"/>
          <seriesInfo name="DOI" value="10.17487/RFC0819"/>
        </reference>
        <reference anchor="RFC1034" target="https://www.rfc-editor.org/info/rfc1034" quoteTitle="true" derivedAnchor="RFC1034">
          <front>
            <title>Domain names - concepts and facilities</title>
            <author fullname="P. Mockapetris" initials="P." surname="Mockapetris"/>
            <date month="November" year="1987"/>
            <abstract>
              <t indent="0">This RFC is the revised basic definition of The Domain Name System. It obsoletes RFC-882. This memo describes the domain style names and their used for host address look up and electronic mail forwarding. It discusses the clients and servers in the domain name system and the protocol used between them.</t>
            </abstract>
          </front>
          <seriesInfo name="STD" value="13"/>
          <seriesInfo name="RFC" value="1034"/>
          <seriesInfo name="DOI" value="10.17487/RFC1034"/>
        </reference>
        <reference anchor="RFC2986" target="https://www.rfc-editor.org/info/rfc2986" quoteTitle="true" derivedAnchor="RFC2986">
          <front>
            <title>PKCS #10: Certification Request Syntax Specification Version 1.7</title>
            <author fullname="M. Nystrom" initials="M." surname="Nystrom"/>
            <author fullname="B. Kaliski" initials="B." surname="Kaliski"/>
            <date month="November" year="2000"/>
            <abstract>
              <t indent="0">This memo represents a republication of PKCS #10 v1.7 from RSA Laboratories' Public-Key Cryptography Standards (PKCS) series, and change control is retained within the PKCS process. The body of this document, except for the security considerations section, is taken directly from the PKCS #9 v2.0 or the PKCS #10 v1.7 document. This memo provides information for the Internet community.</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="2986"/>
          <seriesInfo name="DOI" value="10.17487/RFC2986"/>
        </reference>
        <reference anchor="RFC5280" target="https://www.rfc-editor.org/info/rfc5280" quoteTitle="true" derivedAnchor="RFC5280">
          <front>
            <title>Internet X.509 Public Key Infrastructure Certificate and Certificate Revocation List (CRL) Profile</title>
            <author fullname="D. Cooper" initials="D." surname="Cooper"/>
            <author fullname="S. Santesson" initials="S." surname="Santesson"/>
            <author fullname="S. Farrell" initials="S." surname="Farrell"/>
            <author fullname="S. Boeyen" initials="S." surname="Boeyen"/>
            <author fullname="R. Housley" initials="R." surname="Housley"/>
            <author fullname="W. Polk" initials="W." surname="Polk"/>
            <date month="May" year="2008"/>
            <abstract>
              <t indent="0">This memo profiles the X.509 v3 certificate and X.509 v2 certificate revocation list (CRL) for use in the Internet. An overview of this approach and model is provided as an introduction. The X.509 v3 certificate format is described in detail, with additional information regarding the format and semantics of Internet name forms. Standard certificate extensions are described and two Internet-specific extensions are defined. A set of required certificate extensions is specified. The X.509 v2 CRL format is described in detail along with standard and Internet-specific extensions. An algorithm for X.509 certification path validation is described. An ASN.1 module and examples are provided in the appendices. [STANDARDS-TRACK]</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="5280"/>
          <seriesInfo name="DOI" value="10.17487/RFC5280"/>
        </reference>
        <reference anchor="RFC8738" target="https://www.rfc-editor.org/info/rfc8738" quoteTitle="true" derivedAnchor="RFC8738">
          <front>
            <title>Automated Certificate Management Environment (ACME) IP Identifier Validation Extension</title>
            <author fullname="R.B. Shoemaker" initials="R.B." surname="Shoemaker"/>
            <date month="February" year="2020"/>
            <abstract>
              <t indent="0">This document specifies identifiers and challenges required to enable the Automated Certificate Management Environment (ACME) to issue certificates for IP addresses.</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="8738"/>
          <seriesInfo name="DOI" value="10.17487/RFC8738"/>
        </reference>
      </references>
    </references>
    <section anchor="authors-addresses" numbered="false" removeInRFC="false" toc="include" pn="section-appendix.a">
      <name slugifiedName="name-authors-addresses">Authors' Addresses</name>
      <author initials="O." surname="Friel" fullname="Owen Friel">
        <organization showOnFrontPage="true">Cisco</organization>
        <address>
          <email>ofriel@cisco.com</email>
        </address>
      </author>
      <author initials="R." surname="Barnes" fullname="Richard Barnes">
        <organization showOnFrontPage="true">Cisco</organization>
        <address>
          <email>rlb@ipv.sx</email>
        </address>
      </author>
      <author initials="T." surname="Hollebeek" fullname="Tim Hollebeek">
        <organization showOnFrontPage="true">DigiCert</organization>
        <address>
          <email>tim.hollebeek@digicert.com</email>
        </address>
      </author>
      <author initials="M." surname="Richardson" fullname="Michael Richardson">
        <organization showOnFrontPage="true">Sandelman Software Works</organization>
        <address>
          <email>mcr+ietf@sandelman.ca</email>
        </address>
      </author>
    </section>
  </back>
</rfc>
