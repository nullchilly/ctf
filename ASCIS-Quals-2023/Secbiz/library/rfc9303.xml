<?xml version='1.0' encoding='utf-8'?>
<rfc xmlns:xi="http://www.w3.org/2001/XInclude" version="3" category="std" consensus="true" docName="draft-ietf-lisp-sec-29" indexInclude="true" ipr="trust200902" number="9303" prepTime="2022-10-19T14:23:12" scripts="Common,Latin" sortRefs="true" submissionType="IETF" symRefs="true" tocDepth="3" tocInclude="true" xml:lang="en">
  <link href="https://datatracker.ietf.org/doc/draft-ietf-lisp-sec-29" rel="prev"/>
  <link href="https://dx.doi.org/10.17487/rfc9303" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  <front>
    <title abbrev="LISP-SEC">Locator/ID Separation Protocol Security (LISP-SEC)</title>
    <seriesInfo name="RFC" value="9303" stream="IETF"/>
    <author fullname="Fabio Maino" initials="F" surname="Maino">
      <organization showOnFrontPage="true">Cisco Systems</organization>
      <address>
        <postal>
          <street/>
          <city>San Jose</city>
          <code/>
          <region>CA</region>
          <country>United States of America</country>
        </postal>
        <email>fmaino@cisco.com</email>
      </address>
    </author>
    <author fullname="Vina Ermagan" initials="V" surname="Ermagan">
      <organization showOnFrontPage="true">Google, Inc.</organization>
      <address>
        <postal>
          <street>1600 Amphitheatre Parkway</street>
          <city>Mountain View</city>
          <region>CA</region>
          <code>94043</code>
          <country>United States of America</country>
        </postal>
        <email>ermagan@gmail.com</email>
      </address>
    </author>
    <author fullname="Albert Cabellos" initials="A" surname="Cabellos">
      <organization showOnFrontPage="true">Universitat Politecnica de Catalunya</organization>
      <address>
        <postal>
          <street>c/ Jordi Girona s/n</street>
          <city>Barcelona</city>
          <code>08034</code>
          <region/>
          <country>Spain</country>
        </postal>
        <email>acabello@ac.upc.edu</email>
      </address>
    </author>
    <author fullname="Damien Saucez" initials="D" surname="Saucez">
      <organization showOnFrontPage="true">Inria</organization>
      <address>
        <postal>
          <street>2004 route des Lucioles - BP 93</street>
          <city>Sophia Antipolis</city>
          <code/>
          <region/>
          <country>France</country>
        </postal>
        <email>damien.saucez@inria.fr</email>
      </address>
    </author>
    <date month="10" year="2022"/>
    <area>rtg</area>
    <workgroup>lisp</workgroup>
    <keyword>LISP</keyword>
    <keyword>deployment</keyword>
    <abstract pn="section-abstract">
      <t indent="0" pn="section-abstract-1">This memo specifies Locator/ID Separation Protocol Security (LISP-SEC), a set of security mechanisms
      that provides origin authentication, integrity, and anti-replay protection to the 
      LISP's Endpoint-ID-to-Routing-Locator (EID-to-RLOC) mapping data conveyed via the mapping lookup process.
      LISP-SEC also enables verification of authorization on EID-Prefix claims
      in Map-Reply messages.</t>
    </abstract>
    <boilerplate>
      <section anchor="status-of-memo" numbered="false" removeInRFC="false" toc="exclude" pn="section-boilerplate.1">
        <name slugifiedName="name-status-of-this-memo">Status of This Memo</name>
        <t indent="0" pn="section-boilerplate.1-1">
            This is an Internet Standards Track document.
        </t>
        <t indent="0" pn="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by
            the Internet Engineering Steering Group (IESG).  Further
            information on Internet Standards is available in Section 2 of 
            RFC 7841.
        </t>
        <t indent="0" pn="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <eref target="https://www.rfc-editor.org/info/rfc9303" brackets="none"/>.
        </t>
      </section>
      <section anchor="copyright" numbered="false" removeInRFC="false" toc="exclude" pn="section-boilerplate.2">
        <name slugifiedName="name-copyright-notice">Copyright Notice</name>
        <t indent="0" pn="section-boilerplate.2-1">
            Copyright (c) 2022 IETF Trust and the persons identified as the
            document authors. All rights reserved.
        </t>
        <t indent="0" pn="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<eref target="https://trustee.ietf.org/license-info" brackets="none"/>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Revised BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Revised BSD License.
        </t>
      </section>
    </boilerplate>
    <toc>
      <section anchor="toc" numbered="false" removeInRFC="false" toc="exclude" pn="section-toc.1">
        <name slugifiedName="name-table-of-contents">Table of Contents</name>
        <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1">
          <li pn="section-toc.1-1.1">
            <t indent="0" keepWithNext="true" pn="section-toc.1-1.1.1"><xref derivedContent="1" format="counter" sectionFormat="of" target="section-1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-introduction">Introduction</xref></t>
          </li>
          <li pn="section-toc.1-1.2">
            <t indent="0" keepWithNext="true" pn="section-toc.1-1.2.1"><xref derivedContent="2" format="counter" sectionFormat="of" target="section-2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-requirements-notation">Requirements Notation</xref></t>
          </li>
          <li pn="section-toc.1-1.3">
            <t indent="0" keepWithNext="true" pn="section-toc.1-1.3.1"><xref derivedContent="3" format="counter" sectionFormat="of" target="section-3"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-definitions-of-terms">Definitions of Terms</xref></t>
          </li>
          <li pn="section-toc.1-1.4">
            <t indent="0" pn="section-toc.1-1.4.1"><xref derivedContent="4" format="counter" sectionFormat="of" target="section-4"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-lisp-sec-threat-model">LISP-SEC Threat Model</xref></t>
          </li>
          <li pn="section-toc.1-1.5">
            <t indent="0" pn="section-toc.1-1.5.1"><xref derivedContent="5" format="counter" sectionFormat="of" target="section-5"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-protocol-operations">Protocol Operations</xref></t>
          </li>
          <li pn="section-toc.1-1.6">
            <t indent="0" pn="section-toc.1-1.6.1"><xref derivedContent="6" format="counter" sectionFormat="of" target="section-6"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-lisp-sec-control-messages-d">LISP-SEC Control Messages Details</xref></t>
            <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.6.2">
              <li pn="section-toc.1-1.6.2.1">
                <t indent="0" pn="section-toc.1-1.6.2.1.1"><xref derivedContent="6.1" format="counter" sectionFormat="of" target="section-6.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-encapsulated-control-messag">Encapsulated Control Message LISP-SEC Extensions</xref></t>
              </li>
              <li pn="section-toc.1-1.6.2.2">
                <t indent="0" pn="section-toc.1-1.6.2.2.1"><xref derivedContent="6.2" format="counter" sectionFormat="of" target="section-6.2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-map-reply-lisp-sec-extensio">Map-Reply LISP-SEC Extensions</xref></t>
              </li>
              <li pn="section-toc.1-1.6.2.3">
                <t indent="0" pn="section-toc.1-1.6.2.3.1"><xref derivedContent="6.3" format="counter" sectionFormat="of" target="section-6.3"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-map-register-lisp-sec-exten">Map-Register LISP-SEC Extensions</xref></t>
              </li>
              <li pn="section-toc.1-1.6.2.4">
                <t indent="0" pn="section-toc.1-1.6.2.4.1"><xref derivedContent="6.4" format="counter" sectionFormat="of" target="section-6.4"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-itr-processing-generating-a">ITR Processing: Generating a Map-Request</xref></t>
              </li>
              <li pn="section-toc.1-1.6.2.5">
                <t indent="0" pn="section-toc.1-1.6.2.5.1"><xref derivedContent="6.5" format="counter" sectionFormat="of" target="section-6.5"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-encrypting-and-decrypting-a">Encrypting and Decrypting an OTK</xref></t>
                <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.6.2.5.2">
                  <li pn="section-toc.1-1.6.2.5.2.1">
                    <t indent="0" pn="section-toc.1-1.6.2.5.2.1.1"><xref derivedContent="6.5.1" format="counter" sectionFormat="of" target="section-6.5.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-unencrypted-otk">Unencrypted OTK</xref></t>
                  </li>
                </ul>
              </li>
              <li pn="section-toc.1-1.6.2.6">
                <t indent="0" pn="section-toc.1-1.6.2.6.1"><xref derivedContent="6.6" format="counter" sectionFormat="of" target="section-6.6"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-map-resolver-processing">Map-Resolver Processing</xref></t>
              </li>
              <li pn="section-toc.1-1.6.2.7">
                <t indent="0" pn="section-toc.1-1.6.2.7.1"><xref derivedContent="6.7" format="counter" sectionFormat="of" target="section-6.7"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-map-server-processing">Map-Server Processing</xref></t>
                <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.6.2.7.2">
                  <li pn="section-toc.1-1.6.2.7.2.1">
                    <t indent="0" pn="section-toc.1-1.6.2.7.2.1.1"><xref derivedContent="6.7.1" format="counter" sectionFormat="of" target="section-6.7.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-generating-a-lisp-sec-prote">Generating a LISP-SEC-Protected Encapsulated Map-Request</xref></t>
                  </li>
                  <li pn="section-toc.1-1.6.2.7.2.2">
                    <t indent="0" pn="section-toc.1-1.6.2.7.2.2.1"><xref derivedContent="6.7.2" format="counter" sectionFormat="of" target="section-6.7.2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-generating-a-proxy-map-repl">Generating a Proxy Map-Reply</xref></t>
                  </li>
                </ul>
              </li>
              <li pn="section-toc.1-1.6.2.8">
                <t indent="0" pn="section-toc.1-1.6.2.8.1"><xref derivedContent="6.8" format="counter" sectionFormat="of" target="section-6.8"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-etr-processing">ETR Processing</xref></t>
              </li>
              <li pn="section-toc.1-1.6.2.9">
                <t indent="0" pn="section-toc.1-1.6.2.9.1"><xref derivedContent="6.9" format="counter" sectionFormat="of" target="section-6.9"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-itr-processing-receiving-a-">ITR Processing: Receiving a Map-Reply</xref></t>
                <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.6.2.9.2">
                  <li pn="section-toc.1-1.6.2.9.2.1">
                    <t indent="0" pn="section-toc.1-1.6.2.9.2.1.1"><xref derivedContent="6.9.1" format="counter" sectionFormat="of" target="section-6.9.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-map-reply-record-validation">Map-Reply Record Validation</xref></t>
                  </li>
                </ul>
              </li>
            </ul>
          </li>
          <li pn="section-toc.1-1.7">
            <t indent="0" pn="section-toc.1-1.7.1"><xref derivedContent="7" format="counter" sectionFormat="of" target="section-7"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-security-considerations">Security Considerations</xref></t>
            <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.7.2">
              <li pn="section-toc.1-1.7.2.1">
                <t indent="0" pn="section-toc.1-1.7.2.1.1"><xref derivedContent="7.1" format="counter" sectionFormat="of" target="section-7.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-mapping-system-security">Mapping System Security</xref></t>
              </li>
              <li pn="section-toc.1-1.7.2.2">
                <t indent="0" pn="section-toc.1-1.7.2.2.1"><xref derivedContent="7.2" format="counter" sectionFormat="of" target="section-7.2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-random-number-generation">Random Number Generation</xref></t>
              </li>
              <li pn="section-toc.1-1.7.2.3">
                <t indent="0" pn="section-toc.1-1.7.2.3.1"><xref derivedContent="7.3" format="counter" sectionFormat="of" target="section-7.3"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-map-server-and-etr-colocati">Map-Server and ETR Colocation</xref></t>
              </li>
              <li pn="section-toc.1-1.7.2.4">
                <t indent="0" pn="section-toc.1-1.7.2.4.1"><xref derivedContent="7.4" format="counter" sectionFormat="of" target="section-7.4"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-deploying-lisp-sec">Deploying LISP-SEC</xref></t>
              </li>
              <li pn="section-toc.1-1.7.2.5">
                <t indent="0" pn="section-toc.1-1.7.2.5.1"><xref derivedContent="7.5" format="counter" sectionFormat="of" target="section-7.5"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-shared-keys-provisioning">Shared Keys Provisioning</xref></t>
              </li>
              <li pn="section-toc.1-1.7.2.6">
                <t indent="0" pn="section-toc.1-1.7.2.6.1"><xref derivedContent="7.6" format="counter" sectionFormat="of" target="section-7.6"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-replay-attacks">Replay Attacks</xref></t>
              </li>
              <li pn="section-toc.1-1.7.2.7">
                <t indent="0" pn="section-toc.1-1.7.2.7.1"><xref derivedContent="7.7" format="counter" sectionFormat="of" target="section-7.7"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-message-privacy">Message Privacy</xref></t>
              </li>
              <li pn="section-toc.1-1.7.2.8">
                <t indent="0" pn="section-toc.1-1.7.2.8.1"><xref derivedContent="7.8" format="counter" sectionFormat="of" target="section-7.8"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-denial-of-service-and-distr">Denial-of-Service and Distributed Denial-of-Service Attacks</xref></t>
              </li>
            </ul>
          </li>
          <li pn="section-toc.1-1.8">
            <t indent="0" pn="section-toc.1-1.8.1"><xref derivedContent="8" format="counter" sectionFormat="of" target="section-8"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-iana-considerations">IANA Considerations</xref></t>
            <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.8.2">
              <li pn="section-toc.1-1.8.2.1">
                <t indent="0" pn="section-toc.1-1.8.2.1.1"><xref derivedContent="8.1" format="counter" sectionFormat="of" target="section-8.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-ecm-ad-type-registry">ECM AD Type Registry</xref></t>
              </li>
              <li pn="section-toc.1-1.8.2.2">
                <t indent="0" pn="section-toc.1-1.8.2.2.1"><xref derivedContent="8.2" format="counter" sectionFormat="of" target="section-8.2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-map-reply-ad-types-registry">Map-Reply AD Types Registry</xref></t>
              </li>
              <li pn="section-toc.1-1.8.2.3">
                <t indent="0" pn="section-toc.1-1.8.2.3.1"><xref derivedContent="8.3" format="counter" sectionFormat="of" target="section-8.3"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-hmac-functions">HMAC Functions</xref></t>
              </li>
              <li pn="section-toc.1-1.8.2.4">
                <t indent="0" pn="section-toc.1-1.8.2.4.1"><xref derivedContent="8.4" format="counter" sectionFormat="of" target="section-8.4"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-key-wrap-functions">Key Wrap Functions</xref></t>
              </li>
              <li pn="section-toc.1-1.8.2.5">
                <t indent="0" pn="section-toc.1-1.8.2.5.1"><xref derivedContent="8.5" format="counter" sectionFormat="of" target="section-8.5"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-key-derivation-functions">Key Derivation Functions</xref></t>
              </li>
            </ul>
          </li>
          <li pn="section-toc.1-1.9">
            <t indent="0" pn="section-toc.1-1.9.1"><xref derivedContent="9" format="counter" sectionFormat="of" target="section-9"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-references">References</xref></t>
            <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.9.2">
              <li pn="section-toc.1-1.9.2.1">
                <t indent="0" pn="section-toc.1-1.9.2.1.1"><xref derivedContent="9.1" format="counter" sectionFormat="of" target="section-9.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-normative-references">Normative References</xref></t>
              </li>
              <li pn="section-toc.1-1.9.2.2">
                <t indent="0" pn="section-toc.1-1.9.2.2.1"><xref derivedContent="9.2" format="counter" sectionFormat="of" target="section-9.2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-informative-references">Informative References</xref></t>
              </li>
            </ul>
          </li>
          <li pn="section-toc.1-1.10">
            <t indent="0" pn="section-toc.1-1.10.1"><xref derivedContent="" format="none" sectionFormat="of" target="section-appendix.a"/><xref derivedContent="" format="title" sectionFormat="of" target="name-acknowledgments">Acknowledgments</xref></t>
          </li>
          <li pn="section-toc.1-1.11">
            <t indent="0" pn="section-toc.1-1.11.1"><xref derivedContent="" format="none" sectionFormat="of" target="section-appendix.b"/><xref derivedContent="" format="title" sectionFormat="of" target="name-authors-addresses">Authors' Addresses</xref></t>
          </li>
        </ul>
      </section>
    </toc>
  </front>
  <middle>
    <section anchor="intro" numbered="true" toc="include" removeInRFC="false" pn="section-1">
      <name slugifiedName="name-introduction">Introduction</name>
      <t indent="0" pn="section-1-1">The Locator/ID Separation Protocol (LISP) <xref target="RFC9300" format="default" sectionFormat="of" derivedContent="RFC9300"/> <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/> is a network-layer-based protocol
      that enables separation of IP addresses into two new numbering spaces:
      Endpoint Identifiers (EIDs) and Routing Locators (RLOCs). EID-to-RLOC
      mappings are stored in a database and the LISP Mapping System, and they are made
      available via the Map-Request/Map-Reply lookup process. If these
      EID-to-RLOC mappings, carried through Map-Reply messages, are
      transmitted without integrity protection, an adversary can manipulate
      them and hijack the communication, impersonate the requested EID, or
      mount Denial-of-Service (DoS) or Distributed Denial-of-Service (DDoS) attacks. Also,
      if the Map-Reply message is transported unauthenticated, an adversarial
      LISP entity can overclaim an EID-Prefix and maliciously redirect traffic. The LISP-SEC threat model,
      described in <xref target="threat-model" format="default" sectionFormat="of" derivedContent="Section 4"/>, is built on top of the LISP
      threat model defined in <xref target="RFC7835" format="default" sectionFormat="of" derivedContent="RFC7835"/>, which includes a
      detailed description of an "overclaiming" attack.</t>
      <t indent="0" pn="section-1-2">This memo specifies LISP-SEC, a set of security mechanisms that
      provides origin authentication, integrity, and anti-replay protection to
      LISP's EID-to-RLOC mapping data conveyed via the mapping lookup process.
      LISP-SEC also enables verification of authorization on EID-Prefix claims
      in Map-Reply messages, ensuring that the sender of a Map-Reply that
      provides the location for a given EID-Prefix is entitled to do so
      according to the EID-Prefix registered in the associated Map-Server.
      Map-Register/Map-Notify security, including the right for a LISP entity
      to register an EID-Prefix or to claim presence at an RLOC, is out of the
      scope of LISP-SEC, as those protocols are protected by the security
      mechanisms specified in <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>.
      However, LISP-SEC extends the Map-Register message to allow an Ingress Tunnel
      Router (ITR) to
      downgrade to non-LISP-SEC Map-Requests. Additional security
      considerations are described in <xref target="security" format="default" sectionFormat="of" derivedContent="Section 7"/>.</t>
    </section>
    <section numbered="true" toc="include" removeInRFC="false" pn="section-2">
      <name slugifiedName="name-requirements-notation">Requirements Notation</name>
      <t indent="0" pn="section-2-1">The key words "<bcp14>MUST</bcp14>", "<bcp14>MUST NOT</bcp14>", "<bcp14>REQUIRED</bcp14>", "<bcp14>SHALL</bcp14>", "<bcp14>SHALL NOT</bcp14>",
    "<bcp14>SHOULD</bcp14>", "<bcp14>SHOULD NOT</bcp14>", "<bcp14>RECOMMENDED</bcp14>", "<bcp14>NOT RECOMMENDED</bcp14>", "<bcp14>MAY</bcp14>", and
    "<bcp14>OPTIONAL</bcp14>" in this document are to be interpreted as described in  BCP 14
    <xref target="RFC2119" format="default" sectionFormat="of" derivedContent="RFC2119"/> <xref target="RFC8174" format="default" sectionFormat="of" derivedContent="RFC8174"/> when, and only when, they
    appear in all capitals, as shown here.
      </t>
    </section>
    <section anchor="terms" numbered="true" toc="include" removeInRFC="false" pn="section-3">
      <name slugifiedName="name-definitions-of-terms">Definitions of Terms</name>
      <dl newline="false" indent="3" spacing="normal" pn="section-3-1">
        <dt pn="section-3-1.1">One-Time Key (OTK):</dt>
        <dd pn="section-3-1.2">An ephemeral randomly generated key that must
          be used for a single Map-Request/Map-Reply exchange.</dd>
        <dt pn="section-3-1.3">ITR One-Time Key (ITR-OTK):</dt>
        <dd pn="section-3-1.4">The One-Time Key generated at the
          Ingress Tunnel Router (ITR).</dd>
        <dt pn="section-3-1.5">MS One-Time Key (MS-OTK):</dt>
        <dd pn="section-3-1.6">The One-Time Key generated at the
          Map-Server.</dd>
        <dt pn="section-3-1.7">Authentication Data (AD):</dt>
        <dd pn="section-3-1.8">Metadata that is included either in a
          LISP Encapsulated Control Message (ECM) header as defined in <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>, or in a Map-Reply message to
          support confidentiality, integrity protection, and verification of
          EID-Prefix authorization.</dd>
        <dt pn="section-3-1.9">OTK Authentication Data (OTK-AD):</dt>
        <dd pn="section-3-1.10">The portion of ECM
          Authentication Data that contains a One-Time Key.</dd>
        <dt pn="section-3-1.11">EID Authentication Data (EID-AD):</dt>
        <dd pn="section-3-1.12">The portion of ECM and
          Map-Reply Authentication Data used for verification of EID-Prefix
          authorization.</dd>
        <dt pn="section-3-1.13">Packet Authentication Data (PKT-AD):</dt>
        <dd pn="section-3-1.14">The portion of Map-Reply
          Authentication Data used to protect the integrity of the Map-Reply
          message.</dd>
      </dl>
      <t indent="0" pn="section-3-2">For definitions of other terms, notably Map-Request, Map-Reply,
      Ingress Tunnel Router (ITR), Egress Tunnel Router (ETR), Map-Server
      (MS), and Map-Resolver (MR), please consult the LISP specification <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>.</t>
    </section>
    <section anchor="threat-model" numbered="true" toc="include" removeInRFC="false" pn="section-4">
      <name slugifiedName="name-lisp-sec-threat-model">LISP-SEC Threat Model</name>
      <t indent="0" pn="section-4-1">LISP-SEC addresses the control plane threats, described in Sections
      <xref target="RFC7835" section="3.7" sectionFormat="bare" format="default" derivedLink="https://rfc-editor.org/rfc/rfc7835#section-3.7" derivedContent="RFC7835"/> and 
      <xref target="RFC7835" section="3.8" sectionFormat="bare" format="default" derivedLink="https://rfc-editor.org/rfc/rfc7835#section-3.8" derivedContent="RFC7835"/> of <xref target="RFC7835" format="default" sectionFormat="of" derivedContent="RFC7835"/>, that target EID-to-RLOC
      mappings, including manipulations of Map-Request and Map-Reply messages
      and malicious ETR EID-Prefix overclaiming. LISP-SEC makes two main
      assumptions: (1) the LISP Mapping System is expected to deliver a
      Map-Request message to their intended destination ETR as identified by
      the EID, and (2) no on-path attack can be mounted
      within the LISP Mapping System. How the Mapping System is protected from
      on-path attacks depends on the particular Mapping System used and is
      out of the scope of this memo. Furthermore, while LISP-SEC enables
      detection of EID-Prefix overclaiming attacks, it assumes that
      Map-Servers can verify the EID-Prefix authorization at registration time.
      </t>
      <t indent="0" pn="section-4-2">According to the threat model described in <xref target="RFC7835" format="default" sectionFormat="of" derivedContent="RFC7835"/>,
      LISP-SEC assumes that any kind of attack, including on-path attacks, can be
      mounted outside of the boundaries of the LISP Mapping System. An on-path
      attacker outside of the LISP Mapping System can, for example, hijack
      Map-Request and Map-Reply messages, spoofing the identity of a LISP
      node. Another example of an on-path attack, called an overclaiming attack, can
      be mounted by a malicious ETR by overclaiming
      the EID-Prefixes for which it is authoritative. In this way, the ETR can
      maliciously redirect traffic.</t>
    </section>
    <section anchor="operations" numbered="true" toc="include" removeInRFC="false" pn="section-5">
      <name slugifiedName="name-protocol-operations">Protocol Operations</name>
      <t indent="0" pn="section-5-1">The goal of the security mechanisms defined in <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/> is to prevent unauthorized insertion
      of mapping data by providing origin authentication and integrity
      protection for the Map-Register and by using the nonce to detect an
      unsolicited Map-Reply sent by off-path attackers.</t>
      <t indent="0" pn="section-5-2">LISP-SEC builds on top of the security mechanisms defined in <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/> to address the threats described in
      <xref target="threat-model" format="default" sectionFormat="of" derivedContent="Section 4"/> by leveraging the trust relationships
      existing among the LISP entities <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/> participating in the exchange of the Map-Request/Map-Reply messages.
      Those trust relationships (see also <xref target="security" format="default" sectionFormat="of" derivedContent="Section 7"/> and <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>) are used to securely distribute, as described in <xref target="wrap" format="default" sectionFormat="of" derivedContent="Section 8.4"/>, a per-message One-Time Key (OTK) that provides origin authentication, integrity, and anti-replay protection to mapping data conveyed via the
      mapping lookup process and that effectively prevents overclaiming
      attacks. The processing of security parameters during the
      Map-Request/Map-Reply exchange is as follows:</t>
      <ul spacing="normal" bare="false" empty="false" indent="3" pn="section-5-3">
        <li pn="section-5-3.1">Per each Map-Request message, a new ITR-OTK is generated and
          stored at the ITR and is securely transported to the Map-Server.</li>
        <li pn="section-5-3.2">The Map-Server uses the ITR-OTK to compute a Hashed Message Authentication Code (HMAC) <xref target="RFC2104" format="default" sectionFormat="of" derivedContent="RFC2104"/> that protects
          the integrity of the mapping data known to the Map-Server to prevent
          overclaiming attacks. The Map-Server also derives a new OTK, the
          MS-OTK, that is passed to the ETR by applying a Key Derivation
          Function (KDF) (e.g., <xref target="RFC5869" format="default" sectionFormat="of" derivedContent="RFC5869"/>) to the ITR-OTK.</li>
        <li pn="section-5-3.3">The ETR uses the MS-OTK to compute an HMAC that protects the
          integrity of the Map-Reply sent to the ITR.</li>
        <li pn="section-5-3.4">Finally, the ITR uses the stored ITR-OTK to verify the integrity
          of the mapping data provided by both the Map-Server and the ETR, and
          to verify that no overclaiming attacks were mounted along the path
          between the Map-Server and the ITR.</li>
      </ul>
      <t indent="0" pn="section-5-4"><xref target="encap" format="default" sectionFormat="of" derivedContent="Section 6"/> provides the detailed description of the
      LISP-SEC control messages and their processing, while the rest of this
      section describes the flow of LISP protocol operations at each entity
      involved in the Map-Request/Map-Reply exchange:</t>
      <ol spacing="normal" type="1" indent="adaptive" start="1" pn="section-5-5">
	<li pn="section-5-5.1" derivedCounter="1.">The ITR, upon needing to transmit a Map-Request message,
        generates and stores an OTK (ITR-OTK). This ITR-OTK is encrypted and
	included into the Encapsulated Control Message (ECM) that contains the
	Map-Request sent to the Map-Resolver. </li>
        <li pn="section-5-5.2" derivedCounter="2.">The Map-Resolver decapsulates the ECM, decrypts the
          ITR-OTK (if needed), and forwards through the Mapping System the
          received Map-Request and the ITR-OTK, as part of a new ECM.
          The LISP Mapping System delivers the ECM to the appropriate
          Map-Server, as identified by the EID destination address of the
          Map-Request. </li>
        <li pn="section-5-5.3" derivedCounter="3.">The Map-Server is configured with the location mappings and
          policy information for the ETR responsible for the EID destination
          address. Using this preconfigured information, the Map-Server, after
          the decapsulation of the ECM, finds the longest-match
          EID-Prefix that covers the requested EID in the received
          Map-Request. The Map-Server adds this EID-Prefix, together with an
          HMAC computed using the ITR-OTK, to a new ECM
          that contains the received Map-Request.</li>
        <li pn="section-5-5.4" derivedCounter="4.">The Map-Server derives a new OTK, the MS-OTK, by applying a KDF to the ITR-OTK. This MS-OTK is included in
          the ECM that the Map-Server uses to forward
          the Map-Request to the ETR. </li>
        <li pn="section-5-5.5" derivedCounter="5.">If the Map-Server is acting in proxy mode, as specified in <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>, the ETR is not involved in the
          generation of the Map-Reply and steps 6 and 7 are skipped. In this
          case, the Map-Server generates the Map-Reply on behalf of the ETR, as
          described in <xref target="proxy" format="default" sectionFormat="of" derivedContent="Section 6.7.2"/>.</li>
        <li pn="section-5-5.6" derivedCounter="6.">The ETR, upon receiving the ECM-Encapsulated Map-Request from the
          Map-Server, decrypts the MS-OTK (if needed), and originates a
          Map-Reply that contains the EID-to-RLOC mapping information as
          specified in <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>.</li>
        <li pn="section-5-5.7" derivedCounter="7.">The ETR computes an HMAC over the Map-Reply, keyed with MS-OTK to
          protect the integrity of the whole Map-Reply. The ETR also copies
          the EID-Prefix authorization data that the Map-Server included in
          the ECM-Encapsulated Map-Request into the Map-Reply message. The ETR
          then sends the complete Map-Reply message to the requesting ITR.</li>
        <li pn="section-5-5.8" derivedCounter="8.">The ITR, upon receiving the Map-Reply, uses the locally stored
          ITR-OTK to verify the integrity of the EID-Prefix authorization data
          included in the Map-Reply by the Map-Server. The ITR computes the
          MS-OTK by applying the same KDF (as specified in the ECM-Encapsulated
	  Map-Reply) used by the Map-Server and verifies the
          integrity of the Map-Reply. </li>
      </ol>
    </section>
    <section anchor="encap" numbered="true" toc="include" removeInRFC="false" pn="section-6">
      <name slugifiedName="name-lisp-sec-control-messages-d">LISP-SEC Control Messages Details</name>
      <t indent="0" pn="section-6-1">LISP-SEC metadata associated with a Map-Request is transported within
      the Encapsulated Control Message that contains the Map-Request.</t>
      <t indent="0" pn="section-6-2">LISP-SEC metadata associated with the Map-Reply is transported within
      the Map-Reply itself.</t>
      <t indent="0" pn="section-6-3">These specifications use an HMAC in various places (as described in the following). The HMAC function AUTH-HMAC-SHA-256-128 <xref target="RFC6234" format="default" sectionFormat="of" derivedContent="RFC6234"/> <bcp14>MUST</bcp14> be supported in LISP-SEC implementations. LISP-SEC deployments <bcp14>SHOULD</bcp14> use the AUTH-HMAC-SHA-256-128 HMAC function, except when communicating with older implementations that only support AUTH-HMAC-SHA-1-96 <xref target="RFC2104" format="default" sectionFormat="of" derivedContent="RFC2104"/>. </t>
      <section anchor="ECM_extensions" numbered="true" toc="include" removeInRFC="false" pn="section-6.1">
        <name slugifiedName="name-encapsulated-control-messag">Encapsulated Control Message LISP-SEC Extensions</name>
        <t indent="0" pn="section-6.1-1">LISP-SEC uses the ECM defined in <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/> with the S-bit set to 1 to indicate
        that the LISP header includes Authentication Data (AD). The format of
        the LISP-SEC ECM AD is defined in <xref target="fig-AD" format="default" sectionFormat="of" derivedContent="Figure 1"/>. OTK-AD stands for One-Time Key Authentication Data
        and EID-AD stands for EID Authentication Data.</t>
        <figure anchor="fig-AD" align="left" suppress-title="false" pn="figure-1">
          <name slugifiedName="name-lisp-sec-ecm-authentication">LISP-SEC ECM Authentication Data</name>
          <artwork align="center" name="" type="" alt="" pn="section-6.1-2.1">
 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  ECM AD Type  |   Unassigned  |        Requested HMAC ID      |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\
|              OTK Length       |     Key ID    | OTK Wrap. ID  | |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
|                       One-Time-Key Preamble ...               | |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+OTK-AD
|                   ... One-Time-Key Preamble                   | |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
~                      One-Time Key (128 bits)                  ~/
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ &lt;---+
|           EID-AD Length       |           KDF ID              |     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     |
| Record Count  |E| Unassigned  |         EID HMAC ID           |EID-AD
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\    |
|  Unassigned   | EID mask-len  |           EID-AFI             | |   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ Rec |
~                          EID-Prefix ...                       ~ |   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+/    |
~                            EID HMAC                           ~     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ &lt;---+
</artwork>
        </figure>
        <dl newline="false" indent="3" spacing="normal" pn="section-6.1-3">
          <dt pn="section-6.1-3.1">ECM AD Type:</dt>
          <dd pn="section-6.1-3.2">1 (LISP-SEC Authentication Data). See <xref target="IANA" format="default" sectionFormat="of" derivedContent="Section 8"/>.</dd>
          <dt pn="section-6.1-3.3">Unassigned:</dt>
          <dd pn="section-6.1-3.4">Set to 0 on transmission and ignored on
          receipt.</dd>
          <dt pn="section-6.1-3.5">Requested HMAC ID:</dt>
          <dd pn="section-6.1-3.6">The HMAC algorithm, which will be used to
          protect the mappings, requested by the ITR. Permitted values are
	  registered in the LISP-SEC Authentication Data HMAC ID (see <xref target="HMAC" format="default" sectionFormat="of" derivedContent="Section 8.3"/>). Refer to <xref target="itr" format="default" sectionFormat="of" derivedContent="Section 6.4"/> for more details.</dd>
          <dt pn="section-6.1-3.7">OTK Length:</dt>
          <dd pn="section-6.1-3.8">The length (in bytes) of the OTK Authentication
          Data (OTK-AD), which contains the OTK Preamble and the OTK.</dd>
          <dt pn="section-6.1-3.9">Key ID:</dt>
          <dd pn="section-6.1-3.10">The identifier of the pre-shared secret shared by an
          ITR and the Map-Resolver, and by the Map-Server and an ETR.
          Per-message keys are derived from the pre-shared secret to
          encrypt, authenticate the origin, and protect the integrity of the
          OTK. The Key ID allows to rotate between multiple pre-shared
          secrets in a nondisruptive way.</dd>
          <dt pn="section-6.1-3.11">OTK Wrapping ID (OTK Wrap. ID):</dt>
          <dd pn="section-6.1-3.12">The identifier of the Key Derivation Function
          and of the key wrapping algorithm used to encrypt the
          One-Time-Key. Permitted values are registered in the LISP-SEC
	  Authentication Data Key Wrap ID (see <xref target="wrap" format="default" sectionFormat="of" derivedContent="Section 8.4"/>). Refer to <xref target="encryption" format="default" sectionFormat="of" derivedContent="Section 6.5"/> for more details. </dd>
          <dt pn="section-6.1-3.13">One-Time-Key Preamble:</dt>
          <dd pn="section-6.1-3.14">Set to 0 if the OTK is not encrypted.
          When the OTK is encrypted, this field <bcp14>MAY</bcp14> carry additional
          metadata resulting from the key wrapping operation. When a 128-bit
          OTK is sent unencrypted by a Map-Resolver, the OTK Preamble is set
          to 0x0000000000000000 (64 bits). See <xref target="null" format="default" sectionFormat="of" derivedContent="Section 6.5.1"/> for details.</dd>
          <dt pn="section-6.1-3.15">One-Time-Key:</dt>
          <dd pn="section-6.1-3.16">The OTK wrapped as specified by OTK Wrapping ID.
          See <xref target="encryption" format="default" sectionFormat="of" derivedContent="Section 6.5"/> for details.</dd>
          <dt pn="section-6.1-3.17">EID-AD Length:</dt>
          <dd pn="section-6.1-3.18">Length (in bytes) of the EID Authentication Data
          (EID-AD). The ITR <bcp14>MUST</bcp14> set the EID-AD Length to 4 bytes,
	  as it only
          fills the 'KDF ID' field, and all the remaining fields part of the
          EID-AD are not present. An EID-AD <bcp14>MAY</bcp14> contain multiple
          EID-Records. Each EID-Record is 4 bytes long, plus the length of the
          AFI-encoded EID-Prefix.</dd>
          <dt pn="section-6.1-3.19">KDF ID:</dt>
          <dd pn="section-6.1-3.20">Identifier of the Key Derivation Function used to
          derive the MS-OTK. Permitted values are registered in the LISP-SEC
	  Authentication Data Key Derivation Function ID (see <xref target="kdf" format="default" sectionFormat="of" derivedContent="Section 8.5"/>). Refer to <xref target="map-server" format="default" sectionFormat="of" derivedContent="Section 6.7"/> for more details. </dd>
          <dt pn="section-6.1-3.21">Record Count:</dt>
          <dd pn="section-6.1-3.22">As defined in <xref target="RFC9301" section="5.2" sectionFormat="of" format="default" derivedLink="https://rfc-editor.org/rfc/rfc9301#section-5.2" derivedContent="RFC9301"/>. </dd>
          <dt pn="section-6.1-3.23">E:</dt>
          <dd pn="section-6.1-3.24">ETR-Cant-Sign bit. If this bit is set to 1, it signals to the ITR
          that at least one of the ETRs that is authoritative for the EID-Prefixes
          of this Map-Reply has not enabled LISP-SEC. Only a Map-Server can set
	  this bit. See <xref target="map-server" format="default" sectionFormat="of" derivedContent="Section 6.7"/> for more
	  details.</dd>
          <dt pn="section-6.1-3.25">Unassigned:</dt>
          <dd pn="section-6.1-3.26">Set to 0 on transmission and ignored on
          receipt.</dd>
          <dt pn="section-6.1-3.27">EID HMAC ID:</dt>
          <dd pn="section-6.1-3.28">Identifier of the HMAC algorithm used to protect
          the integrity of the EID-AD. This field is filled by the Map-Server
          that computed the EID-Prefix HMAC. See <xref target="EID-AD" format="default" sectionFormat="of" derivedContent="Section 6.7.1"/> for more details. </dd>
          <dt pn="section-6.1-3.29">EID mask-len:</dt>
          <dd pn="section-6.1-3.30">As defined in <xref target="RFC9301" section="5.2" sectionFormat="of" format="default" derivedLink="https://rfc-editor.org/rfc/rfc9301#section-5.2" derivedContent="RFC9301"/>.</dd>
          <dt pn="section-6.1-3.31">EID-AFI:</dt>
          <dd pn="section-6.1-3.32">As defined in <xref target="RFC9301" section="5.2" sectionFormat="of" format="default" derivedLink="https://rfc-editor.org/rfc/rfc9301#section-5.2" derivedContent="RFC9301"/>.</dd>
          <dt pn="section-6.1-3.33">EID-Prefix:</dt>
          <dd pn="section-6.1-3.34">As defined in <xref target="RFC9301" section="5.2" sectionFormat="of" format="default" derivedLink="https://rfc-editor.org/rfc/rfc9301#section-5.2" derivedContent="RFC9301"/>.</dd>
          <dt pn="section-6.1-3.35">EID HMAC:</dt>
          <dd pn="section-6.1-3.36">HMAC of the EID-AD computed and inserted by a
          Map-Server. See <xref target="EID-AD" format="default" sectionFormat="of" derivedContent="Section 6.7.1"/> for more details. 
            </dd>
        </dl>
      </section>
      <section anchor="MR_extensions" numbered="true" toc="include" removeInRFC="false" pn="section-6.2">
        <name slugifiedName="name-map-reply-lisp-sec-extensio">Map-Reply LISP-SEC Extensions</name>
        <t indent="0" pn="section-6.2-1">LISP-SEC uses the Map-Reply defined in <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>, with Type set to 2 and S-bit set
        to 1 to indicate that the Map-Reply message includes Authentication
        Data (AD). The format of the LISP-SEC Map-Reply Authentication Data is
        defined in <xref target="map-reply-AD" format="default" sectionFormat="of" derivedContent="Figure 2"/>. PKT-AD is the Packet
        Authentication Data that covers the Map-Reply payload.</t>
        <figure anchor="map-reply-AD" align="left" suppress-title="false" pn="figure-2">
          <name slugifiedName="name-lisp-sec-map-reply-authenti">LISP-SEC Map-Reply Authentication Data</name>
          <artwork align="center" name="" type="" alt="" pn="section-6.2-2.1"> 0                   1                   2                   3
 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
|  MR AD Type   |                Unassigned                     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ &lt;---+
|           EID-AD Length       |           KDF ID              |     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+     |
| Record Count  |   Unassigned  |         EID HMAC ID           |EID-AD
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+\    |
|  Unassigned   | EID mask-len  |           EID-AFI             | |   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ Rec |
~                          EID-Prefix ...                       ~ |   |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+/    |
~                            EID HMAC                           ~     |
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ &lt;---+
|         PKT-AD Length         |         PKT HMAC ID           |\
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+ |
~                            PKT HMAC                           ~PKT-AD
+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+/
</artwork>
        </figure>
        <dl newline="false" indent="3" spacing="normal" pn="section-6.2-3">
          <dt pn="section-6.2-3.1">MR AD Type:</dt>
          <dd pn="section-6.2-3.2">1 (LISP-SEC Authentication Data). See <xref target="IANA" format="default" sectionFormat="of" derivedContent="Section 8"/>.</dd>
          <dt pn="section-6.2-3.3">EID-AD Length:</dt>
          <dd pn="section-6.2-3.4">Length (in bytes) of the EID-AD (see <xref target="ECM_extensions" format="default" sectionFormat="of" derivedContent="Section 6.1"/>). </dd>
          <dt pn="section-6.2-3.5">KDF ID:</dt>
          <dd pn="section-6.2-3.6">Identifier of the Key Derivation Function used to
          derive MS-OTK (see <xref target="ECM_extensions" format="default" sectionFormat="of" derivedContent="Section 6.1"/>).</dd>
          <dt pn="section-6.2-3.7">Record Count:</dt>
          <dd pn="section-6.2-3.8">The number of records in this Map-Reply message (see <xref target="ECM_extensions" format="default" sectionFormat="of" derivedContent="Section 6.1"/>).</dd>
          <dt pn="section-6.2-3.9">Unassigned:</dt>
          <dd pn="section-6.2-3.10">Set to 0 on transmission and ignored on receipt.</dd>
          <dt pn="section-6.2-3.11">EID HMAC ID:</dt>
          <dd pn="section-6.2-3.12">Identifier of the HMAC algorithm used to protect
          the integrity of the EID-AD (see <xref target="ECM_extensions" format="default" sectionFormat="of" derivedContent="Section 6.1"/>). </dd>
          <dt pn="section-6.2-3.13">EID mask-len:</dt>
          <dd pn="section-6.2-3.14">Mask length for EID-Prefix (see <xref target="ECM_extensions" format="default" sectionFormat="of" derivedContent="Section 6.1"/>).</dd>
          <dt pn="section-6.2-3.15">EID-AFI:</dt>
          <dd pn="section-6.2-3.16">See <xref target="ECM_extensions" format="default" sectionFormat="of" derivedContent="Section 6.1"/>. </dd>
          <dt pn="section-6.2-3.17">EID-Prefix:</dt>
          <dd pn="section-6.2-3.18">See <xref target="ECM_extensions" format="default" sectionFormat="of" derivedContent="Section 6.1"/>. </dd>
          <dt pn="section-6.2-3.19">EID HMAC:</dt>
          <dd pn="section-6.2-3.20">See <xref target="ECM_extensions" format="default" sectionFormat="of" derivedContent="Section 6.1"/>. </dd>
          <dt pn="section-6.2-3.21">PKT-AD Length:</dt>
          <dd pn="section-6.2-3.22">Length (in bytes) of the Packet Authentication
          Data (PKT-AD).</dd>
          <dt pn="section-6.2-3.23">PKT HMAC ID:</dt>
          <dd pn="section-6.2-3.24">Identifier of the HMAC algorithm used to protect
          the integrity of the Map-Reply (see <xref target="encryption" format="default" sectionFormat="of" derivedContent="Section 6.5"/>).</dd>
          <dt pn="section-6.2-3.25">PKT HMAC:</dt>
          <dd pn="section-6.2-3.26">HMAC of the whole Map-Reply packet to protect its integrity,
	  including the LISP-SEC Authentication Data (from the 'Map-Reply Type'
	  field to the 'PKT HMAC' field), which allow message authentication.</dd>
        </dl>
      </section>
      <section numbered="true" toc="include" removeInRFC="false" pn="section-6.3">
        <name slugifiedName="name-map-register-lisp-sec-exten">Map-Register LISP-SEC Extensions</name>
        <t indent="0" pn="section-6.3-1">The S-bit in the Map-Register message (see <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>) indicates to the Map-Server that the registering ETR is LISP-SEC enabled. An ETR that supports LISP-SEC <bcp14>MUST</bcp14> set the S-bit in its Map-Register messages.</t>
      </section>
      <section anchor="itr" numbered="true" toc="include" removeInRFC="false" pn="section-6.4">
        <name slugifiedName="name-itr-processing-generating-a">ITR Processing: Generating a Map-Request</name>
        <t indent="0" pn="section-6.4-1">Upon creating a Map-Request, the ITR generates a random ITR-OTK
        that is stored locally, until the corresponding Map-Reply is
        received (see <xref target="itr-receive" format="default" sectionFormat="of" derivedContent="Section 6.9"/>), together with the nonce generated as specified in <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>.</t>
        <t indent="0" pn="section-6.4-2">The ITR <bcp14>MAY</bcp14> use the 'KDF ID' field to indicate the recommended KDF algorithm according to local policy. The Map-Server can overwrite the KDF ID if it does not support the KDF ID recommended by the ITR (see <xref target="map-server" format="default" sectionFormat="of" derivedContent="Section 6.7"/>). A KDF value of NOPREF (0) may be used to specify that the ITR has no preferred KDF ID.
        </t>
        <t indent="0" pn="section-6.4-3">ITR-OTK confidentiality and integrity protection <bcp14>MUST</bcp14> be provided
        in the path between the ITR and the Map-Resolver. This can be achieved
        either by encrypting the ITR-OTK with the pre-shared secret known to
        the ITR and the Map-Resolver (see <xref target="encryption" format="default" sectionFormat="of" derivedContent="Section 6.5"/>) or by
        enabling DTLS <xref target="RFC9147" format="default" sectionFormat="of" derivedContent="RFC9147"/> between the ITR and the Map-Resolver.</t>
        <t indent="0" pn="section-6.4-4">The Map-Request (as defined in <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>) <bcp14>MUST</bcp14> be encapsulated as a LISP Control Message in an ECM, with the S-bit set to 1, to indicate the presence of Authentication Data. Such a message is also called a "Protected Map-Request" in this memo.</t>
        <t indent="0" pn="section-6.4-5">The ITR-OTK is wrapped with the algorithm specified by the 'OTK Wrapping
        ID' field. See <xref target="encryption" format="default" sectionFormat="of" derivedContent="Section 6.5"/> for further details on OTK
        encryption. If the NULL-KEY-WRAP-128 algorithm (see <xref target="wrap" format="default" sectionFormat="of" derivedContent="Section 8.4"/>) is selected, and no other encryption mechanism (e.g., DTLS) is enabled in the path between the ITR and the Map-Resolver, the Map-Request <bcp14>MUST</bcp14> be dropped, and an appropriate log action <bcp14>SHOULD</bcp14> be taken. Implementations may include mechanisms (which are beyond the scope of this document) to avoid log resource exhaustion attacks.</t>
        <t indent="0" pn="section-6.4-6">The 'Requested HMAC ID' field contains the suggested HMAC algorithm
        to be used by the Map-Server and the ETR to protect the integrity of
        the ECM Authentication Data and of the Map-Reply.  A HMAC ID value of
        NONE (0) <bcp14>MAY</bcp14> be used to specify that the ITR has no preferred HMAC ID.
        </t>
        <t indent="0" pn="section-6.4-7">The 'KDF ID' field specifies the suggested Key Derivation Function to
        be used by the Map-Server to derive the MS-OTK. A KDF value of NONE
        (0) may be used to specify that the ITR has no preferred KDF ID.</t>
        <t indent="0" pn="section-6.4-8">The EID-AD Length is set to 4 bytes, since the Authentication Data
        does not contain EID-Prefix Authentication Data, and the EID-AD
        contains only the 'KDF ID' field.</t>
        <t indent="0" pn="section-6.4-9">If the ITR is directly connected to a Mapping System, such as LISP+ALT <xref target="RFC6836" format="default" sectionFormat="of" derivedContent="RFC6836"/>, it performs the functions of both the ITR and the Map-Resolver, forwarding the Protected Map-Request as described in <xref target="map-resolver" format="default" sectionFormat="of" derivedContent="Section 6.6"/>.</t>
        <t indent="0" pn="section-6.4-10">The processing performed by Proxy ITRs (PITRs) is equivalent to the
        processing of an ITR; hence, the procedure described above applies.
        </t>
      </section>
      <section anchor="encryption" numbered="true" toc="include" removeInRFC="false" pn="section-6.5">
        <name slugifiedName="name-encrypting-and-decrypting-a">Encrypting and Decrypting an OTK</name>
        <t indent="0" pn="section-6.5-1">MS-OTK confidentiality and integrity protection <bcp14>MUST</bcp14> be provided in
        the path between the Map-Server and the ETR. This can be achieved
        either by enabling DTLS between the Map-Server and the ETR or by
        encrypting the MS-OTK with the pre-shared secret known to the
        Map-Server and the ETR <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>.</t>
        <t indent="0" pn="section-6.5-2">Similarly, ITR-OTK confidentiality and integrity protection <bcp14>MUST</bcp14> be
        provided in the path between the ITR and the Map-Resolver. This can be
        achieved either by enabling DTLS between the Map-Server and the ITR
        or by encrypting the ITR-OTK with the pre-shared secret known to the
        ITR and the Map-Resolver. The ITR/Map-Resolver pre-shared key is
        similar to the Map-Server/ETR pre-shared key.</t>
        <t indent="0" pn="section-6.5-3">This section describes OTK processing in the ITR/Map-Resolver path,
        as well as in the Map-Server/ETR path.</t>
        <t indent="0" pn="section-6.5-4">It's important to note that, to prevent ETR's overclaiming attacks,
        the ITR/Map-Resolver pre-shared secret <bcp14>MUST</bcp14> be independent from the
        Map-Server/ETR pre-shared secret.</t>
        <t indent="0" pn="section-6.5-5">The OTK is wrapped using the algorithm specified in the 'OTK
        Wrapping ID' field. This field identifies both the:</t>
        <ul spacing="normal" bare="false" empty="false" indent="3" pn="section-6.5-6">
          <li pn="section-6.5-6.1">Key Encryption Algorithm used to encrypt the wrapped OTK and</li>
          <li pn="section-6.5-6.2">Key Derivation Function used to derive a per-message encryption
            key.</li>
        </ul>
        <t indent="0" pn="section-6.5-7">
          Implementations of this specification <bcp14>MUST</bcp14> support the OTK
          Wrapping ID AES-KEY-WRAP-128+HKDF-SHA256, which specifies the use of the
          HKDF-SHA256 Key Derivation Function specified in <xref target="RFC5869" format="default" sectionFormat="of" derivedContent="RFC5869"/> to derive a per-message encryption key
          (per-msg-key), as well as the AES-KEY-WRAP-128 key wrap algorithm used
          to encrypt a 128-bit OTK, according to <xref target="RFC3394" format="default" sectionFormat="of" derivedContent="RFC3394"/>.</t>
        <t indent="0" pn="section-6.5-8">Implementations of this specification <bcp14>MUST</bcp14> support OTK
          Wrapping NULL-KEY-WRAP-128. NULL-KEY-WRAP-128 is used to carry an unencrypted 128-bit OTK, with a 64-bit preamble set to 0x0000000000000000 (64 bits).</t>
        <t indent="0" pn="section-6.5-9">The key wrapping process for OTK Wrapping ID
        AES-KEY-WRAP-128+HKDF-SHA256 is described below:
        </t>
        <ol spacing="normal" type="1" indent="adaptive" start="1" pn="section-6.5-10">
	  <li pn="section-6.5-10.1" derivedCounter="1.">The KDF and key wrap algorithms are identified by the value of the 'OTK Wrapping ID' field. The initial values are documented in <xref target="tableKWF" format="default" sectionFormat="of" derivedContent="Table 5"/>.</li>
          <li pn="section-6.5-10.2" derivedCounter="2.">If the NULL-KEY-WRAP-128 algorithm (see <xref target="wrap" format="default" sectionFormat="of" derivedContent="Section 8.4"/>) is selected and DTLS is not enabled, the Map-Request
            <bcp14>MUST</bcp14> be dropped and an appropriate log action <bcp14>SHOULD</bcp14> be taken. Implementations may include mechanisms (which are beyond the scope of this document) to avoid log resource exhaustion attacks.</li>
          <li pn="section-6.5-10.3" derivedCounter="3.">The pre-shared secret used to derive the per-msg-key is
            represented by PSK[Key ID], which is the pre-shared secret
            identified by the 'Key ID'.</li>
          <li pn="section-6.5-10.4" derivedCounter="4.">
            <t indent="0" pn="section-6.5-10.4.1">The 128-bit-long per-message encryption key is computed as:</t>
            <t indent="3" pn="section-6.5-10.4.2">per-msg-key = KDF( nonce + s + PSK[Key ID] )</t>
            <t indent="0" pn="section-6.5-10.4.3">where the nonce is the value in the 'Nonce' field of the
            Map-Request, 's' is the string "OTK-Key-Wrap", and the operation'+'
	    just indicates string concatenation.</t>
          </li>
          <li pn="section-6.5-10.5" derivedCounter="5.">The per-msg-key is then used to wrap the OTK with AES-KEY-WRAP-128, as specified in <xref target="RFC3394" format="default" sectionFormat="of" section="2.2.1" derivedLink="https://rfc-editor.org/rfc/rfc3394#section-2.2.1" derivedContent="RFC3394"/>. The AES Key Wrap
            Initialization Value <bcp14>MUST</bcp14> be set to 0xA6A6A6A6A6A6A6A6 (64 bits).
            The output of the AES key wrap operation is 192 bits long.
	    The most significant 64 bits
       are copied in the 'One-Time Key Preamble' field, while the 128
       least significant bits are copied in the 'One-Time Key' field of
       the LISP-SEC Authentication Data.</li>
        </ol>
        <t indent="0" pn="section-6.5-11">When decrypting an encrypted OTK, the receiver <bcp14>MUST</bcp14> verify that the
        Initialization Value resulting from the AES key wrap decryption
        operation is equal to 0xA6A6A6A6A6A6A6A6. If this verification fails,
        the receiver <bcp14>MUST</bcp14> discard the entire message.</t>
        <section anchor="null" numbered="true" toc="include" removeInRFC="false" pn="section-6.5.1">
          <name slugifiedName="name-unencrypted-otk">Unencrypted OTK</name>
          <t indent="0" pn="section-6.5.1-1">However, when DTLS is enabled, the OTK <bcp14>MAY</bcp14> be sent unencrypted as
          transport layer security is providing confidentiality and integrity
          protection.</t>
          <t indent="0" pn="section-6.5.1-2">When a 128-bit OTK is sent unencrypted, the OTK Wrapping ID is set
          to NULL_KEY_WRAP_128, and the OTK Preamble is set to
          0x0000000000000000 (64 bits).</t>
        </section>
      </section>
      <section anchor="map-resolver" numbered="true" toc="include" removeInRFC="false" pn="section-6.6">
        <name slugifiedName="name-map-resolver-processing">Map-Resolver Processing</name>
        <t indent="0" pn="section-6.6-1">Upon receiving a Protected Map-Request, the Map-Resolver decapsulates the ECM. The ITR-OTK, if encrypted,
        is decrypted as specified in <xref target="encryption" format="default" sectionFormat="of" derivedContent="Section 6.5"/>.</t>
        <t indent="0" pn="section-6.6-2">Protecting the confidentiality of the ITR-OTK and, in general, the
        security of how the Map-Request is handed by the Map-Resolver to the
        Map-Server is specific to the particular Mapping System used and is
        outside of the scope of this memo.</t>
        <t indent="0" pn="section-6.6-3">In Mapping Systems where the Map-Server is compliant with <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>, the Map-Resolver originates a new
        ECM header with the S-bit set, which contains the unencrypted ITR-OTK,
        as specified in <xref target="encryption" format="default" sectionFormat="of" derivedContent="Section 6.5"/>, and the other data
        derived from the ECM Authentication Data of the received Encapsulated
        Map-Request.</t>
        <t indent="0" pn="section-6.6-4">The Map-Resolver then forwards to the Map-Server the received
        Map-Request, which is encapsulated in the new ECM header that includes the
        newly computed 'Authentication Data' fields.</t>
      </section>
      <section anchor="map-server" numbered="true" toc="include" removeInRFC="false" pn="section-6.7">
        <name slugifiedName="name-map-server-processing">Map-Server Processing</name>
        <t indent="0" pn="section-6.7-1">Upon receiving a Protected Map-Request, the Map-Server processes it according to the setting of the S-bit and the P-bit in the Map-Register received from the ETRs authoritative for that prefix, as described below.</t>
        <t indent="0" pn="section-6.7-2">While processing the Map-Request, the Map-Server can overwrite the 'KDF ID' field if it does not support the KDF ID recommended by the ITR.
        Processing of the Map-Request <bcp14>MUST</bcp14> proceed in the order described
        in the table below, applying the process corresponding to the first
        rule that matches the conditions indicated in the first column:</t>
        <table anchor="tableMRP" align="center" pn="table-1">
          <name slugifiedName="name-map-request-processing">Map-Request Processing</name>
          <thead>
            <tr>
              <th align="left" colspan="1" rowspan="1">Matching Condition</th>
              <th align="left" colspan="1" rowspan="1">Processing</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left" colspan="1" rowspan="1">1. At least one of the ETRs authoritative for the
	      EID-Prefix included in the Map-Request registered with the P-bit set
	      to 1</td>
              <td align="left" colspan="1" rowspan="1">The Map-Server <bcp14>MUST</bcp14> generate a
	      LISP-SEC-protected Map-Reply, as
              specified in <xref target="proxy" format="default" sectionFormat="of" derivedContent="Section 6.7.2"/>. The
	      ETR-Cant-Sign E-bit in the
              EID Authentication Data (EID-AD) <bcp14>MUST</bcp14> be set to 0.</td>
            </tr>
            <tr>
              <td align="left" colspan="1" rowspan="1">2. At least one of the ETRs authoritative for the
	      EID-Prefix included in the Map-Request registered with the S-bit set
	      to 1</td>
              <td align="left" colspan="1" rowspan="1">The Map-Server <bcp14>MUST</bcp14> generate a
	      LISP-SEC-protected Encapsulated
              Map-Request (as specified in <xref target="EID-AD" format="default" sectionFormat="of" derivedContent="Section 6.7.1"/>) to be sent to
              one of the authoritative ETRs that registered with the S-bit set to
              1 (and the P-bit set to 0). If there is at least one ETR that
              registered with the S-bit set to 0, the ETR-Cant-Sign E-bit of the
              EID-AD <bcp14>MUST</bcp14> be set to 1 to signal the ITR that a non-LISP-SEC
	      Map-Request might reach additional ETRs that have LISP-SEC
              disabled.</td>
            </tr>
            <tr>
              <td align="left" colspan="1" rowspan="1">3. All the ETRs authoritative for the EID-Prefix
	      included in the
              Map-Request registered with the S-bit set to 0</td>
              <td align="left" colspan="1" rowspan="1">The Map-Server <bcp14>MUST</bcp14> send a Negative
	      Map-Reply protected with
              LISP-SEC, as described in <xref target="proxy" format="default" sectionFormat="of" derivedContent="Section 6.7.2"/>.
	      The ETR-Cant-Sign
              E-bit <bcp14>MUST</bcp14> be set to 1 to signal the ITR that a non-LISP-SEC
	      Map-Request might reach additional ETRs that have LISP-SEC
              disabled.</td>
            </tr>
          </tbody>
        </table>
        <t indent="0" pn="section-6.7-4">In this way, the ITR that sent a LISP-SEC-protected Map-Request
        always receives a LISP-SEC-protected Map-Reply. However, the
        ETR-Cant-Sign E-bit set to 1 specifies that a non-LISP-SEC Map-Request
        might reach additional ETRs that have LISP-SEC disabled. This
        mechanism allows the ITR to downgrade to non-LISP-SEC
        requests, which does not protect against threats described in <xref target="threat-model" format="default" sectionFormat="of" derivedContent="Section 4"/>.</t>
        <section anchor="EID-AD" numbered="true" toc="include" removeInRFC="false" pn="section-6.7.1">
          <name slugifiedName="name-generating-a-lisp-sec-prote">Generating a LISP-SEC-Protected Encapsulated Map-Request</name>
          <t indent="0" pn="section-6.7.1-1">The Map-Server decapsulates the ECM and generates new ECM
          Authentication Data. The Authentication Data includes the OTK-AD and
          the EID-AD, which contains EID-Prefix authorization information that
          are eventually received by the requesting ITR.</t>
          <t indent="0" pn="section-6.7.1-2">The Map-Server updates the OTK-AD by deriving a new OTK (MS-OTK)
          from the ITR-OTK received with the Map-Request. MS-OTK is derived by
          applying the Key Derivation Function specified in the 'KDF ID' field.
          If the algorithm specified in the 'KDF ID' field is not supported, the
          Map-Server uses a different algorithm to derive the key and updates
          the 'KDF ID' field accordingly.</t>
          <t indent="0" pn="section-6.7.1-3">The Map-Request <bcp14>MUST</bcp14> be encapsulated in an ECM, with the S-bit
          set to 1, to indicate the presence of Authentication Data.</t>
          <t indent="0" pn="section-6.7.1-4">MS-OTK is wrapped with the algorithm specified by the 'OTK
          Wrapping ID' field. See <xref target="encryption" format="default" sectionFormat="of" derivedContent="Section 6.5"/> for further
          details on OTK encryption. If the NULL-KEY-WRAP-128 algorithm is
          selected and DTLS is not enabled in the path between the Map-Server
          and the ETR, the Map-Request <bcp14>MUST</bcp14> be dropped and an appropriate log
          action <bcp14>SHOULD</bcp14> be taken.</t>
          <t indent="0" pn="section-6.7.1-5">In the EID-AD, the Map-Server includes in the EID-AD the longest-match-registered
	  EID-Prefix for the destination EID and an HMAC of this
          EID-Prefix. The HMAC is keyed with the ITR-OTK contained in the
          received ECM Authentication Data, and the HMAC algorithm is chosen
          according to the 'Requested HMAC ID' field. If the Map-Server does not
          support this algorithm, the Map-Server uses a different algorithm
          and specifies it in the 'EID HMAC ID' field. The scope of the HMAC
          operation <bcp14>MUST</bcp14> cover the entire EID-AD, from the 'EID-AD Length' field to the 'EID HMAC' field, which <bcp14>MUST</bcp14> be set to 0 before the
          computation.</t>
          <t indent="0" pn="section-6.7.1-6">The Map-Server then forwards the updated ECM-Encapsulated
          Map-Request, which contains the OTK-AD, the EID-AD, and the received
          Map-Request to an authoritative ETR as specified in <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>.</t>
        </section>
        <section anchor="proxy" numbered="true" toc="include" removeInRFC="false" pn="section-6.7.2">
          <name slugifiedName="name-generating-a-proxy-map-repl">Generating a Proxy Map-Reply</name>
          <t indent="0" pn="section-6.7.2-1">A LISP-SEC proxy Map-Reply is generated according to <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>, with the Map-Reply S-bit set
          to 1. The Map-Reply includes the Authentication Data that contains
          the EID-AD computed as specified in <xref target="EID-AD" format="default" sectionFormat="of" derivedContent="Section 6.7.1"/>, as
          well as the PKT-AD computed as specified in <xref target="etr" format="default" sectionFormat="of" derivedContent="Section 6.8"/>.</t>
        </section>
      </section>
      <section anchor="etr" numbered="true" toc="include" removeInRFC="false" pn="section-6.8">
        <name slugifiedName="name-etr-processing">ETR Processing</name>
        <t indent="0" pn="section-6.8-1">Upon receiving an ECM-Encapsulated Map-Request with the S-bit set,
        the ETR decapsulates the ECM. The 'OTK' field, if encrypted, is
        decrypted as specified in <xref target="encryption" format="default" sectionFormat="of" derivedContent="Section 6.5"/> to obtain the
        unencrypted MS-OTK.</t>
        <t indent="0" pn="section-6.8-2">The ETR then generates a Map-Reply as specified in <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/> and includes the Authentication
        Data that contains the EID-AD, as received in the Encapsulated
        Map-Request, as well as the PKT-AD.</t>
        <t indent="0" pn="section-6.8-3">The EID-AD is copied from the Authentication Data of the received
        Encapsulated Map-Request.</t>
        <t indent="0" pn="section-6.8-4">The PKT-AD contains the HMAC of the whole Map-Reply packet, keyed
        with the MS-OTK and computed using the HMAC algorithm specified in the
        'Requested HMAC ID' field of the received Encapsulated Map-Request.
        If the ETR does not support the Requested HMAC ID, it uses a different algorithm and updates the 'PKT HMAC ID' field accordingly.
        The HMAC operation <bcp14>MUST</bcp14> cover the entire Map-Reply, where the 'PKT HMAC' field <bcp14>MUST</bcp14> be set to 0 before the computation.
        </t>
        <t indent="0" pn="section-6.8-5">Finally, the ETR sends the Map-Reply to the requesting ITR as
        specified in <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>.</t>
      </section>
      <section anchor="itr-receive" numbered="true" toc="include" removeInRFC="false" pn="section-6.9">
        <name slugifiedName="name-itr-processing-receiving-a-">ITR Processing: Receiving a Map-Reply</name>
        <t indent="0" pn="section-6.9-1">In response to a Protected Map-Request, an ITR expects a Map-Reply with the S-bit set to 1, including an EID-AD and a PKT-AD.  The ITR <bcp14>MUST</bcp14> discard the Map-Reply otherwise.
        </t>
        <t indent="0" pn="section-6.9-2">Upon receiving a Map-Reply, the ITR must verify the integrity of
        both the EID-AD and the PKT-AD and <bcp14>MUST</bcp14> discard the Map-Reply if one
        of the integrity checks fails. After processing the Map-Reply, the ITR
        <bcp14>MUST</bcp14> discard the &lt;nonce,ITR-OTK&gt; pair associated to the
        Map-Reply.</t>
        <t indent="0" pn="section-6.9-3">The integrity of the EID-AD is verified using the ITR-OTK (stored
        locally for the duration of this exchange) to recompute the HMAC of
        the EID-AD using the algorithm specified in the 'EID HMAC ID' field.
        If the ITR did indicate a Requested HMAC ID in the Map-Request and the PKT HAMC ID in the corresponding Map-Reply is different, or if the ITR did not indicate a Requested HMAC ID in the Map-Request and the PKT HMAC ID in the corresponding Map-Reply is not supported, then the ITR <bcp14>MUST</bcp14> discard the Map-Reply and send, according to rate-limitation policies defined in <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>, a new Map-Request with a different 'Requested HMAC ID' field, according to ITR's local policy. The scope of the HMAC operation covers the entire EID-AD, from the 'EID-AD Length' field to the 'EID HMAC' field.</t>
        <t indent="0" pn="section-6.9-4">ITR <bcp14>MUST</bcp14> set the 'EID HMAC ID' field to 0 before computing the
        HMAC.</t>
        <t indent="0" pn="section-6.9-5">To verify the integrity of the PKT-AD, first the MS-OTK is derived
        from the locally stored ITR-OTK using the algorithm specified in the
        'KDF ID' field.
        This is because the PKT-AD is generated by the ETR using
        the MS-OTK. If the ITR did indicate a recommended KDF ID in the Map-Request and the KDF ID in the corresponding Map-Reply is different or if the ITR did not indicate a recommended KDF ID in the Map-Request and the KDF ID in the corresponding Map-Reply is not supported, then the ITR <bcp14>MUST</bcp14> discard the Map-Reply and
        send, according to rate-limitation policies defined in <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>, a new Map-Request with a
        different KDF ID, according to ITR's local policy.
        The Key Derivation Function HKDF-SHA256 <bcp14>MUST</bcp14> be supported in LISP-SEC implementations. LISP-SEC deployments <bcp14>SHOULD</bcp14> use the HKDF-SHA256 HKDF function, unless older implementations using HKDF-SHA1-128 are present in the same deployment.
         Without consistent configuration of involved entities, extra delays may be experienced.
        However, since HKDF-SHA1-128 and HKDF-SHA256 are supported, the process will eventually converge.
        </t>
        <t indent="0" pn="section-6.9-6">The derived MS-OTK is then used to recompute the HMAC of the
        PKT-AD using the algorithm specified in the 'PKT HMAC ID' field. If the
        'PKT HMAC ID' field does not match the Requested HMAC ID, the ITR <bcp14>MUST</bcp14>
        discard the Map-Reply and send, according to rate-limitation policies defined in <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>,
        a new Map-Request with a different Requested HMAC ID, according to
        ITR's local policy or until all HMAC IDs supported by the ITR have
        been attempted. When the 'PKT HMAC ID' field does not match the Requested HMAC ID, it is not possible to validate the Map-Reply.</t>
        <t indent="0" pn="section-6.9-7">Each individual Map-Reply EID-Record is considered valid only if:
        (1) both EID-AD and PKT-AD are valid and (2) the intersection of the
        EID-Prefix in the Map-Reply EID-Record with one of the EID-Prefixes
        contained in the EID-AD is not empty. After identifying the Map-Reply
        record as valid, the ITR sets the EID-Prefix in the Map-Reply record
        to the value of the intersection set computed before and adds the
        Map-Reply EID-Record to its EID-to-RLOC Map-Cache, as described in <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>. An example of Map-Reply record
        validation is provided in <xref target="validation" format="default" sectionFormat="of" derivedContent="Section 6.9.1"/>.</t>
        <t indent="0" pn="section-6.9-8"><xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/> allows ETRs to send
        Solicit-Map-Requests (SMRs) directly to the ITR. The corresponding SMR-invoked Map-Request will be sent through the Mapping System, hence, secured with the specifications of this memo if in use.
        If an ITR accepts Map-Replies piggybacked in Map-Requests and its content is not already present in its EID-to-RLOC Map-Cache, it <bcp14>MUST</bcp14> send a Map-Request over the Mapping System in order to verify its content with a secured Map-Reply before using the content.</t>
        <section anchor="validation" numbered="true" toc="include" removeInRFC="false" pn="section-6.9.1">
          <name slugifiedName="name-map-reply-record-validation">Map-Reply Record Validation</name>
          <t indent="0" pn="section-6.9.1-1">The payload of a Map-Reply may contain multiple EID-Records. The
          whole Map-Reply is signed by the ETR, with the PKT HMAC, to provide
          integrity protection and origin authentication to the EID-Prefix
          records claimed by the ETR. The 'Authentication Data' field of a
          Map-Reply may contain multiple EID-Records in the EID-AD. The EID-AD
          is signed by the Map-Server, with the EID HMAC, to provide integrity
          protection and origin authentication to the EID-Prefix records
          inserted by the Map-Server.</t>
          <t indent="0" pn="section-6.9.1-2">Upon receiving a Map-Reply with the S-bit set, the ITR first
          checks the validity of both the EID HMAC and of the PKT-AD HMAC. If
          either one of the HMACs is not valid, a log action <bcp14>SHOULD</bcp14> be taken and
          the Map-Reply <bcp14>MUST NOT</bcp14> be processed any further. Implementations may include mechanisms (which are beyond the scope of this document) to avoid log resource exhaustion attacks. If both HMACs are
          valid, the ITR proceeds with validating each individual EID-Record
          claimed by the ETR by computing the intersection of each one of the
          EID-Prefixes contained in the payload of the Map-Reply, with each one
          of the EID-Prefixes contained in the EID-AD. An EID-Record is valid
          only if at least one of the intersections is not the empty set; otherwise, a log action <bcp14>MUST</bcp14> be taken and the EID-Record <bcp14>MUST</bcp14> be discarded. Implementations may include mechanisms (which are beyond the scope of this document) to avoid log resource exhaustion attacks.</t>
          <t indent="0" pn="section-6.9.1-3">For instance, the Map-Reply payload contains 3 mapping record
          EID-Prefixes:
          </t>
          <ul empty="true" spacing="normal" bare="false" indent="3" pn="section-6.9.1-4">
            <li pn="section-6.9.1-4.1">2001:db8:102::/48</li>
            <li pn="section-6.9.1-4.2">2001:db8:103::/48</li>
            <li pn="section-6.9.1-4.3">2001:db8:200::/40</li>
          </ul>
          <t indent="0" pn="section-6.9.1-5">
          The EID-AD contains two EID-Prefixes:
          </t>
          <ul empty="true" spacing="normal" bare="false" indent="3" pn="section-6.9.1-6">
            <li pn="section-6.9.1-6.1">2001:db8:103::/48</li>
            <li pn="section-6.9.1-6.2">2001:db8:203::/48</li>
          </ul>
          <t indent="0" pn="section-6.9.1-7">
          The EID-Record with EID-Prefix 2001:db8:102::/48 is not
          eligible to be used by the ITR, since it is not included in any of
          the EID-ADs signed by the Map-Server. A log action <bcp14>MUST</bcp14> be taken, and the EID-Record <bcp14>MUST</bcp14> be
 	   discarded. Implementations may include mechanisms (which are beyond the scope of this document) to avoid log resource exhaustion attacks. </t>
          <t indent="0" pn="section-6.9.1-8">The EID-Record with EID-Prefix 2001:db8:103::/48 is eligible to
          be used by the ITR because it matches the second EID-Prefix
          contained in the EID-AD.</t>
          <t indent="0" pn="section-6.9.1-9">The EID-Record with EID-Prefix 2001:db8:200::/40 is not eligible
          to be used by the ITR, since it is not included in any of the EID-ADs
          signed by the Map-Server. A log action <bcp14>MUST</bcp14> be taken and the EID-Record <bcp14>MUST</bcp14> be
 	   discarded. Implementations may include mechanisms (which are beyond the scope of this document) to avoid log resource exhaustion attacks. In this last example, the ETR is trying to over claim the EID-Prefix 2001:db8:200::/40, but the Map-Server authorized only
          2001:db8:203::/48; hence, the EID-Record is discarded.</t>
        </section>
      </section>
    </section>
    <section anchor="security" numbered="true" toc="include" removeInRFC="false" pn="section-7">
      <name slugifiedName="name-security-considerations">Security Considerations</name>
      <t indent="0" pn="section-7-1">This document extends the LISP control plane defined in <xref target="RFC9301" format="default" sectionFormat="of" derivedContent="RFC9301"/>; hence, its security considerations apply to this document  as well.
      </t>
      <section anchor="mapping-system" numbered="true" toc="include" removeInRFC="false" pn="section-7.1">
        <name slugifiedName="name-mapping-system-security">Mapping System Security</name>
        <t indent="0" pn="section-7.1-1">The LISP-SEC threat model described in <xref target="threat-model" format="default" sectionFormat="of" derivedContent="Section 4"/> assumes that the LISP Mapping System is
        working properly and delivers Map-Request messages to a
        Map-Server that is authoritative for the requested EID.</t>
        <t indent="0" pn="section-7.1-2">It is assumed that the Mapping System ensures the confidentiality
        of the OTK and the integrity of the Map-Reply data. However, how the
        LISP Mapping System is secured is out of the scope of this
        document.</t>
        <t indent="0" pn="section-7.1-3">Similarly, Map-Register security, including the right for a LISP
        entity to register an EID-Prefix or to claim presence at an RLOC, is
        out of the scope of LISP-SEC.</t>
      </section>
      <section anchor="random" numbered="true" toc="include" removeInRFC="false" pn="section-7.2">
        <name slugifiedName="name-random-number-generation">Random Number Generation</name>
        <t indent="0" pn="section-7.2-1">The ITR-OTK <bcp14>MUST</bcp14> be generated by a properly seeded pseudo-random
        (or strong random) source. See <xref target="RFC4086" format="default" sectionFormat="of" derivedContent="RFC4086"/> for advice on
        generating security-sensitive random data.</t>
      </section>
      <section anchor="colocation" numbered="true" toc="include" removeInRFC="false" pn="section-7.3">
        <name slugifiedName="name-map-server-and-etr-colocati">Map-Server and ETR Colocation</name>
        <t indent="0" pn="section-7.3-1">If the Map-Server and the ETR are colocated, LISP-SEC does not
        provide protection from overclaiming attacks mounted by the ETR.
        However, in this particular case, since the ETR is within the trust
        boundaries of the Map-Server, ETR's overclaiming attacks are not
        included in the threat model.</t>
      </section>
      <section anchor="deploying" numbered="true" toc="include" removeInRFC="false" pn="section-7.4">
        <name slugifiedName="name-deploying-lisp-sec">Deploying LISP-SEC</name>
        <t indent="0" pn="section-7.4-1">Those deploying LISP-SEC according to this memo should carefully
        weigh how the LISP-SEC threat model applies to their particular use
        case or deployment. If they decide to ignore a particular
        recommendation, they should make sure the risk associated with the corresponding threats is well understood.</t>
        <t indent="0" pn="section-7.4-2">As an example, in certain other
        deployments, attackers may be very sophisticated and force the
        deployers to enforce very strict policies in terms of HMAC algorithms
        accepted by an ITR.</t>
        <t indent="0" pn="section-7.4-3">Similar considerations apply to the entire LISP-SEC threat model
        and should guide the deployers and implementors whenever they
        encounter the key word <bcp14>SHOULD</bcp14> across this memo.</t>
      </section>
      <section anchor="provisioning" numbered="true" toc="include" removeInRFC="false" pn="section-7.5">
        <name slugifiedName="name-shared-keys-provisioning">Shared Keys Provisioning</name>
        <t indent="0" pn="section-7.5-1">Provisioning of the keys shared between ITR and
        Map-Resolver pairs as well as between ETR and Map-Server pairs should be performed via an orchestration infrastructure, and is out of the scope of this memo. It is recommended that both shared keys be refreshed at periodical intervals to address key aging or attackers gaining unauthorized access to the shared keys. Shared keys should be unpredictable random values.</t>
      </section>
      <section anchor="reply" numbered="true" toc="include" removeInRFC="false" pn="section-7.6">
        <name slugifiedName="name-replay-attacks">Replay Attacks</name>
        <t indent="0" pn="section-7.6-1">An attacker can capture a valid Map-Request and/or Map-Reply and
        replay it; however, once the ITR receives the original Map-Reply, the
        &lt;nonce,ITR-OTK&gt; pair stored at the ITR will be discarded.
           If a replayed Map-Reply arrives at the ITR, there is no &lt;nonce,ITR-OTK&gt;
   that matches the incoming Map-Reply and the replayed Map-Reply will be
   discarded.</t>
        <t indent="0" pn="section-7.6-2">In the case of a replayed Map-Request, the Map-Server, Map-Resolver, and
        ETR will have to do a LISP-SEC computation. This is equivalent, in terms of resources, to a valid LISP-SEC computation and, beyond a risk of DoS attack, an attacker does not obtain any additional effect, since the corresponding Map-Reply is discarded as previously explained.</t>
      </section>
      <section anchor="DTLS" numbered="true" toc="include" removeInRFC="false" pn="section-7.7">
        <name slugifiedName="name-message-privacy">Message Privacy</name>
        <t indent="0" pn="section-7.7-1">DTLS <xref target="RFC9147" format="default" sectionFormat="of" derivedContent="RFC9147"/> <bcp14>SHOULD</bcp14> be used (conforming to <xref target="RFC7525" format="default" sectionFormat="of" derivedContent="RFC7525"/>) to provide communication privacy and to prevent eavesdropping, tampering, or message forgery to the messages exchanged between the ITR, Map-Resolver, Map-Server, and ETR, unless the OTK is encrypted in another way, e.g., using a pre-shared secret.  DTLS has the responder be verified by the initiator, which enables an ITR to authenticate the Map-Resolver and the Map-Server to authenticate the responding ETR.</t>
      </section>
      <section anchor="dos" numbered="true" toc="include" removeInRFC="false" pn="section-7.8">
        <name slugifiedName="name-denial-of-service-and-distr">Denial-of-Service and Distributed Denial-of-Service Attacks</name>
        <t indent="0" pn="section-7.8-1">LISP-SEC mitigates the risks of DoS and DDoS attacks by protecting the integrity and
        authenticating the origin of the Map-Request/Map-Reply messages and
        by preventing malicious ETRs from overclaiming EID-Prefixes that could
        redirect traffic directed to a potentially large number of hosts.</t>
      </section>
    </section>
    <section anchor="IANA" numbered="true" toc="include" removeInRFC="false" pn="section-8">
      <name slugifiedName="name-iana-considerations">IANA Considerations</name>
      <t indent="0" pn="section-8-1">IANA has created the subregistries listed in the following sections in the "Locator/ID Separation Protocol (LISP) Parameters" registry.
      </t>
      <t indent="0" pn="section-8-2"> For all of the subregistries, new values are assigned according to the Specification Required policy defined in <xref target="RFC8126" format="default" sectionFormat="of" derivedContent="RFC8126"/>. Expert Review should assess the security properties of newly added functions so that encryption robustness remains strong. For instance, at the time of this writing, the use of SHA-256-based functions is considered to provide sufficient protection. Consultation with security experts may be needed.
      </t>
      <section anchor="ECM-AD-Type" numbered="true" toc="include" removeInRFC="false" pn="section-8.1">
        <name slugifiedName="name-ecm-ad-type-registry">ECM AD Type Registry</name>
        <t indent="0" pn="section-8.1-1">IANA has created the "LISP ECM Authentication Data Types"
        registry with values 0-255 for use in the ECM LISP-SEC extensions
        (see <xref target="ECM_extensions" format="default" sectionFormat="of" derivedContent="Section 6.1"/>). Initial allocations are shown in <xref target="tableEADT" format="default" sectionFormat="of" derivedContent="Table 2"/>.
        </t>
        <table anchor="tableEADT" align="center" pn="table-2">
          <name slugifiedName="name-lisp-ecm-authentication-dat">LISP ECM Authentication Data Types</name>
          <thead>
            <tr>
              <th align="left" colspan="1" rowspan="1">Name</th>
              <th align="center" colspan="1" rowspan="1">Number</th>
              <th align="left" colspan="1" rowspan="1">Defined in</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left" colspan="1" rowspan="1">Reserved</td>
              <td align="center" colspan="1" rowspan="1">0</td>
              <td align="left" colspan="1" rowspan="1">RFC 9303</td>
            </tr>
            <tr>
              <td align="left" colspan="1" rowspan="1">LISP-SEC-ECM-EXT</td>
              <td align="center" colspan="1" rowspan="1">1</td>
              <td align="left" colspan="1" rowspan="1">RFC 9303</td>
            </tr>
          </tbody>
        </table>
        <t indent="0" pn="section-8.1-3">Values 2-255 are unassigned. </t>
      </section>
      <section anchor="MR-AD-Type" numbered="true" toc="include" removeInRFC="false" pn="section-8.2">
        <name slugifiedName="name-map-reply-ad-types-registry">Map-Reply AD Types Registry</name>
        <t indent="0" pn="section-8.2-1">IANA has created the "LISP Map-Reply Authentication Data
        Types" registry with values 0-255 for use in the Map-Reply LISP-SEC
        extensions (see <xref target="MR_extensions" format="default" sectionFormat="of" derivedContent="Section 6.2"/>). Initial allocations are shown in <xref target="tableADT" format="default" sectionFormat="of" derivedContent="Table 3"/>.
        </t>
        <table anchor="tableADT" align="center" pn="table-3">
          <name slugifiedName="name-map-reply-authentication-da">Map-Reply Authentication Data Types</name>
          <thead>
            <tr>
              <th align="left" colspan="1" rowspan="1">Name</th>
              <th align="center" colspan="1" rowspan="1">Number</th>
              <th align="left" colspan="1" rowspan="1">Defined in</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left" colspan="1" rowspan="1">Reserved</td>
              <td align="center" colspan="1" rowspan="1">0</td>
              <td align="left" colspan="1" rowspan="1">RFC 9303</td>
            </tr>
            <tr>
              <td align="left" colspan="1" rowspan="1">LISP-SEC-MR-EXT</td>
              <td align="center" colspan="1" rowspan="1">1</td>
              <td align="left" colspan="1" rowspan="1">RFC 9303</td>
            </tr>
          </tbody>
        </table>
        <t indent="0" pn="section-8.2-3">Values 2-255 are unassigned. </t>
      </section>
      <section anchor="HMAC" numbered="true" toc="include" removeInRFC="false" pn="section-8.3">
        <name slugifiedName="name-hmac-functions">HMAC Functions</name>
        <t indent="0" pn="section-8.3-1">IANA is requested to create the "LISP-SEC Preferred Authentication Data HMAC IDs" registry with values 0-65535 for use as Requested HMAC IDs, EID HMAC IDs, and PKT HMAC IDs in the LISP-SEC Authentication Data. Initial allocations are shown in <xref target="tableHMACF" format="default" sectionFormat="of" derivedContent="Table 4"/>.
        </t>
        <table anchor="tableHMACF" align="center" pn="table-4">
          <name slugifiedName="name-lisp-sec-preferred-authenti">LISP-SEC Preferred Authentication Data HMAC IDs</name>
          <thead>
            <tr>
              <th align="left" colspan="1" rowspan="1">Name</th>
              <th align="center" colspan="1" rowspan="1">Number</th>
              <th align="left" colspan="1" rowspan="1">Defined in</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left" colspan="1" rowspan="1">NOPREF</td>
              <td align="center" colspan="1" rowspan="1">0</td>
              <td align="left" colspan="1" rowspan="1">RFC 9303</td>
            </tr>
            <tr>
              <td align="left" colspan="1" rowspan="1">AUTH-HMAC-SHA-1-96</td>
              <td align="center" colspan="1" rowspan="1">1</td>
              <td align="left" colspan="1" rowspan="1">
                <xref target="RFC2104" format="default" sectionFormat="of" derivedContent="RFC2104"/></td>
            </tr>
            <tr>
              <td align="left" colspan="1" rowspan="1">AUTH-HMAC-SHA-256-128</td>
              <td align="center" colspan="1" rowspan="1">2</td>
              <td align="left" colspan="1" rowspan="1">
                <xref target="RFC6234" format="default" sectionFormat="of" derivedContent="RFC6234"/></td>
            </tr>
          </tbody>
        </table>
        <t indent="0" pn="section-8.3-3">Values 3-65535 are unassigned.</t>
      </section>
      <section anchor="wrap" numbered="true" toc="include" removeInRFC="false" pn="section-8.4">
        <name slugifiedName="name-key-wrap-functions">Key Wrap Functions</name>
        <t indent="0" pn="section-8.4-1">IANA has created the "LISP-SEC Authentication Data Key
        Wrap IDs" registry with values 0-65535 for use as OTK key wrap
        algorithm IDs in the LISP-SEC Authentication Data. Initial allocations are shown in <xref target="tableKWF" format="default" sectionFormat="of" derivedContent="Table 5"/>.</t>
        <table anchor="tableKWF" align="center" pn="table-5">
          <name slugifiedName="name-lisp-sec-authentication-dat">LISP-SEC Authentication Data Key Wrap IDs</name>
          <thead>
            <tr>
              <th align="left" colspan="1" rowspan="1">Name</th>
              <th align="center" colspan="1" rowspan="1">Number</th>
              <th align="left" colspan="1" rowspan="1">Key Wrap</th>
              <th align="left" colspan="1" rowspan="1">KDF</th>
              <th align="left" colspan="1" rowspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left" colspan="1" rowspan="1">Reserved</td>
              <td align="center" colspan="1" rowspan="1">0</td>
              <td align="left" colspan="1" rowspan="1">None</td>
              <td align="left" colspan="1" rowspan="1">None</td>
              <td align="left" colspan="1" rowspan="1">RFC 9303</td>
            </tr>
            <tr>
              <td align="left" colspan="1" rowspan="1">NULL-KEY-WRAP-128</td>
              <td align="center" colspan="1" rowspan="1">1</td>
              <td align="left" colspan="1" rowspan="1">RFC 9303</td>
              <td align="left" colspan="1" rowspan="1">None</td>
              <td align="left" colspan="1" rowspan="1">RFC 9303</td>
            </tr>
            <tr>
              <td align="left" colspan="1" rowspan="1">AES-KEY-WRAP-128+HKDF-SHA256</td>
              <td align="center" colspan="1" rowspan="1">2</td>
              <td align="left" colspan="1" rowspan="1">
                <xref target="RFC3394" format="default" sectionFormat="of" derivedContent="RFC3394"/></td>
              <td align="left" colspan="1" rowspan="1">
                <xref target="RFC4868" format="default" sectionFormat="of" derivedContent="RFC4868"/></td>
              <td align="left" colspan="1" rowspan="1">RFC 9303</td>
            </tr>
          </tbody>
        </table>
        <t indent="0" pn="section-8.4-3">Values 3-65535 are unassigned. </t>
      </section>
      <section anchor="kdf" numbered="true" toc="include" removeInRFC="false" pn="section-8.5">
        <name slugifiedName="name-key-derivation-functions">Key Derivation Functions</name>
        <t indent="0" pn="section-8.5-1">IANA has created the "LISP-SEC Authentication Data Key
        Derivation Function IDs" registry with values 0-65535 for use as KDF IDs.
        Initial allocations are shown in <xref target="tableKDF" format="default" sectionFormat="of" derivedContent="Table 6"/>.</t>
        <table anchor="tableKDF" align="center" pn="table-6">
          <name slugifiedName="name-lisp-sec-authentication-data">LISP-SEC Authentication Data Key Derivation Function IDs</name>
          <thead>
            <tr>
              <th align="left" colspan="1" rowspan="1">Name</th>
              <th align="center" colspan="1" rowspan="1">Number</th>
              <th align="center" colspan="1" rowspan="1">Reference</th>
            </tr>
          </thead>
          <tbody>
            <tr>
              <td align="left" colspan="1" rowspan="1">NOPREF</td>
              <td align="center" colspan="1" rowspan="1">0</td>
              <td align="center" colspan="1" rowspan="1">RFC 9303</td>
            </tr>
            <tr>
              <td align="left" colspan="1" rowspan="1">HKDF-SHA1-128</td>
              <td align="center" colspan="1" rowspan="1">1</td>
              <td align="center" colspan="1" rowspan="1">
                <xref target="RFC5869" format="default" sectionFormat="of" derivedContent="RFC5869"/></td>
            </tr>
            <tr>
              <td align="left" colspan="1" rowspan="1">HKDF-SHA256</td>
              <td align="center" colspan="1" rowspan="1">2</td>
              <td align="center" colspan="1" rowspan="1">
                <xref target="RFC5869" format="default" sectionFormat="of" derivedContent="RFC5869"/></td>
            </tr>
          </tbody>
        </table>
        <t indent="0" pn="section-8.5-3">Values 3-65535 are unassigned. </t>
      </section>
    </section>
  </middle>
  <back>
    <references pn="section-9">
      <name slugifiedName="name-references">References</name>
      <references pn="section-9.1">
        <name slugifiedName="name-normative-references">Normative References</name>
        <reference anchor="RFC2104" target="https://www.rfc-editor.org/info/rfc2104" quoteTitle="true" derivedAnchor="RFC2104">
          <front>
            <title>HMAC: Keyed-Hashing for Message Authentication</title>
            <author fullname="H. Krawczyk" initials="H." surname="Krawczyk"/>
            <author fullname="M. Bellare" initials="M." surname="Bellare"/>
            <author fullname="R. Canetti" initials="R." surname="Canetti"/>
            <date month="February" year="1997"/>
            <abstract>
              <t indent="0">This document describes HMAC, a mechanism for message authentication using cryptographic hash functions.  HMAC can be used with any iterative cryptographic hash function, e.g., MD5, SHA-1, in combination with a secret shared key.  The cryptographic strength of HMAC depends on the properties of the underlying hash function.  This memo provides information for the Internet community.  This memo does not specify an Internet standard of any kind</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="2104"/>
          <seriesInfo name="DOI" value="10.17487/RFC2104"/>
        </reference>
        <reference anchor="RFC2119" target="https://www.rfc-editor.org/info/rfc2119" quoteTitle="true" derivedAnchor="RFC2119">
          <front>
            <title>Key words for use in RFCs to Indicate Requirement Levels</title>
            <author fullname="S. Bradner" initials="S." surname="Bradner"/>
            <date month="March" year="1997"/>
            <abstract>
              <t indent="0">In many standards track documents several words are used to signify the requirements in the specification.  These words are often capitalized.  This document defines these words as they should be interpreted in IETF documents.  This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="14"/>
          <seriesInfo name="RFC" value="2119"/>
          <seriesInfo name="DOI" value="10.17487/RFC2119"/>
        </reference>
        <reference anchor="RFC3394" target="https://www.rfc-editor.org/info/rfc3394" quoteTitle="true" derivedAnchor="RFC3394">
          <front>
            <title>Advanced Encryption Standard (AES) Key Wrap Algorithm</title>
            <author fullname="J. Schaad" initials="J." surname="Schaad"/>
            <author fullname="R. Housley" initials="R." surname="Housley"/>
            <date month="September" year="2002"/>
          </front>
          <seriesInfo name="RFC" value="3394"/>
          <seriesInfo name="DOI" value="10.17487/RFC3394"/>
        </reference>
        <reference anchor="RFC4868" target="https://www.rfc-editor.org/info/rfc4868" quoteTitle="true" derivedAnchor="RFC4868">
          <front>
            <title>Using HMAC-SHA-256, HMAC-SHA-384, and HMAC-SHA-512 with IPsec</title>
            <author fullname="S. Kelly" initials="S." surname="Kelly"/>
            <author fullname="S. Frankel" initials="S." surname="Frankel"/>
            <date month="May" year="2007"/>
            <abstract>
              <t indent="0">This specification describes the use of Hashed Message Authentication Mode (HMAC) in conjunction with the SHA-256, SHA-384, and SHA-512 algorithms in IPsec.  These algorithms may be used as the basis for data origin authentication and integrity verification mechanisms for the Authentication Header (AH), Encapsulating Security Payload (ESP), Internet Key Exchange Protocol (IKE), and IKEv2 protocols, and also as Pseudo-Random Functions (PRFs) for IKE and IKEv2.  Truncated output lengths are specified for the authentication-related variants, with the corresponding algorithms designated as HMAC-SHA-256-128, HMAC-SHA-384-192, and HMAC-SHA-512-256.  The PRF variants are not truncated, and are called PRF-HMAC-SHA-256, PRF-HMAC-SHA-384, and PRF-HMAC-SHA-512. [STANDARDS-TRACK]</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="4868"/>
          <seriesInfo name="DOI" value="10.17487/RFC4868"/>
        </reference>
        <reference anchor="RFC5869" target="https://www.rfc-editor.org/info/rfc5869" quoteTitle="true" derivedAnchor="RFC5869">
          <front>
            <title>HMAC-based Extract-and-Expand Key Derivation Function (HKDF)</title>
            <author fullname="H. Krawczyk" initials="H." surname="Krawczyk"/>
            <author fullname="P. Eronen" initials="P." surname="Eronen"/>
            <date month="May" year="2010"/>
            <abstract>
              <t indent="0">This document specifies a simple Hashed Message Authentication Code (HMAC)-based key derivation function (HKDF), which can be used as a building block in various protocols and applications.  The key derivation function (KDF) is intended to support a wide range of applications and requirements, and is conservative in its use of cryptographic hash functions.  This document is not an Internet Standards Track specification; it is published for informational purposes.</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="5869"/>
          <seriesInfo name="DOI" value="10.17487/RFC5869"/>
        </reference>
        <reference anchor="RFC6234" target="https://www.rfc-editor.org/info/rfc6234" quoteTitle="true" derivedAnchor="RFC6234">
          <front>
            <title>US Secure Hash Algorithms (SHA and SHA-based HMAC and HKDF)</title>
            <author fullname="D. Eastlake 3rd" initials="D." surname="Eastlake 3rd"/>
            <author fullname="T. Hansen" initials="T." surname="Hansen"/>
            <date month="May" year="2011"/>
            <abstract>
              <t indent="0">Federal Information Processing Standard, FIPS</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="6234"/>
          <seriesInfo name="DOI" value="10.17487/RFC6234"/>
        </reference>
        <reference anchor="RFC7525" target="https://www.rfc-editor.org/info/rfc7525" quoteTitle="true" derivedAnchor="RFC7525">
          <front>
            <title>Recommendations for Secure Use of Transport Layer Security (TLS) and Datagram Transport Layer Security (DTLS)</title>
            <author fullname="Y. Sheffer" initials="Y." surname="Sheffer"/>
            <author fullname="R. Holz" initials="R." surname="Holz"/>
            <author fullname="P. Saint-Andre" initials="P." surname="Saint-Andre"/>
            <date month="May" year="2015"/>
            <abstract>
              <t indent="0">Transport Layer Security (TLS) and Datagram Transport Layer Security (DTLS) are widely used to protect data exchanged over application protocols such as HTTP, SMTP, IMAP, POP, SIP, and XMPP.  Over the last few years, several serious attacks on TLS have emerged, including attacks on its most commonly used cipher suites and their modes of operation.  This document provides recommendations for improving the security of deployed services that use TLS and DTLS.  The recommendations are applicable to the majority of use cases.</t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="195"/>
          <seriesInfo name="RFC" value="7525"/>
          <seriesInfo name="DOI" value="10.17487/RFC7525"/>
        </reference>
        <reference anchor="RFC7835" target="https://www.rfc-editor.org/info/rfc7835" quoteTitle="true" derivedAnchor="RFC7835">
          <front>
            <title>Locator/ID Separation Protocol (LISP) Threat Analysis</title>
            <author fullname="D. Saucez" initials="D." surname="Saucez"/>
            <author fullname="L. Iannone" initials="L." surname="Iannone"/>
            <author fullname="O. Bonaventure" initials="O." surname="Bonaventure"/>
            <date month="April" year="2016"/>
            <abstract>
              <t indent="0">This document provides a threat analysis of the Locator/ID Separation Protocol (LISP).</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="7835"/>
          <seriesInfo name="DOI" value="10.17487/RFC7835"/>
        </reference>
        <reference anchor="RFC8126" target="https://www.rfc-editor.org/info/rfc8126" quoteTitle="true" derivedAnchor="RFC8126">
          <front>
            <title>Guidelines for Writing an IANA Considerations Section in RFCs</title>
            <author fullname="M. Cotton" initials="M." surname="Cotton"/>
            <author fullname="B. Leiba" initials="B." surname="Leiba"/>
            <author fullname="T. Narten" initials="T." surname="Narten"/>
            <date month="June" year="2017"/>
            <abstract>
              <t indent="0">Many protocols make use of points of extensibility that use constants to identify various protocol parameters. To ensure that the values in these fields do not have conflicting uses and to promote interoperability, their allocations are often coordinated by a central record keeper. For IETF protocols, that role is filled by the Internet Assigned Numbers Authority (IANA).</t>
              <t indent="0">To make assignments in a given registry prudently, guidance describing the conditions under which new values should be assigned, as well as when and how modifications to existing values can be made, is needed. This document defines a framework for the documentation of these guidelines by specification authors, in order to assure that the provided guidance for the IANA Considerations is clear and addresses the various issues that are likely in the operation of a registry.</t>
              <t indent="0">This is the third edition of this document; it obsoletes RFC 5226.</t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="26"/>
          <seriesInfo name="RFC" value="8126"/>
          <seriesInfo name="DOI" value="10.17487/RFC8126"/>
        </reference>
        <reference anchor="RFC8174" target="https://www.rfc-editor.org/info/rfc8174" quoteTitle="true" derivedAnchor="RFC8174">
          <front>
            <title>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</title>
            <author fullname="B. Leiba" initials="B." surname="Leiba"/>
            <date month="May" year="2017"/>
            <abstract>
              <t indent="0">RFC 2119 specifies common key words that may be used in protocol specifications.  This document aims to reduce the ambiguity by clarifying that only UPPERCASE usage of the key words have the defined special meanings.</t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="14"/>
          <seriesInfo name="RFC" value="8174"/>
          <seriesInfo name="DOI" value="10.17487/RFC8174"/>
        </reference>
        <reference anchor="RFC9147" target="https://www.rfc-editor.org/info/rfc9147" quoteTitle="true" derivedAnchor="RFC9147">
          <front>
            <title>The Datagram Transport Layer Security (DTLS) Protocol Version 1.3</title>
            <author fullname="E. Rescorla" initials="E." surname="Rescorla"/>
            <author fullname="H. Tschofenig" initials="H." surname="Tschofenig"/>
            <author fullname="N. Modadugu" initials="N." surname="Modadugu"/>
            <date month="April" year="2022"/>
            <abstract>
              <t indent="0">This document specifies version 1.3 of the Datagram Transport Layer Security (DTLS) protocol. DTLS 1.3 allows client/server applications to communicate over the Internet in a way that is designed to prevent eavesdropping, tampering, and message forgery.</t>
              <t indent="0">The DTLS 1.3 protocol is based on the Transport Layer Security (TLS) 1.3 protocol and provides equivalent security guarantees with the exception of order protection / non-replayability. Datagram semantics of the underlying transport are preserved by the DTLS protocol.</t>
              <t indent="0">This document obsoletes RFC 6347.</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="9147"/>
          <seriesInfo name="DOI" value="10.17487/RFC9147"/>
        </reference>
        <reference anchor="RFC9300" target="https://www.rfc-editor.org/info/rfc9300" quoteTitle="true" derivedAnchor="RFC9300">
          <front>
            <title>The Locator/ID Separation Protocol (LISP)</title>
            <author initials="D" surname="Farinacci" fullname="Dino Farinacci">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="V" surname="Fuller" fullname="Vince Fuller">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="D" surname="Meyer" fullname="David Meyer">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="D" surname="Lewis" fullname="Darrel Lewis">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="A" surname="Cabellos" fullname="Albert Cabellos" role="editor">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2022" month="October"/>
          </front>
          <seriesInfo name="RFC" value="9300"/>
          <seriesInfo name="DOI" value="10.17487/RFC9300"/>
        </reference>
        <reference anchor="RFC9301" target="https://www.rfc-editor.org/info/rfc9301" quoteTitle="true" derivedAnchor="RFC9301">
          <front>
            <title>Locator/ID Separation Protocol (LISP) Control Plane</title>
            <author initials="D" surname="Farinacci" fullname="Dino Farinacci">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="F" surname="Maino" fullname="Fabio Maino">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="V" surname="Fuller" fullname="Vince Fuller">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="A" surname="Cabellos" fullname="Albert Cabellos" role="editor">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2022" month="October"/>
          </front>
          <seriesInfo name="RFC" value="9301"/>
          <seriesInfo name="DOI" value="10.17487/RFC9301"/>
        </reference>
      </references>
      <references pn="section-9.2">
        <name slugifiedName="name-informative-references">Informative References</name>
        <reference anchor="RFC4086" target="https://www.rfc-editor.org/info/rfc4086" quoteTitle="true" derivedAnchor="RFC4086">
          <front>
            <title>Randomness Requirements for Security</title>
            <author fullname="D. Eastlake 3rd" initials="D." surname="Eastlake 3rd"/>
            <author fullname="J. Schiller" initials="J." surname="Schiller"/>
            <author fullname="S. Crocker" initials="S." surname="Crocker"/>
            <date month="June" year="2005"/>
            <abstract>
              <t indent="0">Security systems are built on strong cryptographic algorithms that foil pattern analysis attempts. However, the security of these systems is dependent on generating secret quantities for passwords, cryptographic keys, and similar quantities. The use of pseudo-random processes to generate secret quantities can result in pseudo-security. A sophisticated attacker may find it easier to reproduce the environment that produced the secret quantities and to search the resulting small set of possibilities than to locate the quantities in the whole of the potential number space.</t>
              <t indent="0">Choosing random quantities to foil a resourceful and motivated adversary is surprisingly difficult. This document points out many pitfalls in using poor entropy sources or traditional pseudo-random number generation techniques for generating such quantities. It recommends the use of truly random hardware techniques and shows that the existing hardware on many systems can be used for this purpose. It provides suggestions to ameliorate the problem when a hardware solution is not available, and it gives examples of how large such quantities need to be for some applications. This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="106"/>
          <seriesInfo name="RFC" value="4086"/>
          <seriesInfo name="DOI" value="10.17487/RFC4086"/>
        </reference>
        <reference anchor="RFC6836" target="https://www.rfc-editor.org/info/rfc6836" quoteTitle="true" derivedAnchor="RFC6836">
          <front>
            <title>Locator/ID Separation Protocol Alternative Logical Topology (LISP+ALT)</title>
            <author fullname="V. Fuller" initials="V." surname="Fuller"/>
            <author fullname="D. Farinacci" initials="D." surname="Farinacci"/>
            <author fullname="D. Meyer" initials="D." surname="Meyer"/>
            <author fullname="D. Lewis" initials="D." surname="Lewis"/>
            <date month="January" year="2013"/>
            <abstract>
              <t indent="0">This document describes a simple distributed index system to be used by a Locator/ID Separation Protocol (LISP) Ingress Tunnel Router (ITR) or Map-Resolver (MR) to find the Egress Tunnel Router (ETR) that holds the mapping information for a particular Endpoint Identifier (EID).  The MR can then query that ETR to obtain the actual mapping information, which consists of a list of Routing Locators (RLOCs) for the EID.  Termed the Alternative Logical Topology (ALT), the index is built as an overlay network on the public Internet using the Border Gateway Protocol (BGP) and Generic Routing Encapsulation (GRE).  This document defines an Experimental Protocol for the Internet community.</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="6836"/>
          <seriesInfo name="DOI" value="10.17487/RFC6836"/>
        </reference>
      </references>
    </references>
    <section anchor="Acknowledgments" numbered="false" toc="include" removeInRFC="false" pn="section-appendix.a">
      <name slugifiedName="name-acknowledgments">Acknowledgments</name>
      <t indent="0" pn="section-appendix.a-1">The authors would like to acknowledge <contact fullname="Luigi Iannone"/>, <contact fullname="Pere Monclus"/>, <contact fullname="Dave Meyer"/>, <contact fullname="Dino Farinacci"/>, <contact fullname="Brian Weis"/>, <contact fullname="David McGrew"/>, <contact fullname="Darrel Lewis"/>, and <contact fullname="Landon Curt Noll"/> for their valuable suggestions provided during the preparation of this document.</t>
    </section>
    <section anchor="authors-addresses" numbered="false" removeInRFC="false" toc="include" pn="section-appendix.b">
      <name slugifiedName="name-authors-addresses">Authors' Addresses</name>
      <author fullname="Fabio Maino" initials="F" surname="Maino">
        <organization showOnFrontPage="true">Cisco Systems</organization>
        <address>
          <postal>
            <street/>
            <city>San Jose</city>
            <code/>
            <region>CA</region>
            <country>United States of America</country>
          </postal>
          <email>fmaino@cisco.com</email>
        </address>
      </author>
      <author fullname="Vina Ermagan" initials="V" surname="Ermagan">
        <organization showOnFrontPage="true">Google, Inc.</organization>
        <address>
          <postal>
            <street>1600 Amphitheatre Parkway</street>
            <city>Mountain View</city>
            <region>CA</region>
            <code>94043</code>
            <country>United States of America</country>
          </postal>
          <email>ermagan@gmail.com</email>
        </address>
      </author>
      <author fullname="Albert Cabellos" initials="A" surname="Cabellos">
        <organization showOnFrontPage="true">Universitat Politecnica de Catalunya</organization>
        <address>
          <postal>
            <street>c/ Jordi Girona s/n</street>
            <city>Barcelona</city>
            <code>08034</code>
            <region/>
            <country>Spain</country>
          </postal>
          <email>acabello@ac.upc.edu</email>
        </address>
      </author>
      <author fullname="Damien Saucez" initials="D" surname="Saucez">
        <organization showOnFrontPage="true">Inria</organization>
        <address>
          <postal>
            <street>2004 route des Lucioles - BP 93</street>
            <city>Sophia Antipolis</city>
            <code/>
            <region/>
            <country>France</country>
          </postal>
          <email>damien.saucez@inria.fr</email>
        </address>
      </author>
    </section>
  </back>
</rfc>
