<?xml version='1.0' encoding='utf-8'?>
<rfc xmlns:xi="http://www.w3.org/2001/XInclude" version="3" category="info" consensus="true" docName="draft-ietf-bfd-vxlan-16" indexInclude="true" ipr="trust200902" number="8971" prepTime="2020-12-14T07:36:39" scripts="Common,Latin" sortRefs="true" submissionType="IETF" symRefs="true" tocDepth="4" tocInclude="true" xml:lang="en">
  <link href="https://datatracker.ietf.org/doc/draft-ietf-bfd-vxlan-16" rel="prev"/>
  <link href="https://dx.doi.org/10.17487/rfc8971" rel="alternate"/>
  <link href="urn:issn:2070-1721" rel="alternate"/>
  <front>
    <title abbrev="BFD for VXLAN">Bidirectional Forwarding Detection (BFD) for Virtual eXtensible Local Area Network (VXLAN)</title>
    <seriesInfo name="RFC" value="8971" stream="IETF"/>
    <author fullname="Santosh Pallagatti" role="editor" initials="S." surname="Pallagatti">
      <organization showOnFrontPage="true">VMware</organization>
      <address>
        <email>santosh.pallagatti@gmail.com</email>
      </address>
    </author>
    <author fullname="Greg Mirsky" role="editor" initials="G." surname="Mirsky">
      <organization showOnFrontPage="true">ZTE Corp.</organization>
      <address>
        <email>gregimirsky@gmail.com</email>
      </address>
    </author>
    <author fullname="Sudarsan Paragiri" initials="S." surname="Paragiri">
      <organization showOnFrontPage="true">Individual Contributor</organization>
      <address>
        <email>sudarsan.225@gmail.com</email>
      </address>
    </author>
    <author fullname="Vengada Prasad Govindan" initials="V." surname="Govindan">
      <organization showOnFrontPage="true">Cisco</organization>
      <address>
        <email>venggovi@cisco.com</email>
      </address>
    </author>
    <author fullname="Mallik Mudigonda" initials="M." surname="Mudigonda">
      <organization showOnFrontPage="true">Cisco</organization>
      <address>
        <email>mmudigon@cisco.com</email>
      </address>
    </author>
    <date month="12" year="2020"/>
    <area>Routing</area>
    <workgroup>BFD</workgroup>
    <keyword>BFD</keyword>
    <keyword>BFD for VXLAN</keyword>
    <abstract pn="section-abstract">
      <t indent="0" pn="section-abstract-1">This document describes the use of the Bidirectional Forwarding Detection (BFD) protocol
        in point-to-point Virtual eXtensible Local Area Network (VXLAN) tunnels
        used to form an overlay network.</t>
    </abstract>
    <boilerplate>
      <section anchor="status-of-memo" numbered="false" removeInRFC="false" toc="exclude" pn="section-boilerplate.1">
        <name slugifiedName="name-status-of-this-memo">Status of This Memo</name>
        <t indent="0" pn="section-boilerplate.1-1">
            This document is not an Internet Standards Track specification; it is
            published for informational purposes.  
        </t>
        <t indent="0" pn="section-boilerplate.1-2">
            This document is a product of the Internet Engineering Task Force
            (IETF).  It represents the consensus of the IETF community.  It has
            received public review and has been approved for publication by the
            Internet Engineering Steering Group (IESG).  Not all documents
            approved by the IESG are candidates for any level of Internet
            Standard; see Section 2 of RFC 7841. 
        </t>
        <t indent="0" pn="section-boilerplate.1-3">
            Information about the current status of this document, any
            errata, and how to provide feedback on it may be obtained at
            <eref target="https://www.rfc-editor.org/info/rfc8971" brackets="none"/>.
        </t>
      </section>
      <section anchor="copyright" numbered="false" removeInRFC="false" toc="exclude" pn="section-boilerplate.2">
        <name slugifiedName="name-copyright-notice">Copyright Notice</name>
        <t indent="0" pn="section-boilerplate.2-1">
            Copyright (c) 2020 IETF Trust and the persons identified as the
            document authors. All rights reserved.
        </t>
        <t indent="0" pn="section-boilerplate.2-2">
            This document is subject to BCP 78 and the IETF Trust's Legal
            Provisions Relating to IETF Documents
            (<eref target="https://trustee.ietf.org/license-info" brackets="none"/>) in effect on the date of
            publication of this document. Please review these documents
            carefully, as they describe your rights and restrictions with
            respect to this document. Code Components extracted from this
            document must include Simplified BSD License text as described in
            Section 4.e of the Trust Legal Provisions and are provided without
            warranty as described in the Simplified BSD License.
        </t>
      </section>
    </boilerplate>
    <toc>
      <section anchor="toc" numbered="false" removeInRFC="false" toc="exclude" pn="section-toc.1">
        <name slugifiedName="name-table-of-contents">Table of Contents</name>
        <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1">
          <li pn="section-toc.1-1.1">
            <t indent="0" keepWithNext="true" pn="section-toc.1-1.1.1"><xref derivedContent="1" format="counter" sectionFormat="of" target="section-1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-introduction">Introduction</xref></t>
          </li>
          <li pn="section-toc.1-1.2">
            <t indent="0" pn="section-toc.1-1.2.1"><xref derivedContent="2" format="counter" sectionFormat="of" target="section-2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-conventions-used-in-this-do">Conventions Used in This Document</xref></t>
            <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.2.2">
              <li pn="section-toc.1-1.2.2.1">
                <t indent="0" keepWithNext="true" pn="section-toc.1-1.2.2.1.1"><xref derivedContent="2.1" format="counter" sectionFormat="of" target="section-2.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-abbreviations">Abbreviations</xref></t>
              </li>
              <li pn="section-toc.1-1.2.2.2">
                <t indent="0" keepWithNext="true" pn="section-toc.1-1.2.2.2.1"><xref derivedContent="2.2" format="counter" sectionFormat="of" target="section-2.2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-requirements-language">Requirements Language</xref></t>
              </li>
            </ul>
          </li>
          <li pn="section-toc.1-1.3">
            <t indent="0" pn="section-toc.1-1.3.1"><xref derivedContent="3" format="counter" sectionFormat="of" target="section-3"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-deployment">Deployment</xref></t>
          </li>
          <li pn="section-toc.1-1.4">
            <t indent="0" pn="section-toc.1-1.4.1"><xref derivedContent="4" format="counter" sectionFormat="of" target="section-4"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-use-of-the-management-vni">Use of the Management VNI</xref></t>
          </li>
          <li pn="section-toc.1-1.5">
            <t indent="0" pn="section-toc.1-1.5.1"><xref derivedContent="5" format="counter" sectionFormat="of" target="section-5"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-bfd-packet-transmission-ove">BFD Packet Transmission over VXLAN Tunnel</xref></t>
          </li>
          <li pn="section-toc.1-1.6">
            <t indent="0" pn="section-toc.1-1.6.1"><xref derivedContent="6" format="counter" sectionFormat="of" target="section-6"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-reception-of-bfd-packet-fro">Reception of BFD Packet from VXLAN Tunnel</xref></t>
          </li>
          <li pn="section-toc.1-1.7">
            <t indent="0" pn="section-toc.1-1.7.1"><xref derivedContent="7" format="counter" sectionFormat="of" target="section-7"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-echo-bfd">Echo BFD</xref></t>
          </li>
          <li pn="section-toc.1-1.8">
            <t indent="0" pn="section-toc.1-1.8.1"><xref derivedContent="8" format="counter" sectionFormat="of" target="section-8"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-iana-considerations">IANA Considerations</xref></t>
          </li>
          <li pn="section-toc.1-1.9">
            <t indent="0" pn="section-toc.1-1.9.1"><xref derivedContent="9" format="counter" sectionFormat="of" target="section-9"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-security-considerations">Security Considerations</xref></t>
          </li>
          <li pn="section-toc.1-1.10">
            <t indent="0" pn="section-toc.1-1.10.1"><xref derivedContent="10" format="counter" sectionFormat="of" target="section-10"/>. <xref derivedContent="" format="title" sectionFormat="of" target="name-references">References</xref></t>
            <ul bare="true" empty="true" indent="2" spacing="compact" pn="section-toc.1-1.10.2">
              <li pn="section-toc.1-1.10.2.1">
                <t indent="0" pn="section-toc.1-1.10.2.1.1"><xref derivedContent="10.1" format="counter" sectionFormat="of" target="section-10.1"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-normative-references">Normative References</xref></t>
              </li>
              <li pn="section-toc.1-1.10.2.2">
                <t indent="0" pn="section-toc.1-1.10.2.2.1"><xref derivedContent="10.2" format="counter" sectionFormat="of" target="section-10.2"/>.  <xref derivedContent="" format="title" sectionFormat="of" target="name-informative-references">Informative References</xref></t>
              </li>
            </ul>
          </li>
          <li pn="section-toc.1-1.11">
            <t indent="0" pn="section-toc.1-1.11.1"><xref derivedContent="" format="none" sectionFormat="of" target="section-appendix.a"/><xref derivedContent="" format="title" sectionFormat="of" target="name-acknowledgments">Acknowledgments</xref></t>
          </li>
          <li pn="section-toc.1-1.12">
            <t indent="0" pn="section-toc.1-1.12.1"><xref derivedContent="" format="none" sectionFormat="of" target="section-appendix.b"/><xref derivedContent="" format="title" sectionFormat="of" target="name-contributors">Contributors</xref></t>
          </li>
          <li pn="section-toc.1-1.13">
            <t indent="0" pn="section-toc.1-1.13.1"><xref derivedContent="" format="none" sectionFormat="of" target="section-appendix.c"/><xref derivedContent="" format="title" sectionFormat="of" target="name-authors-addresses">Authors' Addresses</xref></t>
          </li>
        </ul>
      </section>
    </toc>
  </front>
  <middle>
    <section anchor="Intro" numbered="true" toc="include" removeInRFC="false" pn="section-1">
      <name slugifiedName="name-introduction">Introduction</name>
      <t indent="0" pn="section-1-1">
    "Virtual eXtensible Local Area Network (VXLAN)" <xref target="RFC7348" format="default" sectionFormat="of" derivedContent="RFC7348"/> provides
   an encapsulation scheme that allows the building of an overlay network by 
  decoupling the address space of the attached virtual hosts from that of the network.
      </t>
      <t indent="0" pn="section-1-2">
One use of VXLAN is in data centers interconnecting virtual machines (VMs)
of a tenant. VXLAN addresses the requirements of the Layer 2 and 
Layer 3 data-center network infrastructure in the presence of VMs in a multi-tenant environment by
 providing a Layer 2 overlay scheme on a Layer 3 network <xref target="RFC7348" format="default" sectionFormat="of" derivedContent="RFC7348"/>.
 Another use is as an encapsulation for Ethernet VPN <xref target="RFC8365" format="default" sectionFormat="of" derivedContent="RFC8365"/>.
      </t>
      <t indent="0" pn="section-1-3">
 This document is written assuming the use of VXLAN for virtualized
hosts and refers to VMs and VXLAN Tunnel End Points (VTEPs) in hypervisors.  However, the
concepts are equally applicable to non-virtualized hosts attached to
VTEPs in switches.
</t>
      <t indent="0" pn="section-1-4">In the absence of a router in the overlay, a VM can communicate with another VM only if they are on the same VXLAN segment.
        VMs are unaware of VXLAN tunnels, because a VXLAN tunnel is terminated on a VTEP.
        VTEPs are responsible for encapsulating and decapsulating frames exchanged among
        VMs. </t>
      <t indent="0" pn="section-1-5">
    The ability to monitor path continuity -- i.e., perform proactive
    continuity check (CC) for point-to-point (p2p) VXLAN tunnels -- is
    important. 
       The asynchronous mode of BFD, as defined in <xref target="RFC5880" format="default" sectionFormat="of" derivedContent="RFC5880"/>, is used to monitor a p2p VXLAN tunnel. 
</t>
      <t indent="0" pn="section-1-6">
	In the case where a Multicast Service Node (MSN) (as described in
	<xref target="RFC8293" sectionFormat="of" section="3.3" format="default" derivedLink="https://rfc-editor.org/rfc/rfc8293#section-3.3" derivedContent="RFC8293"/>) participates in VXLAN, the
	mechanisms described in this 
	document apply and can, therefore, be used to test the continuity of the path between 
	the source Network Virtualization Endpoint (NVE) and the MSN.
      </t>
      <t indent="0" pn="section-1-7">
    This document describes the use of the Bidirectional Forwarding Detection (BFD) protocol
        to enable monitoring continuity of the path between VXLAN VTEPs that are
        performing as VNEs,
        and/or between the source NVE and a replicator MSN using a Management
	VXLAN Network Identifier (VNI) (<xref target="management-vni-sec" format="default" sectionFormat="of" derivedContent="Section 4"/>).
        All other uses of the specification to test toward other VXLAN endpoints are out of scope.
      </t>
    </section>
    <section numbered="true" toc="include" removeInRFC="false" pn="section-2">
      <name slugifiedName="name-conventions-used-in-this-do">Conventions Used in This Document</name>
      <section numbered="true" toc="include" removeInRFC="false" pn="section-2.1">
        <name slugifiedName="name-abbreviations">Abbreviations</name>
        <dl indent="9" newline="false" spacing="normal" pn="section-2.1-1">
          <dt pn="section-2.1-1.1">BFD:</dt>
          <dd pn="section-2.1-1.2">Bidirectional Forwarding Detection</dd>
          <dt pn="section-2.1-1.3">CC:</dt>
          <dd pn="section-2.1-1.4">Continuity Check</dd>
          <dt pn="section-2.1-1.5">FCS:</dt>
          <dd pn="section-2.1-1.6">Frame Check Sequence</dd>
          <dt pn="section-2.1-1.7">MSN:</dt>
          <dd pn="section-2.1-1.8">Multicast Service Node</dd>
          <dt pn="section-2.1-1.9">NVE:</dt>
          <dd pn="section-2.1-1.10">Network Virtualization Endpoint</dd>
          <dt pn="section-2.1-1.11">p2p:</dt>
          <dd pn="section-2.1-1.12">Point-to-point</dd>
          <dt pn="section-2.1-1.13">VFI:</dt>
          <dd pn="section-2.1-1.14">Virtual Forwarding Instance</dd>
          <dt pn="section-2.1-1.15">VM:</dt>
          <dd pn="section-2.1-1.16">Virtual Machine</dd>
          <dt pn="section-2.1-1.17">VNI:</dt>
          <dd pn="section-2.1-1.18">VXLAN Network Identifier (or VXLAN Segment ID)</dd>
          <dt pn="section-2.1-1.19">VTEP:</dt>
          <dd pn="section-2.1-1.20">VXLAN Tunnel End Point</dd>
          <dt pn="section-2.1-1.21">VXLAN:</dt>
          <dd pn="section-2.1-1.22">Virtual eXtensible Local Area Network</dd>
        </dl>
      </section>
      <section numbered="true" toc="include" removeInRFC="false" pn="section-2.2">
        <name slugifiedName="name-requirements-language">Requirements Language</name>
        <t indent="0" pn="section-2.2-1">
    The key words "<bcp14>MUST</bcp14>", "<bcp14>MUST NOT</bcp14>", "<bcp14>REQUIRED</bcp14>", "<bcp14>SHALL</bcp14>", "<bcp14>SHALL NOT</bcp14>", "<bcp14>SHOULD</bcp14>", "<bcp14>SHOULD NOT</bcp14>", "<bcp14>RECOMMENDED</bcp14>", "<bcp14>NOT RECOMMENDED</bcp14>",
    "<bcp14>MAY</bcp14>", and "<bcp14>OPTIONAL</bcp14>" in this document are to be interpreted as
    described in BCP 14 <xref target="RFC2119" format="default" sectionFormat="of" derivedContent="RFC2119"/> <xref target="RFC8174" format="default" sectionFormat="of" derivedContent="RFC8174"/> 
    when, and only when, they appear in all capitals, as shown here.
        </t>
      </section>
    </section>
    <section numbered="true" toc="include" removeInRFC="false" pn="section-3">
      <name slugifiedName="name-deployment">Deployment</name>
      <t indent="0" pn="section-3-1">
    <xref target="ref-vxlan-fig" format="default" sectionFormat="of" derivedContent="Figure 1"/> illustrates a scenario with two servers: each hosting two VMs. 
       The servers host VTEPs that terminate two VXLAN tunnels with VNI number 100
       and 200, respectively. Separate BFD sessions can be
       established between the VTEPs (IP1 and IP2) for monitoring
       each of the VXLAN tunnels (VNI 100 and 200). Using a BFD session to monitor a set of VXLAN VNIs
       between the same pair of VTEPs might help to detect and localize problems caused by misconfiguration.
An implementation that supports this specification <bcp14>MUST</bcp14>
be able to control the number of BFD sessions 
			that can be created between the same pair of VTEPs.
       This method is applicable whether  the VTEP is a virtual or physical device.
      </t>
      <t keepWithNext="true" indent="0" pn="section-3-2"/>
      <figure anchor="ref-vxlan-fig" align="left" suppress-title="false" pn="figure-1">
        <name slugifiedName="name-reference-vxlan-domain">Reference VXLAN Domain</name>
        <artwork align="left" name="" type="" alt="" pn="section-3-3.1">
                     
   +------------+-------------+
   |        Server 1          |
   | +----+----+  +----+----+ |
   | |VM1-1    |  |VM1-2    | |
   | |VNI 100  |  |VNI 200  | |
   | |         |  |         | |
   | +---------+  +---------+ |
   |        VTEP (IP1)        |
   +--------------------------+
                         |
                         |   +-------------+
                         |   |   Layer 3   |
                         +---|   Network   |
                             +-------------+
                                 |
                                 +-----------+
                                             |
                                      +------------+-------------+
                                      |         VTEP (IP2)       |
                                      | +----+----+  +----+----+ |
                                      | |VM2-1    |  |VM2-2    | |
                                      | |VNI 100  |  |VNI 200  | |
                                      | |         |  |         | |
                                      | +---------+  +---------+ |
                                      |      Server 2            |
                                      +--------------------------+
  
 </artwork>
      </figure>
      <t indent="0" pn="section-3-4">
       At the same time, a service-layer BFD session may be used between the
       tenants of VTEPs IP1 and IP2
       to provide end-to-end fault management; this use case is outside the
       scope of this document. In
       such a case, for VTEPs, the BFD Control packets of that session are
       indistinguishable from data packets.
      </t>
      <t indent="0" pn="section-3-5">
       For BFD Control packets encapsulated in VXLAN (<xref target="vxlan-bfd-encap-fig" format="default" sectionFormat="of" derivedContent="Figure 2"/>),
       the inner destination IP address
       <bcp14>SHOULD</bcp14> be set to one of the loopback addresses from 
       127/8 range for IPv4 or to one of IPv4-mapped IPv6 loopback addresses from ::ffff:127.0.0.0/104 range for IPv6.
      </t>
    </section>
    <section anchor="management-vni-sec" numbered="true" toc="include" removeInRFC="false" pn="section-4">
      <name slugifiedName="name-use-of-the-management-vni">Use of the Management VNI</name>
      <t indent="0" pn="section-4-1">
In most cases, a single BFD session is sufficient for the given VTEP to monitor
the reachability of a remote VTEP, regardless of the number of VNIs.
    BFD control messages <bcp14>MUST</bcp14> be sent using the Management VNI, which acts
    as the control and management channel between VTEPs.
    An implementation <bcp14>MAY</bcp14> support operating BFD on another
    (non-Management) VNI, although the implications of this are outside
    the scope of this document. The selection of the VNI number
of the Management VNI <bcp14>MUST</bcp14> be controlled through a management plane. An implementation <bcp14>MAY</bcp14> use VNI number 1 as
the default value for the Management VNI. All VXLAN packets received on the Management VNI <bcp14>MUST</bcp14> be processed locally
and <bcp14>MUST NOT</bcp14> be forwarded to a tenant.
</t>
    </section>
    <section anchor="bfd-transmit-vxlan-sec" numbered="true" toc="include" removeInRFC="false" pn="section-5">
      <name slugifiedName="name-bfd-packet-transmission-ove">BFD Packet Transmission over VXLAN Tunnel</name>
      <t indent="0" pn="section-5-1">
	BFD packets <bcp14>MUST</bcp14> be encapsulated and sent to a remote VTEP as explained in this section. 
	Implementations <bcp14>SHOULD</bcp14> ensure that the BFD packets follow the same 
	forwarding path as VXLAN data packets within the sender system.
      </t>
      <t indent="0" pn="section-5-2">
	BFD packets are encapsulated in VXLAN as described below. 
	The VXLAN packet format is defined in
	<xref target="RFC7348" sectionFormat="of" section="5" format="default" derivedLink="https://rfc-editor.org/rfc/rfc7348#section-5" derivedContent="RFC7348"/>. 
	The value in the VNI field of the VXLAN header <bcp14>MUST</bcp14>
	be set to the value selected as the Management VNI.
	The outer IP/UDP and VXLAN headers <bcp14>MUST</bcp14>
      be encoded by the sender, as defined in <xref target="RFC7348" format="default" sectionFormat="of" derivedContent="RFC7348"/>.</t>
      <figure anchor="vxlan-bfd-encap-fig" align="left" suppress-title="false" pn="figure-2">
        <name slugifiedName="name-vxlan-encapsulation-of-bfd-">VXLAN Encapsulation of BFD Control Packet</name>
        <artwork name="" type="" align="left" alt="" pn="section-5-3.1">    
  0                   1                   2                   3
  0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1 2 3 4 5 6 7 8 9 0 1
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                                                               |
 ~                      Outer Ethernet Header                    ~
 |                                                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                                                               |
 ~                        Outer IPvX Header                      ~
 |                                                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                                                               |
 ~                        Outer UDP Header                       ~
 |                                                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                                                               |
 ~                           VXLAN Header                        ~
 |                                                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                                                               |
 ~                    Inner Ethernet Header                      ~
 |                                                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                                                               |
 ~                        Inner IPvX Header                      ~
 |                                                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                                                               |
 ~                         Inner UDP Header                      ~
 |                                                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                                                               |
 ~                       BFD Control Packet                     ~
 |                                                               |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
 |                   Outer Ethernet FCS                          |
 +-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+-+
</artwork>
      </figure>
      <t indent="0" pn="section-5-4">
	The BFD packet <bcp14>MUST</bcp14> be carried inside the inner Ethernet frame of the VXLAN packet.
	The choice of destination Media Access Control (MAC) and destination
	IP addresses for the inner Ethernet frame <bcp14>MUST</bcp14>
	ensure that the BFD Control packet is not forwarded to a tenant but is processed locally at the remote VTEP.
	The inner Ethernet frame carrying the BFD Control packet has the following format:
      </t>
      <dl newline="true" indent="3" spacing="normal" pn="section-5-5">
        <dt pn="section-5-5.1">Ethernet Header:</dt>
        <dd pn="section-5-5.2">
          <dl newline="false" spacing="normal" indent="3" pn="section-5-5.2.1">
            <dt pn="section-5-5.2.1.1">Destination MAC:</dt>
            <dd pn="section-5-5.2.1.2">A Management VNI, which does not have
	    any tenants, will have no dedicated MAC address for decapsulated
	    traffic.  The value 00-52-02 <bcp14>SHOULD</bcp14> be used in
	    this field.</dd>
            <dt pn="section-5-5.2.1.3">Source MAC:</dt>
            <dd pn="section-5-5.2.1.4">MAC address associated with the originating VTEP.</dd>
            <dt pn="section-5-5.2.1.5">Ethertype:</dt>
            <dd pn="section-5-5.2.1.6">This is set to 0x0800 if the inner IP header is
	    IPv4 and set to 0x86DD if the inner IP header is IPv6.</dd>
          </dl>
        </dd>
        <dt pn="section-5-5.3">IP header:</dt>
        <dd pn="section-5-5.4">
          <dl newline="false" spacing="normal" indent="3" pn="section-5-5.4.1">
            <dt pn="section-5-5.4.1.1">Destination IP:</dt>
            <dd pn="section-5-5.4.1.2">This IP address <bcp14>MUST NOT</bcp14> be of one of tenant's IP addresses.
	    The IP address <bcp14>SHOULD</bcp14> be selected
	    from the range 127/8 for IPv4 and from the range
	    ::ffff:127.0.0.0/104 for IPv6.
	    Alternatively, the destination IP address <bcp14>MAY</bcp14> be set to VTEP's IP address.</dd>
            <dt pn="section-5-5.4.1.3">Source IP:</dt>
            <dd pn="section-5-5.4.1.4">IP address of the originating VTEP.</dd>
            <dt pn="section-5-5.4.1.5">TTL or Hop Limit:</dt>
            <dd pn="section-5-5.4.1.6">
              <bcp14>MUST</bcp14> be set to 255, in
	    accordance with <xref target="RFC5881" format="default" sectionFormat="of" derivedContent="RFC5881"/>.</dd>
          </dl>
        </dd>
      </dl>
      <t indent="0" pn="section-5-6">
  The destination UDP port is set to 3784 and the fields of the
BFD Control packet are encoded as specified in <xref target="RFC5881" format="default" sectionFormat="of" derivedContent="RFC5881"/>.</t>
    </section>
    <section numbered="true" toc="include" removeInRFC="false" pn="section-6">
      <name slugifiedName="name-reception-of-bfd-packet-fro">Reception of BFD Packet from VXLAN Tunnel</name>
      <t indent="0" pn="section-6-1">
        Once a packet is received, the VTEP <bcp14>MUST</bcp14> validate the packet.
        If the packet is received on the Management VNI and is identified as a
	BFD Control packet addressed to the VTEP,
        then the packet can be processed further. Processing of BFD Control
	packets received on a non-Management VNI
        is outside the scope of this specification.
      </t>
      <t indent="0" pn="section-6-2">
        The received packet's inner IP payload is then validated according to
	Sections <xref target="RFC5881" sectionFormat="bare" section="4" format="default" derivedLink="https://rfc-editor.org/rfc/rfc5881#section-4" derivedContent="RFC5881"/>
	and <xref target="RFC5881" sectionFormat="bare" section="5" format="default" derivedLink="https://rfc-editor.org/rfc/rfc5881#section-5" derivedContent="RFC5881"/> in <xref target="RFC5881" format="default" sectionFormat="of" derivedContent="RFC5881"/>.
      </t>
    </section>
    <section numbered="true" toc="include" removeInRFC="false" pn="section-7">
      <name slugifiedName="name-echo-bfd">Echo BFD</name>
      <t indent="0" pn="section-7-1">Support for echo BFD is outside the scope of this document.</t>
    </section>
    <section anchor="iana-consideration" numbered="true" toc="include" removeInRFC="false" pn="section-8">
      <name slugifiedName="name-iana-considerations">IANA Considerations</name>
      <t indent="0" pn="section-8-1">
IANA has assigned a single MAC address of the value 00-52-02 from the "Unassigned (small allocations)" block of the "IANA Unicast 48-bit MAC Addresses" registry as follows:
the "Usage" field is "BFD for VXLAN". The "Reference" is this document.
      </t>
    </section>
    <section numbered="true" toc="include" removeInRFC="false" pn="section-9">
      <name slugifiedName="name-security-considerations">Security Considerations</name>
      <t indent="0" pn="section-9-1"> 
        Security issues discussed in <xref target="RFC5880" format="default" sectionFormat="of" derivedContent="RFC5880"/>, <xref target="RFC5881" format="default" sectionFormat="of" derivedContent="RFC5881"/>, and
	<xref target="RFC7348" format="default" sectionFormat="of" derivedContent="RFC7348"/>
        apply to this document.
      </t>
      <t indent="0" pn="section-9-2">
        This document recommends using an address from the internal host loopback addresses
       127/8 range for IPv4, or an IP4-mapped IPv6 loopback address from the
       ::ffff:127.0.0.0/104 range for IPv6,
        as the destination IP address in the inner IP header. Using such an address prevents
        the forwarding of the encapsulated BFD control message by a transient
	node, in case the VXLAN tunnel is broken, in
        accordance with <xref target="RFC1812" format="default" sectionFormat="of" derivedContent="RFC1812"/>.
      </t>
      <aside pn="section-9-3">
        <t indent="0" pn="section-9-3.1">
      A router <bcp14>SHOULD NOT</bcp14> forward, except over a loopback interface, any
      packet that has a destination address on network 127.  A router
      <bcp14>MAY</bcp14> have a switch that allows the network manager to disable these
      checks.  If such a switch is provided, it <bcp14>MUST</bcp14> default to
      performing the checks.</t>
      </aside>
      <t indent="0" pn="section-9-4">
        
        The use of IPv4-mapped IPv6 addresses
        has the same property as using the IPv4 network 127/8. Moreover, the IPv4-mapped
        IPv6 addresses' prefix is not advertised in any routing protocol.</t>
      <t indent="0" pn="section-9-5">
        If the implementation supports establishing multiple BFD sessions
        between the same pair of VTEPs, there <bcp14>SHOULD</bcp14> be a mechanism
        to control the maximum number of such sessions that can be active
        at the same time.
</t>
    </section>
  </middle>
  <back>
    <references pn="section-10">
      <name slugifiedName="name-references">References</name>
      <references pn="section-10.1">
        <name slugifiedName="name-normative-references">Normative References</name>
        <reference anchor="RFC1812" target="https://www.rfc-editor.org/info/rfc1812" quoteTitle="true" derivedAnchor="RFC1812">
          <front>
            <title>Requirements for IP Version 4 Routers</title>
            <author initials="F." surname="Baker" fullname="F. Baker" role="editor">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="1995" month="June"/>
            <abstract>
              <t indent="0">This memo defines and discusses requirements for devices that perform the network layer forwarding function of the Internet protocol suite. [STANDARDS-TRACK]</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="1812"/>
          <seriesInfo name="DOI" value="10.17487/RFC1812"/>
        </reference>
        <reference anchor="RFC2119" target="https://www.rfc-editor.org/info/rfc2119" quoteTitle="true" derivedAnchor="RFC2119">
          <front>
            <title>Key words for use in RFCs to Indicate Requirement Levels</title>
            <author initials="S." surname="Bradner" fullname="S. Bradner">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="1997" month="March"/>
            <abstract>
              <t indent="0">In many standards track documents several words are used to signify the requirements in the specification.  These words are often capitalized. This document defines these words as they should be interpreted in IETF documents.  This document specifies an Internet Best Current Practices for the Internet Community, and requests discussion and suggestions for improvements.</t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="14"/>
          <seriesInfo name="RFC" value="2119"/>
          <seriesInfo name="DOI" value="10.17487/RFC2119"/>
        </reference>
        <reference anchor="RFC5880" target="https://www.rfc-editor.org/info/rfc5880" quoteTitle="true" derivedAnchor="RFC5880">
          <front>
            <title>Bidirectional Forwarding Detection (BFD)</title>
            <author initials="D." surname="Katz" fullname="D. Katz">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="D." surname="Ward" fullname="D. Ward">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2010" month="June"/>
            <abstract>
              <t indent="0">This document describes a protocol intended to detect faults in the bidirectional path between two forwarding engines, including interfaces, data link(s), and to the extent possible the forwarding engines themselves, with potentially very low latency.  It operates independently of media, data protocols, and routing protocols. [STANDARDS-TRACK]</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="5880"/>
          <seriesInfo name="DOI" value="10.17487/RFC5880"/>
        </reference>
        <reference anchor="RFC5881" target="https://www.rfc-editor.org/info/rfc5881" quoteTitle="true" derivedAnchor="RFC5881">
          <front>
            <title>Bidirectional Forwarding Detection (BFD) for IPv4 and IPv6 (Single Hop)</title>
            <author initials="D." surname="Katz" fullname="D. Katz">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="D." surname="Ward" fullname="D. Ward">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2010" month="June"/>
            <abstract>
              <t indent="0">This document describes the use of the Bidirectional Forwarding Detection (BFD) protocol over IPv4 and IPv6 for single IP hops. [STANDARDS-TRACK]</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="5881"/>
          <seriesInfo name="DOI" value="10.17487/RFC5881"/>
        </reference>
        <reference anchor="RFC7348" target="https://www.rfc-editor.org/info/rfc7348" quoteTitle="true" derivedAnchor="RFC7348">
          <front>
            <title>Virtual eXtensible Local Area Network (VXLAN): A Framework for Overlaying Virtualized Layer 2 Networks over Layer 3 Networks</title>
            <author initials="M." surname="Mahalingam" fullname="M. Mahalingam">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="D." surname="Dutt" fullname="D. Dutt">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="K." surname="Duda" fullname="K. Duda">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="P." surname="Agarwal" fullname="P. Agarwal">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="L." surname="Kreeger" fullname="L. Kreeger">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="T." surname="Sridhar" fullname="T. Sridhar">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="M." surname="Bursell" fullname="M. Bursell">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="C." surname="Wright" fullname="C. Wright">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2014" month="August"/>
            <abstract>
              <t indent="0">This document describes Virtual eXtensible Local Area Network (VXLAN), which is used to address the need for overlay networks within virtualized data centers accommodating multiple tenants.  The scheme and the related protocols can be used in networks for cloud service providers and enterprise data centers.  This memo documents the deployed VXLAN protocol for the benefit of the Internet community.</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="7348"/>
          <seriesInfo name="DOI" value="10.17487/RFC7348"/>
        </reference>
        <reference anchor="RFC8174" target="https://www.rfc-editor.org/info/rfc8174" quoteTitle="true" derivedAnchor="RFC8174">
          <front>
            <title>Ambiguity of Uppercase vs Lowercase in RFC 2119 Key Words</title>
            <author initials="B." surname="Leiba" fullname="B. Leiba">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2017" month="May"/>
            <abstract>
              <t indent="0">RFC 2119 specifies common key words that may be used in protocol  specifications.  This document aims to reduce the ambiguity by clarifying that only UPPERCASE usage of the key words have the  defined special meanings.</t>
            </abstract>
          </front>
          <seriesInfo name="BCP" value="14"/>
          <seriesInfo name="RFC" value="8174"/>
          <seriesInfo name="DOI" value="10.17487/RFC8174"/>
        </reference>
      </references>
      <references pn="section-10.2">
        <name slugifiedName="name-informative-references">Informative References</name>
        <reference anchor="RFC8293" target="https://www.rfc-editor.org/info/rfc8293" quoteTitle="true" derivedAnchor="RFC8293">
          <front>
            <title>A Framework for Multicast in Network Virtualization over Layer 3</title>
            <author initials="A." surname="Ghanwani" fullname="A. Ghanwani">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="L." surname="Dunbar" fullname="L. Dunbar">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="M." surname="McBride" fullname="M. McBride">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="V." surname="Bannai" fullname="V. Bannai">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="R." surname="Krishnan" fullname="R. Krishnan">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2018" month="January"/>
            <abstract>
              <t indent="0">This document provides a framework for supporting multicast traffic in a network that uses Network Virtualization over Layer 3 (NVO3). Both infrastructure multicast and application-specific multicast are discussed.  It describes the various mechanisms that can be used for delivering such traffic as well as the data plane and control plane considerations for each of the mechanisms.</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="8293"/>
          <seriesInfo name="DOI" value="10.17487/RFC8293"/>
        </reference>
        <reference anchor="RFC8365" target="https://www.rfc-editor.org/info/rfc8365" quoteTitle="true" derivedAnchor="RFC8365">
          <front>
            <title>A Network Virtualization Overlay Solution Using Ethernet VPN (EVPN)</title>
            <author initials="A." surname="Sajassi" fullname="A. Sajassi" role="editor">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="J." surname="Drake" fullname="J. Drake" role="editor">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="N." surname="Bitar" fullname="N. Bitar">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="R." surname="Shekhar" fullname="R. Shekhar">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="J." surname="Uttaro" fullname="J. Uttaro">
              <organization showOnFrontPage="true"/>
            </author>
            <author initials="W." surname="Henderickx" fullname="W. Henderickx">
              <organization showOnFrontPage="true"/>
            </author>
            <date year="2018" month="March"/>
            <abstract>
              <t indent="0">This document specifies how Ethernet VPN (EVPN) can be used as a Network Virtualization Overlay (NVO) solution and explores the various tunnel encapsulation options over IP and their impact on the EVPN control plane and procedures.  In particular, the following encapsulation options are analyzed: Virtual Extensible LAN (VXLAN), Network Virtualization using Generic Routing Encapsulation (NVGRE), and MPLS over GRE.  This specification is also applicable to Generic Network Virtualization Encapsulation (GENEVE); however, some incremental work is required, which will be covered in a separate document.  This document also specifies new multihoming procedures for split-horizon filtering and mass withdrawal.  It also specifies EVPN route constructions for VXLAN/NVGRE encapsulations and Autonomous System Border Router (ASBR) procedures for multihoming of Network Virtualization Edge (NVE) devices.</t>
            </abstract>
          </front>
          <seriesInfo name="RFC" value="8365"/>
          <seriesInfo name="DOI" value="10.17487/RFC8365"/>
        </reference>
      </references>
    </references>
    <section numbered="false" toc="include" removeInRFC="false" pn="section-appendix.a">
      <name slugifiedName="name-acknowledgments">Acknowledgments</name>
      <t indent="0" pn="section-appendix.a-1">The authors would like to thank <contact fullname="Jeff Haas"/> of
      Juniper Networks for his reviews and feedback on this material.</t>
      <t indent="0" pn="section-appendix.a-2">The authors would also like to thank <contact fullname="Nobo Akiya"/>,
      <contact fullname="Marc Binderberger"/>, <contact fullname="Shahram Davari"/>,
	 <contact fullname="Donald E. Eastlake 3rd"/>, <contact fullname="Anoop Ghanwani"/>, <contact fullname="Dinesh Dutt"/>,
	 <contact fullname="Joel Halpern"/>, and <contact fullname="Carlos   Pignataro"/> for the extensive reviews
	 and the most detailed and constructive comments.</t>
    </section>
    <section numbered="false" toc="include" removeInRFC="false" pn="section-appendix.b">
      <name slugifiedName="name-contributors">Contributors</name>
      <contact fullname="Reshad Rahman">
        <organization showOnFrontPage="true">Cisco</organization>
        <address>
          <email>rrahman@cisco.com</email>
        </address>
      </contact>
    </section>
    <section anchor="authors-addresses" numbered="false" removeInRFC="false" toc="include" pn="section-appendix.c">
      <name slugifiedName="name-authors-addresses">Authors' Addresses</name>
      <author fullname="Santosh Pallagatti" role="editor" initials="S." surname="Pallagatti">
        <organization showOnFrontPage="true">VMware</organization>
        <address>
          <email>santosh.pallagatti@gmail.com</email>
        </address>
      </author>
      <author fullname="Greg Mirsky" role="editor" initials="G." surname="Mirsky">
        <organization showOnFrontPage="true">ZTE Corp.</organization>
        <address>
          <email>gregimirsky@gmail.com</email>
        </address>
      </author>
      <author fullname="Sudarsan Paragiri" initials="S." surname="Paragiri">
        <organization showOnFrontPage="true">Individual Contributor</organization>
        <address>
          <email>sudarsan.225@gmail.com</email>
        </address>
      </author>
      <author fullname="Vengada Prasad Govindan" initials="V." surname="Govindan">
        <organization showOnFrontPage="true">Cisco</organization>
        <address>
          <email>venggovi@cisco.com</email>
        </address>
      </author>
      <author fullname="Mallik Mudigonda" initials="M." surname="Mudigonda">
        <organization showOnFrontPage="true">Cisco</organization>
        <address>
          <email>mmudigon@cisco.com</email>
        </address>
      </author>
    </section>
  </back>
</rfc>
